import{ak as hm,al as ms,am as se,an as lm,ao as zl,ap as Ul,aq as bc,ar as _o,as as fm,at as qr,a3 as Hl,au as Ii,av as pm,aw as dm,ax as Z,ay as gm,az as fc,aA as ym,aB as vm,aC as mm,aD as Nh,aE as wm,aF as _m,aG as bm,aH as Dh,aI as Em,aJ as Im,aK as Qs,aL as Fh,aM as xm,aN as Pm,aO as Bl,aP as $r,aQ as Sm,aR as Am,aS as ps,aT as Dt,aU as tr,aV as Ei,aW as hr,aX as Rm,aY as ds,aZ as kl,a_ as Om,a$ as Cm,b0 as Tm,b1 as Kl,b2 as Nm,b3 as Vl,b4 as Gl,b5 as gs,b6 as pc,b7 as lo,b8 as vs,b9 as Dm,ba as fo,bb as Fm,bc as $m,bd as Lm,be as no,bf as qm,bg as Mm,bh as Ja,bi as $h,bj as jm,bk as zm,bl as Um,bm as Lh,bn as Hm,bo as Bm,bp as km,bq as Km,br as Vm,bs as Gm,bt as Wm,bu as Vs,bv as Wl,bw as Qa,bx as Jm,by as Qm,a7 as Ym}from"./index-c2d2316e.js";import{e as Ar,$ as Ec}from"./events-9e0748e1.js";const Xm=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Zm=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,e1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function t1(c,r){if(c==="__proto__"||c==="constructor"&&r&&typeof r=="object"&&"prototype"in r){r1(c);return}return r}function r1(c){console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)}function oo(c,r={}){if(typeof c!="string")return c;const i=c.trim();if(c[0]==='"'&&c.at(-1)==='"'&&!c.includes("\\"))return i.slice(1,-1);if(i.length<=9){const n=i.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!e1.test(c)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return c}try{if(Xm.test(c)||Zm.test(c)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(c,t1)}return JSON.parse(c)}catch(n){if(r.strict)throw n;return c}}function i1(c){return!c||typeof c.then!="function"?Promise.resolve(c):c}function zt(c,...r){try{return i1(c(...r))}catch(i){return Promise.reject(i)}}function s1(c){const r=typeof c;return c===null||r!=="object"&&r!=="function"}function n1(c){const r=Object.getPrototypeOf(c);return!r||r.isPrototypeOf(Object)}function po(c){if(s1(c))return String(c);if(n1(c)||Array.isArray(c))return JSON.stringify(c);if(typeof c.toJSON=="function")return po(c.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Jl(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const dc="base64:";function o1(c){if(typeof c=="string")return c;Jl();const r=Buffer.from(c).toString("base64");return dc+r}function a1(c){return typeof c!="string"||!c.startsWith(dc)?c:(Jl(),Buffer.from(c.slice(dc.length),"base64"))}function ur(c){return c?c.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function c1(...c){return ur(c.join(":"))}function ao(c){return c=ur(c),c?c+":":""}const u1="memory",h1=()=>{const c=new Map;return{name:u1,options:{},hasItem(r){return c.has(r)},getItem(r){return c.get(r)||null},getItemRaw(r){return c.get(r)||null},setItem(r,i){c.set(r,i)},setItemRaw(r,i){c.set(r,i)},removeItem(r){c.delete(r)},getKeys(){return Array.from(c.keys())},clear(){c.clear()},dispose(){c.clear()}}};function l1(c={}){const r={mounts:{"":c.driver||h1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=m=>{for(const x of r.mountpoints)if(m.startsWith(x))return{base:x,relativeKey:m.slice(x.length),driver:r.mounts[x]};return{base:"",relativeKey:m,driver:r.mounts[""]}},n=(m,x)=>r.mountpoints.filter(O=>O.startsWith(m)||x&&m.startsWith(O)).map(O=>({relativeBase:m.length>O.length?m.slice(O.length):void 0,mountpoint:O,driver:r.mounts[O]})),o=(m,x)=>{if(r.watching){x=ur(x);for(const O of r.watchListeners)O(m,x)}},h=async()=>{if(!r.watching){r.watching=!0;for(const m in r.mounts)r.unwatch[m]=await qh(r.mounts[m],o,m)}},d=async()=>{if(r.watching){for(const m in r.unwatch)await r.unwatch[m]();r.unwatch={},r.watching=!1}},g=(m,x,O)=>{const N=new Map,j=C=>{let K=N.get(C.base);return K||(K={driver:C.driver,base:C.base,items:[]},N.set(C.base,K)),K};for(const C of m){const K=typeof C=="string",re=ur(K?C:C.key),he=K?void 0:C.value,le=K||!C.options?x:{...x,...C.options},fe=i(re);j(fe).items.push({key:re,value:he,relativeKey:fe.relativeKey,options:le})}return Promise.all([...N.values()].map(C=>O(C))).then(C=>C.flat())},_={hasItem(m,x={}){m=ur(m);const{relativeKey:O,driver:N}=i(m);return zt(N.hasItem,O,x)},getItem(m,x={}){m=ur(m);const{relativeKey:O,driver:N}=i(m);return zt(N.getItem,O,x).then(j=>oo(j))},getItems(m,x){return g(m,x,O=>O.driver.getItems?zt(O.driver.getItems,O.items.map(N=>({key:N.relativeKey,options:N.options})),x).then(N=>N.map(j=>({key:c1(O.base,j.key),value:oo(j.value)}))):Promise.all(O.items.map(N=>zt(O.driver.getItem,N.relativeKey,N.options).then(j=>({key:N.key,value:oo(j)})))))},getItemRaw(m,x={}){m=ur(m);const{relativeKey:O,driver:N}=i(m);return N.getItemRaw?zt(N.getItemRaw,O,x):zt(N.getItem,O,x).then(j=>a1(j))},async setItem(m,x,O={}){if(x===void 0)return _.removeItem(m);m=ur(m);const{relativeKey:N,driver:j}=i(m);j.setItem&&(await zt(j.setItem,N,po(x),O),j.watch||o("update",m))},async setItems(m,x){await g(m,x,async O=>{O.driver.setItems&&await zt(O.driver.setItems,O.items.map(N=>({key:N.relativeKey,value:po(N.value),options:N.options})),x),O.driver.setItem&&await Promise.all(O.items.map(N=>zt(O.driver.setItem,N.relativeKey,po(N.value),N.options)))})},async setItemRaw(m,x,O={}){if(x===void 0)return _.removeItem(m,O);m=ur(m);const{relativeKey:N,driver:j}=i(m);if(j.setItemRaw)await zt(j.setItemRaw,N,x,O);else if(j.setItem)await zt(j.setItem,N,o1(x),O);else return;j.watch||o("update",m)},async removeItem(m,x={}){typeof x=="boolean"&&(x={removeMeta:x}),m=ur(m);const{relativeKey:O,driver:N}=i(m);N.removeItem&&(await zt(N.removeItem,O,x),(x.removeMeta||x.removeMata)&&await zt(N.removeItem,O+"$",x),N.watch||o("remove",m))},async getMeta(m,x={}){typeof x=="boolean"&&(x={nativeOnly:x}),m=ur(m);const{relativeKey:O,driver:N}=i(m),j=Object.create(null);if(N.getMeta&&Object.assign(j,await zt(N.getMeta,O,x)),!x.nativeOnly){const C=await zt(N.getItem,O+"$",x).then(K=>oo(K));C&&typeof C=="object"&&(typeof C.atime=="string"&&(C.atime=new Date(C.atime)),typeof C.mtime=="string"&&(C.mtime=new Date(C.mtime)),Object.assign(j,C))}return j},setMeta(m,x,O={}){return this.setItem(m+"$",x,O)},removeMeta(m,x={}){return this.removeItem(m+"$",x)},async getKeys(m,x={}){m=ao(m);const O=n(m,!0);let N=[];const j=[];for(const C of O){const re=(await zt(C.driver.getKeys,C.relativeBase,x)).map(he=>C.mountpoint+ur(he)).filter(he=>!N.some(le=>he.startsWith(le)));j.push(...re),N=[C.mountpoint,...N.filter(he=>!he.startsWith(C.mountpoint))]}return m?j.filter(C=>C.startsWith(m)&&!C.endsWith("$")):j.filter(C=>!C.endsWith("$"))},async clear(m,x={}){m=ao(m),await Promise.all(n(m,!1).map(async O=>{if(O.driver.clear)return zt(O.driver.clear,O.relativeBase,x);if(O.driver.removeItem){const N=await O.driver.getKeys(O.relativeBase||"",x);return Promise.all(N.map(j=>O.driver.removeItem(j,x)))}}))},async dispose(){await Promise.all(Object.values(r.mounts).map(m=>Mh(m)))},async watch(m){return await h(),r.watchListeners.push(m),async()=>{r.watchListeners=r.watchListeners.filter(x=>x!==m),r.watchListeners.length===0&&await d()}},async unwatch(){r.watchListeners=[],await d()},mount(m,x){if(m=ao(m),m&&r.mounts[m])throw new Error(`already mounted at ${m}`);return m&&(r.mountpoints.push(m),r.mountpoints.sort((O,N)=>N.length-O.length)),r.mounts[m]=x,r.watching&&Promise.resolve(qh(x,o,m)).then(O=>{r.unwatch[m]=O}).catch(console.error),_},async unmount(m,x=!0){m=ao(m),!(!m||!r.mounts[m])&&(r.watching&&m in r.unwatch&&(r.unwatch[m](),delete r.unwatch[m]),x&&await Mh(r.mounts[m]),r.mountpoints=r.mountpoints.filter(O=>O!==m),delete r.mounts[m])},getMount(m=""){m=ur(m)+":";const x=i(m);return{driver:x.driver,base:x.base}},getMounts(m="",x={}){return m=ur(m),n(m,x.parents).map(N=>({driver:N.driver,base:N.mountpoint}))}};return _}function qh(c,r,i){return c.watch?c.watch((n,o)=>r(n,i+o)):()=>{}}async function Mh(c){typeof c.dispose=="function"&&await zt(c.dispose)}function ki(c){return new Promise((r,i)=>{c.oncomplete=c.onsuccess=()=>r(c.result),c.onabort=c.onerror=()=>i(c.error)})}function Ql(c,r){const i=indexedDB.open(c);i.onupgradeneeded=()=>i.result.createObjectStore(r);const n=ki(i);return(o,h)=>n.then(d=>h(d.transaction(r,o).objectStore(r)))}let Ya;function Ys(){return Ya||(Ya=Ql("keyval-store","keyval")),Ya}function jh(c,r=Ys()){return r("readonly",i=>ki(i.get(c)))}function f1(c,r,i=Ys()){return i("readwrite",n=>(n.put(r,c),ki(n.transaction)))}function p1(c,r=Ys()){return r("readwrite",i=>(i.delete(c),ki(i.transaction)))}function d1(c=Ys()){return c("readwrite",r=>(r.clear(),ki(r.transaction)))}function g1(c,r){return c.openCursor().onsuccess=function(){this.result&&(r(this.result),this.result.continue())},ki(c.transaction)}function y1(c=Ys()){return c("readonly",r=>{if(r.getAllKeys)return ki(r.getAllKeys());const i=[];return g1(r,n=>i.push(n.key)).then(()=>i)})}const v1=c=>JSON.stringify(c,(r,i)=>typeof i=="bigint"?i.toString()+"n":i),m1=c=>{const r=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=c.replace(r,'$1"$2n"$3');return JSON.parse(i,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function Xs(c){if(typeof c!="string")throw new Error(`Cannot safe json parse value of type ${typeof c}`);try{return m1(c)}catch{return c}}function Bi(c){return typeof c=="string"?c:v1(c)||""}const w1="idb-keyval";var _1=(c={})=>{const r=c.base&&c.base.length>0?`${c.base}:`:"",i=o=>r+o;let n;return c.dbName&&c.storeName&&(n=Ql(c.dbName,c.storeName)),{name:w1,options:c,async hasItem(o){return!(typeof await jh(i(o),n)>"u")},async getItem(o){return await jh(i(o),n)??null},setItem(o,h){return f1(i(o),h,n)},removeItem(o){return p1(i(o),n)},getKeys(){return y1(n)},clear(){return d1(n)}}};const b1="WALLET_CONNECT_V2_INDEXED_DB",E1="keyvaluestorage";let I1=class{constructor(){this.indexedDb=l1({driver:_1({dbName:b1,storeName:E1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(r=>[r.key,r.value])}async getItem(r){const i=await this.indexedDb.getItem(r);if(i!==null)return i}async setItem(r,i){await this.indexedDb.setItem(r,Bi(i))}async removeItem(r){await this.indexedDb.removeItem(r)}};var Xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},go={exports:{}};(function(){let c;function r(){}c=r,c.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},c.prototype.setItem=function(i,n){this[i]=String(n)},c.prototype.removeItem=function(i){delete this[i]},c.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(n){i[n]=void 0,delete i[n]})},c.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},c.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Xa<"u"&&Xa.localStorage?go.exports=Xa.localStorage:typeof window<"u"&&window.localStorage?go.exports=window.localStorage:go.exports=new r})();function x1(c){var r;return[c[0],Xs((r=c[1])!=null?r:"")]}let P1=class{constructor(){this.localStorage=go.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(x1)}async getItem(r){const i=this.localStorage.getItem(r);if(i!==null)return Xs(i)}async setItem(r,i){this.localStorage.setItem(r,Bi(i))}async removeItem(r){this.localStorage.removeItem(r)}};const S1="wc_storage_version",zh=1,A1=async(c,r,i)=>{const n=S1,o=await r.getItem(n);if(o&&o>=zh){i(r);return}const h=await c.getKeys();if(!h.length){i(r);return}const d=[];for(;h.length;){const g=h.shift();if(!g)continue;const _=g.toLowerCase();if(_.includes("wc@")||_.includes("walletconnect")||_.includes("wc_")||_.includes("wallet_connect")){const m=await c.getItem(g);await r.setItem(g,m),d.push(g)}}await r.setItem(n,zh),i(r),R1(c,d)},R1=async(c,r)=>{r.length&&r.forEach(async i=>{await c.removeItem(i)})};let O1=class{constructor(){this.initialized=!1,this.setInitialized=i=>{this.storage=i,this.initialized=!0};const r=new P1;this.storage=r;try{const i=new I1;A1(r,i,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(r){return await this.initialize(),this.storage.getItem(r)}async setItem(r,i){return await this.initialize(),this.storage.setItem(r,i)}async removeItem(r){return await this.initialize(),this.storage.removeItem(r)}async initialize(){this.initialized||await new Promise(r=>{const i=setInterval(()=>{this.initialized&&(clearInterval(i),r())},20)})}};var ws={},js={},Za={},zs={};let Ki=class{};const C1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ki},Symbol.toStringTag,{value:"Module"})),T1=hm(C1);var Uh;function N1(){if(Uh)return zs;Uh=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.IHeartBeat=void 0;const c=T1;class r extends c.IEvents{constructor(n){super()}}return zs.IHeartBeat=r,zs}var Hh;function Yl(){return Hh||(Hh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),ms.__exportStar(N1(),c)}(Za)),Za}var ec={},Ui={},Bh;function D1(){if(Bh)return Ui;Bh=1,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.HEARTBEAT_EVENTS=Ui.HEARTBEAT_INTERVAL=void 0;const c=se;return Ui.HEARTBEAT_INTERVAL=c.FIVE_SECONDS,Ui.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ui}var kh;function Xl(){return kh||(kh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),ms.__exportStar(D1(),c)}(ec)),ec}var Kh;function F1(){if(Kh)return js;Kh=1,Object.defineProperty(js,"__esModule",{value:!0}),js.HeartBeat=void 0;const c=ms,r=Ar,i=se,n=Yl(),o=Xl();class h extends n.IHeartBeat{constructor(g){super(g),this.events=new r.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||o.HEARTBEAT_INTERVAL}static init(g){return c.__awaiter(this,void 0,void 0,function*(){const _=new h(g);return yield _.init(),_})}init(){return c.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,_){this.events.on(g,_)}once(g,_){this.events.once(g,_)}off(g,_){this.events.off(g,_)}removeListener(g,_){this.events.removeListener(g,_)}initialize(){return c.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return js.HeartBeat=h,js}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=ms;r.__exportStar(F1(),c),r.__exportStar(Yl(),c),r.__exportStar(Xl(),c)})(ws);var Ce={},tc,Vh;function $1(){if(Vh)return tc;Vh=1;function c(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}tc=r;function r(i,n,o){var h=o&&o.stringify||c,d=1;if(typeof i=="object"&&i!==null){var g=n.length+d;if(g===1)return i;var _=new Array(g);_[0]=h(i);for(var m=1;m<g;m++)_[m]=h(n[m]);return _.join(" ")}if(typeof i!="string")return i;var x=n.length;if(x===0)return i;for(var O="",N=1-d,j=-1,C=i&&i.length||0,K=0;K<C;){if(i.charCodeAt(K)===37&&K+1<C){switch(j=j>-1?j:0,i.charCodeAt(K+1)){case 100:case 102:if(N>=x||n[N]==null)break;j<K&&(O+=i.slice(j,K)),O+=Number(n[N]),j=K+2,K++;break;case 105:if(N>=x||n[N]==null)break;j<K&&(O+=i.slice(j,K)),O+=Math.floor(Number(n[N])),j=K+2,K++;break;case 79:case 111:case 106:if(N>=x||n[N]===void 0)break;j<K&&(O+=i.slice(j,K));var re=typeof n[N];if(re==="string"){O+="'"+n[N]+"'",j=K+2,K++;break}if(re==="function"){O+=n[N].name||"<anonymous>",j=K+2,K++;break}O+=h(n[N]),j=K+2,K++;break;case 115:if(N>=x)break;j<K&&(O+=i.slice(j,K)),O+=String(n[N]),j=K+2,K++;break;case 37:j<K&&(O+=i.slice(j,K)),O+="%",j=K+2,K++,N--;break}++N}++K}return j===-1?i:(j<C&&(O+=i.slice(j)),O)}return tc}var rc,Gh;function L1(){if(Gh)return rc;Gh=1;const c=$1();rc=o;const r=de().console||{},i={mapHttpRequest:C,mapHttpResponse:C,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:C,res:C,err:N};function n($,U){return Array.isArray($)?$.filter(function(ve){return ve!=="!stdSerializers.err"}):$===!0?Object.keys(U):!1}function o($){$=$||{},$.browser=$.browser||{};const U=$.browser.transmit;if(U&&typeof U.send!="function")throw Error("pino: transmit option must have a send function");const W=$.browser.write||r;$.browser.write&&($.browser.asObject=!0);const ve=$.serializers||{},ie=n($.browser.serialize,ve);let ue=$.browser.serialize;Array.isArray($.browser.serialize)&&$.browser.serialize.indexOf("!stdSerializers.err")>-1&&(ue=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),$.enabled===!1&&($.level="silent");const ze=$.level||"info",v=Object.create(W);v.log||(v.log=re),Object.defineProperty(v,"levelVal",{get:Y}),Object.defineProperty(v,"level",{get:ce,set:V});const I={transmit:U,serialize:ie,asObject:$.browser.asObject,levels:Te,timestamp:j($)};v.levels=o.levels,v.level=ze,v.setMaxListeners=v.getMaxListeners=v.emit=v.addListener=v.on=v.prependListener=v.once=v.prependOnceListener=v.removeListener=v.removeAllListeners=v.listeners=v.listenerCount=v.eventNames=v.write=v.flush=re,v.serializers=ve,v._serialize=ie,v._stdErrSerialize=ue,v.child=H,U&&(v._logEvent=O());function Y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function ce(){return this._level}function V(k){if(k!=="silent"&&!this.levels.values[k])throw Error("unknown level "+k);this._level=k,h(I,v,"error","log"),h(I,v,"fatal","error"),h(I,v,"warn","error"),h(I,v,"info","log"),h(I,v,"debug","log"),h(I,v,"trace","log")}function H(k,G){if(!k)throw new Error("missing bindings for child Pino");G=G||{},ie&&k.serializers&&(G.serializers=k.serializers);const Je=G.serializers;if(ie&&Je){var Be=Object.assign({},ve,Je),Mr=$.browser.serialize===!0?Object.keys(Be):ie;delete k.serializers,_([k],Mr,Be,this._stdErrSerialize)}function Ie(It){this._childLevel=(It._childLevel|0)+1,this.error=m(It,k,"error"),this.fatal=m(It,k,"fatal"),this.warn=m(It,k,"warn"),this.info=m(It,k,"info"),this.debug=m(It,k,"debug"),this.trace=m(It,k,"trace"),Be&&(this.serializers=Be,this._serialize=Mr),U&&(this._logEvent=O([].concat(It._logEvent.bindings,k)))}return Ie.prototype=this,new Ie(this)}return v}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=i,o.stdTimeFunctions=Object.assign({},{nullTime:he,epochTime:le,unixTime:fe,isoTime:pe});function h($,U,W,ve){const ie=Object.getPrototypeOf(U);U[W]=U.levelVal>U.levels.values[W]?re:ie[W]?ie[W]:r[W]||r[ve]||re,d($,U,W)}function d($,U,W){!$.transmit&&U[W]===re||(U[W]=function(ve){return function(){const ue=$.timestamp(),Te=new Array(arguments.length),ze=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var v=0;v<Te.length;v++)Te[v]=arguments[v];if($.serialize&&!$.asObject&&_(Te,this._serialize,this.serializers,this._stdErrSerialize),$.asObject?ve.call(ze,g(this,W,Te,ue)):ve.apply(ze,Te),$.transmit){const I=$.transmit.level||U.level,Y=o.levels.values[I],ce=o.levels.values[W];if(ce<Y)return;x(this,{ts:ue,methodLevel:W,methodValue:ce,transmitLevel:I,transmitValue:o.levels.values[$.transmit.level||U.level],send:$.transmit.send,val:U.levelVal},Te)}}}(U[W]))}function g($,U,W,ve){$._serialize&&_(W,$._serialize,$.serializers,$._stdErrSerialize);const ie=W.slice();let ue=ie[0];const Te={};ve&&(Te.time=ve),Te.level=o.levels.values[U];let ze=($._childLevel|0)+1;if(ze<1&&(ze=1),ue!==null&&typeof ue=="object"){for(;ze--&&typeof ie[0]=="object";)Object.assign(Te,ie.shift());ue=ie.length?c(ie.shift(),ie):void 0}else typeof ue=="string"&&(ue=c(ie.shift(),ie));return ue!==void 0&&(Te.msg=ue),Te}function _($,U,W,ve){for(const ie in $)if(ve&&$[ie]instanceof Error)$[ie]=o.stdSerializers.err($[ie]);else if(typeof $[ie]=="object"&&!Array.isArray($[ie]))for(const ue in $[ie])U&&U.indexOf(ue)>-1&&ue in W&&($[ie][ue]=W[ue]($[ie][ue]))}function m($,U,W){return function(){const ve=new Array(1+arguments.length);ve[0]=U;for(var ie=1;ie<ve.length;ie++)ve[ie]=arguments[ie-1];return $[W].apply(this,ve)}}function x($,U,W){const ve=U.send,ie=U.ts,ue=U.methodLevel,Te=U.methodValue,ze=U.val,v=$._logEvent.bindings;_(W,$._serialize||Object.keys($.serializers),$.serializers,$._stdErrSerialize===void 0?!0:$._stdErrSerialize),$._logEvent.ts=ie,$._logEvent.messages=W.filter(function(I){return v.indexOf(I)===-1}),$._logEvent.level.label=ue,$._logEvent.level.value=Te,ve(ue,$._logEvent,ze),$._logEvent=O(v)}function O($){return{ts:0,messages:[],bindings:$||[],level:{label:"",value:0}}}function N($){const U={type:$.constructor.name,msg:$.message,stack:$.stack};for(const W in $)U[W]===void 0&&(U[W]=$[W]);return U}function j($){return typeof $.timestamp=="function"?$.timestamp:$.timestamp===!1?he:le}function C(){return{}}function K($){return $}function re(){}function he(){return!1}function le(){return Date.now()}function fe(){return Math.round(Date.now()/1e3)}function pe(){return new Date(Date.now()).toISOString()}function de(){function $(U){return typeof U<"u"&&U}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return $(self)||$(window)||$(this)||{}}}return rc}var Hi={},Wh;function Zl(){return Wh||(Wh=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.PINO_CUSTOM_CONTEXT_KEY=Hi.PINO_LOGGER_DEFAULTS=void 0,Hi.PINO_LOGGER_DEFAULTS={level:"info"},Hi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Hi}var er={},Jh;function q1(){if(Jh)return er;Jh=1,Object.defineProperty(er,"__esModule",{value:!0}),er.generateChildLogger=er.formatChildLoggerContext=er.getLoggerContext=er.setBrowserLoggerContext=er.getBrowserLoggerContext=er.getDefaultLoggerOptions=void 0;const c=Zl();function r(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||c.PINO_LOGGER_DEFAULTS.level})}er.getDefaultLoggerOptions=r;function i(g,_=c.PINO_CUSTOM_CONTEXT_KEY){return g[_]||""}er.getBrowserLoggerContext=i;function n(g,_,m=c.PINO_CUSTOM_CONTEXT_KEY){return g[m]=_,g}er.setBrowserLoggerContext=n;function o(g,_=c.PINO_CUSTOM_CONTEXT_KEY){let m="";return typeof g.bindings>"u"?m=i(g,_):m=g.bindings().context||"",m}er.getLoggerContext=o;function h(g,_,m=c.PINO_CUSTOM_CONTEXT_KEY){const x=o(g,m);return x.trim()?`${x}/${_}`:_}er.formatChildLoggerContext=h;function d(g,_,m=c.PINO_CUSTOM_CONTEXT_KEY){const x=h(g,_,m),O=g.child({context:x});return n(O,x,m)}return er.generateChildLogger=d,er}(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.pino=void 0;const r=ms,i=r.__importDefault(L1());Object.defineProperty(c,"pino",{enumerable:!0,get:function(){return i.default}}),r.__exportStar(Zl(),c),r.__exportStar(q1(),c)})(Ce);class M1 extends Ki{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class j1 extends Ki{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class z1{constructor(r,i){this.logger=r,this.core=i}}let U1=class extends Ki{constructor(r,i){super(),this.relayer=r,this.logger=i}},H1=class extends Ki{constructor(r){super()}},B1=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}};class k1 extends Ki{constructor(r,i){super(),this.relayer=r,this.logger=i}}let K1=class extends Ki{constructor(r,i){super(),this.core=r,this.logger=i}},V1=class{constructor(r,i){this.projectId=r,this.logger=i}},G1=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},W1=class{constructor(r){this.client=r}};var Ic={},ef={};(function(c){Object.defineProperty(c,"__esModule",{value:!0});var r=lm,i=zl;c.DIGEST_LENGTH=64,c.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=c.DIGEST_LENGTH,this.blockSize=c.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},g.prototype.update=function(_,m){if(m===void 0&&(m=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var x=0;if(this._bytesHashed+=m,this._bufferLength>0){for(;this._bufferLength<c.BLOCK_SIZE&&m>0;)this._buffer[this._bufferLength++]=_[x++],m--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(m>=this.blockSize&&(x=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,x,m),m%=this.blockSize);m>0;)this._buffer[this._bufferLength++]=_[x++],m--;return this},g.prototype.finish=function(_){if(!this._finished){var m=this._bytesHashed,x=this._bufferLength,O=m/536870912|0,N=m<<3,j=m%128<112?128:256;this._buffer[x]=128;for(var C=x+1;C<j-8;C++)this._buffer[C]=0;r.writeUint32BE(O,this._buffer,j-8),r.writeUint32BE(N,this._buffer,j-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,j),this._finished=!0}for(var C=0;C<this.digestLength/8;C++)r.writeUint32BE(this._stateHi[C],_,C*8),r.writeUint32BE(this._stateLo[C],_,C*8+4);return this},g.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(_){i.wipe(_.stateHi),i.wipe(_.stateLo),_.buffer&&i.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},g}();c.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(g,_,m,x,O,N,j){for(var C=m[0],K=m[1],re=m[2],he=m[3],le=m[4],fe=m[5],pe=m[6],de=m[7],$=x[0],U=x[1],W=x[2],ve=x[3],ie=x[4],ue=x[5],Te=x[6],ze=x[7],v,I,Y,ce,V,H,k,G;j>=128;){for(var Je=0;Je<16;Je++){var Be=8*Je+N;g[Je]=r.readUint32BE(O,Be),_[Je]=r.readUint32BE(O,Be+4)}for(var Je=0;Je<80;Je++){var Mr=C,Ie=K,It=re,F=he,D=le,R=fe,u=pe,E=de,ee=$,ge=U,be=W,Ne=ve,Fe=ie,Se=ue,xt=Te,mt=ze;if(v=de,I=ze,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=(le>>>14|ie<<32-14)^(le>>>18|ie<<32-18)^(ie>>>41-32|le<<32-(41-32)),I=(ie>>>14|le<<32-14)^(ie>>>18|le<<32-18)^(le>>>41-32|ie<<32-(41-32)),V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,v=le&fe^~le&pe,I=ie&ue^~ie&Te,V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,v=o[Je*2],I=o[Je*2+1],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,v=g[Je%16],I=_[Je%16],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,Y=k&65535|G<<16,ce=V&65535|H<<16,v=Y,I=ce,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=(C>>>28|$<<32-28)^($>>>34-32|C<<32-(34-32))^($>>>39-32|C<<32-(39-32)),I=($>>>28|C<<32-28)^(C>>>34-32|$<<32-(34-32))^(C>>>39-32|$<<32-(39-32)),V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,v=C&K^C&re^K&re,I=$&U^$&W^U&W,V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,E=k&65535|G<<16,mt=V&65535|H<<16,v=F,I=Ne,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=Y,I=ce,V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,F=k&65535|G<<16,Ne=V&65535|H<<16,K=Mr,re=Ie,he=It,le=F,fe=D,pe=R,de=u,C=E,U=ee,W=ge,ve=be,ie=Ne,ue=Fe,Te=Se,ze=xt,$=mt,Je%16===15)for(var Be=0;Be<16;Be++)v=g[Be],I=_[Be],V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=g[(Be+9)%16],I=_[(Be+9)%16],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,Y=g[(Be+1)%16],ce=_[(Be+1)%16],v=(Y>>>1|ce<<32-1)^(Y>>>8|ce<<32-8)^Y>>>7,I=(ce>>>1|Y<<32-1)^(ce>>>8|Y<<32-8)^(ce>>>7|Y<<32-7),V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,Y=g[(Be+14)%16],ce=_[(Be+14)%16],v=(Y>>>19|ce<<32-19)^(ce>>>61-32|Y<<32-(61-32))^Y>>>6,I=(ce>>>19|Y<<32-19)^(Y>>>61-32|ce<<32-(61-32))^(ce>>>6|Y<<32-6),V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,g[Be]=k&65535|G<<16,_[Be]=V&65535|H<<16}v=C,I=$,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[0],I=x[0],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[0]=C=k&65535|G<<16,x[0]=$=V&65535|H<<16,v=K,I=U,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[1],I=x[1],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[1]=K=k&65535|G<<16,x[1]=U=V&65535|H<<16,v=re,I=W,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[2],I=x[2],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[2]=re=k&65535|G<<16,x[2]=W=V&65535|H<<16,v=he,I=ve,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[3],I=x[3],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[3]=he=k&65535|G<<16,x[3]=ve=V&65535|H<<16,v=le,I=ie,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[4],I=x[4],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[4]=le=k&65535|G<<16,x[4]=ie=V&65535|H<<16,v=fe,I=ue,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[5],I=x[5],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[5]=fe=k&65535|G<<16,x[5]=ue=V&65535|H<<16,v=pe,I=Te,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[6],I=x[6],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[6]=pe=k&65535|G<<16,x[6]=Te=V&65535|H<<16,v=de,I=ze,V=I&65535,H=I>>>16,k=v&65535,G=v>>>16,v=m[7],I=x[7],V+=I&65535,H+=I>>>16,k+=v&65535,G+=v>>>16,H+=V>>>16,k+=H>>>16,G+=k>>>16,m[7]=de=k&65535|G<<16,x[7]=ze=V&65535|H<<16,N+=128,j-=128}return N}function d(g){var _=new n;_.update(g);var m=_.digest();return _.clean(),m}c.hash=d})(ef);(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.convertSecretKeyToX25519=c.convertPublicKeyToX25519=c.verify=c.sign=c.extractPublicKeyFromSecretKey=c.generateKeyPair=c.generateKeyPairFromSeed=c.SEED_LENGTH=c.SECRET_KEY_LENGTH=c.PUBLIC_KEY_LENGTH=c.SIGNATURE_LENGTH=void 0;const r=Ul,i=ef,n=zl;c.SIGNATURE_LENGTH=64,c.PUBLIC_KEY_LENGTH=32,c.SECRET_KEY_LENGTH=64,c.SEED_LENGTH=32;function o(F){const D=new Float64Array(16);if(F)for(let R=0;R<F.length;R++)D[R]=F[R];return D}const h=new Uint8Array(32);h[0]=9;const d=o(),g=o([1]),_=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),m=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),x=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function j(F,D){for(let R=0;R<16;R++)F[R]=D[R]|0}function C(F){let D=1;for(let R=0;R<16;R++){let u=F[R]+D+65535;D=Math.floor(u/65536),F[R]=u-D*65536}F[0]+=D-1+37*(D-1)}function K(F,D,R){const u=~(R-1);for(let E=0;E<16;E++){const ee=u&(F[E]^D[E]);F[E]^=ee,D[E]^=ee}}function re(F,D){const R=o(),u=o();for(let E=0;E<16;E++)u[E]=D[E];C(u),C(u),C(u);for(let E=0;E<2;E++){R[0]=u[0]-65517;for(let ge=1;ge<15;ge++)R[ge]=u[ge]-65535-(R[ge-1]>>16&1),R[ge-1]&=65535;R[15]=u[15]-32767-(R[14]>>16&1);const ee=R[15]>>16&1;R[14]&=65535,K(u,R,1-ee)}for(let E=0;E<16;E++)F[2*E]=u[E]&255,F[2*E+1]=u[E]>>8}function he(F,D){let R=0;for(let u=0;u<32;u++)R|=F[u]^D[u];return(1&R-1>>>8)-1}function le(F,D){const R=new Uint8Array(32),u=new Uint8Array(32);return re(R,F),re(u,D),he(R,u)}function fe(F){const D=new Uint8Array(32);return re(D,F),D[0]&1}function pe(F,D){for(let R=0;R<16;R++)F[R]=D[2*R]+(D[2*R+1]<<8);F[15]&=32767}function de(F,D,R){for(let u=0;u<16;u++)F[u]=D[u]+R[u]}function $(F,D,R){for(let u=0;u<16;u++)F[u]=D[u]-R[u]}function U(F,D,R){let u,E,ee=0,ge=0,be=0,Ne=0,Fe=0,Se=0,xt=0,mt=0,ot=0,Le=0,Ye=0,Xe=0,at=0,Ue=0,Ze=0,De=0,ke=0,ht=0,Me=0,Pt=0,Ft=0,Ut=0,Ht=0,qt=0,Wt=0,rr=0,jr=0,Jt=0,Vr=0,li=0,Ai=0,lt=R[0],rt=R[1],ft=R[2],pt=R[3],ct=R[4],it=R[5],St=R[6],At=R[7],dt=R[8],Rt=R[9],gt=R[10],wt=R[11],yt=R[12],Qe=R[13],Ot=R[14],Ct=R[15];u=D[0],ee+=u*lt,ge+=u*rt,be+=u*ft,Ne+=u*pt,Fe+=u*ct,Se+=u*it,xt+=u*St,mt+=u*At,ot+=u*dt,Le+=u*Rt,Ye+=u*gt,Xe+=u*wt,at+=u*yt,Ue+=u*Qe,Ze+=u*Ot,De+=u*Ct,u=D[1],ge+=u*lt,be+=u*rt,Ne+=u*ft,Fe+=u*pt,Se+=u*ct,xt+=u*it,mt+=u*St,ot+=u*At,Le+=u*dt,Ye+=u*Rt,Xe+=u*gt,at+=u*wt,Ue+=u*yt,Ze+=u*Qe,De+=u*Ot,ke+=u*Ct,u=D[2],be+=u*lt,Ne+=u*rt,Fe+=u*ft,Se+=u*pt,xt+=u*ct,mt+=u*it,ot+=u*St,Le+=u*At,Ye+=u*dt,Xe+=u*Rt,at+=u*gt,Ue+=u*wt,Ze+=u*yt,De+=u*Qe,ke+=u*Ot,ht+=u*Ct,u=D[3],Ne+=u*lt,Fe+=u*rt,Se+=u*ft,xt+=u*pt,mt+=u*ct,ot+=u*it,Le+=u*St,Ye+=u*At,Xe+=u*dt,at+=u*Rt,Ue+=u*gt,Ze+=u*wt,De+=u*yt,ke+=u*Qe,ht+=u*Ot,Me+=u*Ct,u=D[4],Fe+=u*lt,Se+=u*rt,xt+=u*ft,mt+=u*pt,ot+=u*ct,Le+=u*it,Ye+=u*St,Xe+=u*At,at+=u*dt,Ue+=u*Rt,Ze+=u*gt,De+=u*wt,ke+=u*yt,ht+=u*Qe,Me+=u*Ot,Pt+=u*Ct,u=D[5],Se+=u*lt,xt+=u*rt,mt+=u*ft,ot+=u*pt,Le+=u*ct,Ye+=u*it,Xe+=u*St,at+=u*At,Ue+=u*dt,Ze+=u*Rt,De+=u*gt,ke+=u*wt,ht+=u*yt,Me+=u*Qe,Pt+=u*Ot,Ft+=u*Ct,u=D[6],xt+=u*lt,mt+=u*rt,ot+=u*ft,Le+=u*pt,Ye+=u*ct,Xe+=u*it,at+=u*St,Ue+=u*At,Ze+=u*dt,De+=u*Rt,ke+=u*gt,ht+=u*wt,Me+=u*yt,Pt+=u*Qe,Ft+=u*Ot,Ut+=u*Ct,u=D[7],mt+=u*lt,ot+=u*rt,Le+=u*ft,Ye+=u*pt,Xe+=u*ct,at+=u*it,Ue+=u*St,Ze+=u*At,De+=u*dt,ke+=u*Rt,ht+=u*gt,Me+=u*wt,Pt+=u*yt,Ft+=u*Qe,Ut+=u*Ot,Ht+=u*Ct,u=D[8],ot+=u*lt,Le+=u*rt,Ye+=u*ft,Xe+=u*pt,at+=u*ct,Ue+=u*it,Ze+=u*St,De+=u*At,ke+=u*dt,ht+=u*Rt,Me+=u*gt,Pt+=u*wt,Ft+=u*yt,Ut+=u*Qe,Ht+=u*Ot,qt+=u*Ct,u=D[9],Le+=u*lt,Ye+=u*rt,Xe+=u*ft,at+=u*pt,Ue+=u*ct,Ze+=u*it,De+=u*St,ke+=u*At,ht+=u*dt,Me+=u*Rt,Pt+=u*gt,Ft+=u*wt,Ut+=u*yt,Ht+=u*Qe,qt+=u*Ot,Wt+=u*Ct,u=D[10],Ye+=u*lt,Xe+=u*rt,at+=u*ft,Ue+=u*pt,Ze+=u*ct,De+=u*it,ke+=u*St,ht+=u*At,Me+=u*dt,Pt+=u*Rt,Ft+=u*gt,Ut+=u*wt,Ht+=u*yt,qt+=u*Qe,Wt+=u*Ot,rr+=u*Ct,u=D[11],Xe+=u*lt,at+=u*rt,Ue+=u*ft,Ze+=u*pt,De+=u*ct,ke+=u*it,ht+=u*St,Me+=u*At,Pt+=u*dt,Ft+=u*Rt,Ut+=u*gt,Ht+=u*wt,qt+=u*yt,Wt+=u*Qe,rr+=u*Ot,jr+=u*Ct,u=D[12],at+=u*lt,Ue+=u*rt,Ze+=u*ft,De+=u*pt,ke+=u*ct,ht+=u*it,Me+=u*St,Pt+=u*At,Ft+=u*dt,Ut+=u*Rt,Ht+=u*gt,qt+=u*wt,Wt+=u*yt,rr+=u*Qe,jr+=u*Ot,Jt+=u*Ct,u=D[13],Ue+=u*lt,Ze+=u*rt,De+=u*ft,ke+=u*pt,ht+=u*ct,Me+=u*it,Pt+=u*St,Ft+=u*At,Ut+=u*dt,Ht+=u*Rt,qt+=u*gt,Wt+=u*wt,rr+=u*yt,jr+=u*Qe,Jt+=u*Ot,Vr+=u*Ct,u=D[14],Ze+=u*lt,De+=u*rt,ke+=u*ft,ht+=u*pt,Me+=u*ct,Pt+=u*it,Ft+=u*St,Ut+=u*At,Ht+=u*dt,qt+=u*Rt,Wt+=u*gt,rr+=u*wt,jr+=u*yt,Jt+=u*Qe,Vr+=u*Ot,li+=u*Ct,u=D[15],De+=u*lt,ke+=u*rt,ht+=u*ft,Me+=u*pt,Pt+=u*ct,Ft+=u*it,Ut+=u*St,Ht+=u*At,qt+=u*dt,Wt+=u*Rt,rr+=u*gt,jr+=u*wt,Jt+=u*yt,Vr+=u*Qe,li+=u*Ot,Ai+=u*Ct,ee+=38*ke,ge+=38*ht,be+=38*Me,Ne+=38*Pt,Fe+=38*Ft,Se+=38*Ut,xt+=38*Ht,mt+=38*qt,ot+=38*Wt,Le+=38*rr,Ye+=38*jr,Xe+=38*Jt,at+=38*Vr,Ue+=38*li,Ze+=38*Ai,E=1,u=ee+E+65535,E=Math.floor(u/65536),ee=u-E*65536,u=ge+E+65535,E=Math.floor(u/65536),ge=u-E*65536,u=be+E+65535,E=Math.floor(u/65536),be=u-E*65536,u=Ne+E+65535,E=Math.floor(u/65536),Ne=u-E*65536,u=Fe+E+65535,E=Math.floor(u/65536),Fe=u-E*65536,u=Se+E+65535,E=Math.floor(u/65536),Se=u-E*65536,u=xt+E+65535,E=Math.floor(u/65536),xt=u-E*65536,u=mt+E+65535,E=Math.floor(u/65536),mt=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=Le+E+65535,E=Math.floor(u/65536),Le=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Xe+E+65535,E=Math.floor(u/65536),Xe=u-E*65536,u=at+E+65535,E=Math.floor(u/65536),at=u-E*65536,u=Ue+E+65535,E=Math.floor(u/65536),Ue=u-E*65536,u=Ze+E+65535,E=Math.floor(u/65536),Ze=u-E*65536,u=De+E+65535,E=Math.floor(u/65536),De=u-E*65536,ee+=E-1+37*(E-1),E=1,u=ee+E+65535,E=Math.floor(u/65536),ee=u-E*65536,u=ge+E+65535,E=Math.floor(u/65536),ge=u-E*65536,u=be+E+65535,E=Math.floor(u/65536),be=u-E*65536,u=Ne+E+65535,E=Math.floor(u/65536),Ne=u-E*65536,u=Fe+E+65535,E=Math.floor(u/65536),Fe=u-E*65536,u=Se+E+65535,E=Math.floor(u/65536),Se=u-E*65536,u=xt+E+65535,E=Math.floor(u/65536),xt=u-E*65536,u=mt+E+65535,E=Math.floor(u/65536),mt=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=Le+E+65535,E=Math.floor(u/65536),Le=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Xe+E+65535,E=Math.floor(u/65536),Xe=u-E*65536,u=at+E+65535,E=Math.floor(u/65536),at=u-E*65536,u=Ue+E+65535,E=Math.floor(u/65536),Ue=u-E*65536,u=Ze+E+65535,E=Math.floor(u/65536),Ze=u-E*65536,u=De+E+65535,E=Math.floor(u/65536),De=u-E*65536,ee+=E-1+37*(E-1),F[0]=ee,F[1]=ge,F[2]=be,F[3]=Ne,F[4]=Fe,F[5]=Se,F[6]=xt,F[7]=mt,F[8]=ot,F[9]=Le,F[10]=Ye,F[11]=Xe,F[12]=at,F[13]=Ue,F[14]=Ze,F[15]=De}function W(F,D){U(F,D,D)}function ve(F,D){const R=o();let u;for(u=0;u<16;u++)R[u]=D[u];for(u=253;u>=0;u--)W(R,R),u!==2&&u!==4&&U(R,R,D);for(u=0;u<16;u++)F[u]=R[u]}function ie(F,D){const R=o();let u;for(u=0;u<16;u++)R[u]=D[u];for(u=250;u>=0;u--)W(R,R),u!==1&&U(R,R,D);for(u=0;u<16;u++)F[u]=R[u]}function ue(F,D){const R=o(),u=o(),E=o(),ee=o(),ge=o(),be=o(),Ne=o(),Fe=o(),Se=o();$(R,F[1],F[0]),$(Se,D[1],D[0]),U(R,R,Se),de(u,F[0],F[1]),de(Se,D[0],D[1]),U(u,u,Se),U(E,F[3],D[3]),U(E,E,m),U(ee,F[2],D[2]),de(ee,ee,ee),$(ge,u,R),$(be,ee,E),de(Ne,ee,E),de(Fe,u,R),U(F[0],ge,be),U(F[1],Fe,Ne),U(F[2],Ne,be),U(F[3],ge,Fe)}function Te(F,D,R){for(let u=0;u<4;u++)K(F[u],D[u],R)}function ze(F,D){const R=o(),u=o(),E=o();ve(E,D[2]),U(R,D[0],E),U(u,D[1],E),re(F,u),F[31]^=fe(R)<<7}function v(F,D,R){j(F[0],d),j(F[1],g),j(F[2],g),j(F[3],d);for(let u=255;u>=0;--u){const E=R[u/8|0]>>(u&7)&1;Te(F,D,E),ue(D,F),ue(F,F),Te(F,D,E)}}function I(F,D){const R=[o(),o(),o(),o()];j(R[0],x),j(R[1],O),j(R[2],g),U(R[3],x,O),v(F,R,D)}function Y(F){if(F.length!==c.SEED_LENGTH)throw new Error(`ed25519: seed must be ${c.SEED_LENGTH} bytes`);const D=(0,i.hash)(F);D[0]&=248,D[31]&=127,D[31]|=64;const R=new Uint8Array(32),u=[o(),o(),o(),o()];I(u,D),ze(R,u);const E=new Uint8Array(64);return E.set(F),E.set(R,32),{publicKey:R,secretKey:E}}c.generateKeyPairFromSeed=Y;function ce(F){const D=(0,r.randomBytes)(32,F),R=Y(D);return(0,n.wipe)(D),R}c.generateKeyPair=ce;function V(F){if(F.length!==c.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${c.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(F.subarray(32))}c.extractPublicKeyFromSecretKey=V;const H=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function k(F,D){let R,u,E,ee;for(u=63;u>=32;--u){for(R=0,E=u-32,ee=u-12;E<ee;++E)D[E]+=R-16*D[u]*H[E-(u-32)],R=Math.floor((D[E]+128)/256),D[E]-=R*256;D[E]+=R,D[u]=0}for(R=0,E=0;E<32;E++)D[E]+=R-(D[31]>>4)*H[E],R=D[E]>>8,D[E]&=255;for(E=0;E<32;E++)D[E]-=R*H[E];for(u=0;u<32;u++)D[u+1]+=D[u]>>8,F[u]=D[u]&255}function G(F){const D=new Float64Array(64);for(let R=0;R<64;R++)D[R]=F[R];for(let R=0;R<64;R++)F[R]=0;k(F,D)}function Je(F,D){const R=new Float64Array(64),u=[o(),o(),o(),o()],E=(0,i.hash)(F.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const ee=new Uint8Array(64);ee.set(E.subarray(32),32);const ge=new i.SHA512;ge.update(ee.subarray(32)),ge.update(D);const be=ge.digest();ge.clean(),G(be),I(u,be),ze(ee,u),ge.reset(),ge.update(ee.subarray(0,32)),ge.update(F.subarray(32)),ge.update(D);const Ne=ge.digest();G(Ne);for(let Fe=0;Fe<32;Fe++)R[Fe]=be[Fe];for(let Fe=0;Fe<32;Fe++)for(let Se=0;Se<32;Se++)R[Fe+Se]+=Ne[Fe]*E[Se];return k(ee.subarray(32),R),ee}c.sign=Je;function Be(F,D){const R=o(),u=o(),E=o(),ee=o(),ge=o(),be=o(),Ne=o();return j(F[2],g),pe(F[1],D),W(E,F[1]),U(ee,E,_),$(E,E,F[2]),de(ee,F[2],ee),W(ge,ee),W(be,ge),U(Ne,be,ge),U(R,Ne,E),U(R,R,ee),ie(R,R),U(R,R,E),U(R,R,ee),U(R,R,ee),U(F[0],R,ee),W(u,F[0]),U(u,u,ee),le(u,E)&&U(F[0],F[0],N),W(u,F[0]),U(u,u,ee),le(u,E)?-1:(fe(F[0])===D[31]>>7&&$(F[0],d,F[0]),U(F[3],F[0],F[1]),0)}function Mr(F,D,R){const u=new Uint8Array(32),E=[o(),o(),o(),o()],ee=[o(),o(),o(),o()];if(R.length!==c.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${c.SIGNATURE_LENGTH} bytes`);if(Be(ee,F))return!1;const ge=new i.SHA512;ge.update(R.subarray(0,32)),ge.update(F),ge.update(D);const be=ge.digest();return G(be),v(E,ee,be),I(ee,R.subarray(32)),ue(E,ee),ze(u,E),!he(R,u)}c.verify=Mr;function Ie(F){let D=[o(),o(),o(),o()];if(Be(D,F))throw new Error("Ed25519: invalid public key");let R=o(),u=o(),E=D[1];de(R,g,E),$(u,g,E),ve(u,u),U(R,R,u);let ee=new Uint8Array(32);return re(ee,R),ee}c.convertPublicKeyToX25519=Ie;function It(F){const D=(0,i.hash)(F.subarray(0,32));D[0]&=248,D[31]&=127,D[31]|=64;const R=new Uint8Array(D.subarray(0,32));return(0,n.wipe)(D),R}c.convertSecretKeyToX25519=It})(Ic);const J1="EdDSA",Q1="JWT",tf=".",rf="base64url",Y1="utf8",X1="utf8",Z1=":",ew="did",tw="key",Qh="base58btc",rw="z",iw="K36",sw=32;function vo(c){return _o(bc(Bi(c),Y1),rf)}function sf(c){const r=bc(iw,Qh),i=rw+_o(fm([r,c]),Qh);return[ew,tw,i].join(Z1)}function nw(c){return _o(c,rf)}function ow(c){return bc([vo(c.header),vo(c.payload)].join(tf),X1)}function aw(c){return[vo(c.header),vo(c.payload),nw(c.signature)].join(tf)}function Yh(c=Ul.randomBytes(sw)){return Ic.generateKeyPairFromSeed(c)}async function cw(c,r,i,n,o=se.fromMiliseconds(Date.now())){const h={alg:J1,typ:Q1},d=sf(n.publicKey),g=o+i,_={iss:d,sub:c,aud:r,iat:o,exp:g},m=ow({header:h,payload:_}),x=Ic.sign(n.secretKey,m);return aw({header:h,payload:_,signature:x})}const uw="PARSE_ERROR",hw="INVALID_REQUEST",lw="METHOD_NOT_FOUND",fw="INVALID_PARAMS",nf="INTERNAL_ERROR",xc="SERVER_ERROR",pw=[-32700,-32600,-32601,-32602,-32603],Js={[uw]:{code:-32700,message:"Parse error"},[hw]:{code:-32600,message:"Invalid Request"},[lw]:{code:-32601,message:"Method not found"},[fw]:{code:-32602,message:"Invalid params"},[nf]:{code:-32603,message:"Internal error"},[xc]:{code:-32e3,message:"Server error"}},of=xc;function dw(c){return pw.includes(c)}function Xh(c){return Object.keys(Js).includes(c)?Js[c]:Js[of]}function gw(c){const r=Object.values(Js).find(i=>i.code===c);return r||Js[of]}function af(c,r,i){return c.message.includes("getaddrinfo ENOTFOUND")||c.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${r}`):c}var cf={},si={},Zh;function yw(){if(Zh)return si;Zh=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowserCryptoAvailable=si.getSubtleCrypto=si.getBrowerCrypto=void 0;function c(){return(qr===null||qr===void 0?void 0:qr.crypto)||(qr===null||qr===void 0?void 0:qr.msCrypto)||{}}si.getBrowerCrypto=c;function r(){const n=c();return n.subtle||n.webkitSubtle}si.getSubtleCrypto=r;function i(){return!!c()&&!!r()}return si.isBrowserCryptoAvailable=i,si}var ni={},el;function vw(){if(el)return ni;el=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.isBrowser=ni.isNode=ni.isReactNative=void 0;function c(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}ni.isReactNative=c;function r(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}ni.isNode=r;function i(){return!c()&&!r()}return ni.isBrowser=i,ni}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=ms;r.__exportStar(yw(),c),r.__exportStar(vw(),c)})(cf);function Pc(c=3){const r=Date.now()*Math.pow(10,c),i=Math.floor(Math.random()*Math.pow(10,c));return r+i}function uf(c=6){return BigInt(Pc(c))}function ys(c,r,i){return{id:i||Pc(),jsonrpc:"2.0",method:c,params:r}}function Sc(c,r){return{id:c,jsonrpc:"2.0",result:r}}function bo(c,r,i){return{id:c,jsonrpc:"2.0",error:mw(r,i)}}function mw(c,r){return typeof c>"u"?Xh(nf):(typeof c=="string"&&(c=Object.assign(Object.assign({},Xh(xc)),{message:c})),typeof r<"u"&&(c.data=r),dw(c.code)&&(c=gw(c.code)),c)}class ww{}class _w extends ww{constructor(){super()}}class bw extends _w{constructor(r){super()}}const Ew="^https?:",Iw="^wss?:";function xw(c){const r=c.match(new RegExp(/^\w+:/,"gi"));if(!(!r||!r.length))return r[0]}function hf(c,r){const i=xw(c);return typeof i>"u"?!1:new RegExp(r).test(i)}function tl(c){return hf(c,Ew)}function rl(c){return hf(c,Iw)}function Pw(c){return new RegExp("wss?://localhost(:d{2,5})?").test(c)}function lf(c){return typeof c=="object"&&"id"in c&&"jsonrpc"in c&&c.jsonrpc==="2.0"}function Ac(c){return lf(c)&&"method"in c}function Eo(c){return lf(c)&&(ci(c)||Lr(c))}function ci(c){return"result"in c}function Lr(c){return"error"in c}class ui extends bw{constructor(r){super(r),this.events=new Ar.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async request(r,i){return this.requestStrict(ys(r.method,r.params||[],r.id||uf().toString()),i)}async requestStrict(r,i){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(h){o(h)}this.events.on(`${r.id}`,h=>{Lr(h)?o(h.error):n(h.result)});try{await this.connection.send(r,i)}catch(h){o(h)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),Eo(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Sw=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Aw=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",il=c=>c.split("?")[0],sl=10,Rw=Sw();class Ow{constructor(r){if(this.url=r,this.events=new Ar.EventEmitter,this.registering=!1,!rl(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r,i){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Bi(r))}catch(n){this.onError(r.id,n)}}register(r=this.url){if(!rl(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((i,n)=>{const o=cf.isReactNative()?void 0:{rejectUnauthorized:!Pw(r)},h=new Rw(r,[],o);Aw()?h.onerror=d=>{const g=d;n(this.emitError(g.error))}:h.on("error",d=>{n(this.emitError(d))}),h.onopen=()=>{this.onOpen(h),i(h)}})}onOpen(r){r.onmessage=i=>this.onPayload(i),r.onclose=i=>this.onClose(i),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Xs(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=bo(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return af(r,il(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>sl&&this.events.setMaxListeners(sl)}emitError(r){const i=this.parseError(new Error((r==null?void 0:r.message)||`WebSocket connection failed for host: ${il(this.url)}`));return this.events.emit("register_error",i),i}}var mo={exports:{}};mo.exports;(function(c,r){var i=200,n="__lodash_hash_undefined__",o=1,h=2,d=9007199254740991,g="[object Arguments]",_="[object Array]",m="[object AsyncFunction]",x="[object Boolean]",O="[object Date]",N="[object Error]",j="[object Function]",C="[object GeneratorFunction]",K="[object Map]",re="[object Number]",he="[object Null]",le="[object Object]",fe="[object Promise]",pe="[object Proxy]",de="[object RegExp]",$="[object Set]",U="[object String]",W="[object Symbol]",ve="[object Undefined]",ie="[object WeakMap]",ue="[object ArrayBuffer]",Te="[object DataView]",ze="[object Float32Array]",v="[object Float64Array]",I="[object Int8Array]",Y="[object Int16Array]",ce="[object Int32Array]",V="[object Uint8Array]",H="[object Uint8ClampedArray]",k="[object Uint16Array]",G="[object Uint32Array]",Je=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,Mr=/^(?:0|[1-9]\d*)$/,Ie={};Ie[ze]=Ie[v]=Ie[I]=Ie[Y]=Ie[ce]=Ie[V]=Ie[H]=Ie[k]=Ie[G]=!0,Ie[g]=Ie[_]=Ie[ue]=Ie[x]=Ie[Te]=Ie[O]=Ie[N]=Ie[j]=Ie[K]=Ie[re]=Ie[le]=Ie[de]=Ie[$]=Ie[U]=Ie[ie]=!1;var It=typeof qr=="object"&&qr&&qr.Object===Object&&qr,F=typeof self=="object"&&self&&self.Object===Object&&self,D=It||F||Function("return this")(),R=r&&!r.nodeType&&r,u=R&&!0&&c&&!c.nodeType&&c,E=u&&u.exports===R,ee=E&&It.process,ge=function(){try{return ee&&ee.binding&&ee.binding("util")}catch{}}(),be=ge&&ge.isTypedArray;function Ne(y,P){for(var z=-1,Q=y==null?0:y.length,Ve=0,me=[];++z<Q;){var et=y[z];P(et,z,y)&&(me[Ve++]=et)}return me}function Fe(y,P){for(var z=-1,Q=P.length,Ve=y.length;++z<Q;)y[Ve+z]=P[z];return y}function Se(y,P){for(var z=-1,Q=y==null?0:y.length;++z<Q;)if(P(y[z],z,y))return!0;return!1}function xt(y,P){for(var z=-1,Q=Array(y);++z<y;)Q[z]=P(z);return Q}function mt(y){return function(P){return y(P)}}function ot(y,P){return y.has(P)}function Le(y,P){return y==null?void 0:y[P]}function Ye(y){var P=-1,z=Array(y.size);return y.forEach(function(Q,Ve){z[++P]=[Ve,Q]}),z}function Xe(y,P){return function(z){return y(P(z))}}function at(y){var P=-1,z=Array(y.size);return y.forEach(function(Q){z[++P]=Q}),z}var Ue=Array.prototype,Ze=Function.prototype,De=Object.prototype,ke=D["__core-js_shared__"],ht=Ze.toString,Me=De.hasOwnProperty,Pt=function(){var y=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Ft=De.toString,Ut=RegExp("^"+ht.call(Me).replace(Je,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=E?D.Buffer:void 0,qt=D.Symbol,Wt=D.Uint8Array,rr=De.propertyIsEnumerable,jr=Ue.splice,Jt=qt?qt.toStringTag:void 0,Vr=Object.getOwnPropertySymbols,li=Ht?Ht.isBuffer:void 0,Ai=Xe(Object.keys,Object),lt=lr(D,"DataView"),rt=lr(D,"Map"),ft=lr(D,"Promise"),pt=lr(D,"Set"),ct=lr(D,"WeakMap"),it=lr(Object,"create"),St=Wr(lt),At=Wr(rt),dt=Wr(ft),Rt=Wr(pt),gt=Wr(ct),wt=qt?qt.prototype:void 0,yt=wt?wt.valueOf:void 0;function Qe(y){var P=-1,z=y==null?0:y.length;for(this.clear();++P<z;){var Q=y[P];this.set(Q[0],Q[1])}}function Ot(){this.__data__=it?it(null):{},this.size=0}function Ct(y){var P=this.has(y)&&delete this.__data__[y];return this.size-=P?1:0,P}function Po(y){var P=this.__data__;if(it){var z=P[y];return z===n?void 0:z}return Me.call(P,y)?P[y]:void 0}function So(y){var P=this.__data__;return it?P[y]!==void 0:Me.call(P,y)}function Ao(y,P){var z=this.__data__;return this.size+=this.has(y)?0:1,z[y]=it&&P===void 0?n:P,this}Qe.prototype.clear=Ot,Qe.prototype.delete=Ct,Qe.prototype.get=Po,Qe.prototype.has=So,Qe.prototype.set=Ao;function vr(y){var P=-1,z=y==null?0:y.length;for(this.clear();++P<z;){var Q=y[P];this.set(Q[0],Q[1])}}function Ro(){this.__data__=[],this.size=0}function Oo(y){var P=this.__data__,z=Ri(P,y);if(z<0)return!1;var Q=P.length-1;return z==Q?P.pop():jr.call(P,z,1),--this.size,!0}function Co(y){var P=this.__data__,z=Ri(P,y);return z<0?void 0:P[z][1]}function To(y){return Ri(this.__data__,y)>-1}function No(y,P){var z=this.__data__,Q=Ri(z,y);return Q<0?(++this.size,z.push([y,P])):z[Q][1]=P,this}vr.prototype.clear=Ro,vr.prototype.delete=Oo,vr.prototype.get=Co,vr.prototype.has=To,vr.prototype.set=No;function Gr(y){var P=-1,z=y==null?0:y.length;for(this.clear();++P<z;){var Q=y[P];this.set(Q[0],Q[1])}}function Gi(){this.size=0,this.__data__={hash:new Qe,map:new(rt||vr),string:new Qe}}function Do(y){var P=fi(this,y).delete(y);return this.size-=P?1:0,P}function Wi(y){return fi(this,y).get(y)}function Fo(y){return fi(this,y).has(y)}function $o(y,P){var z=fi(this,y),Q=z.size;return z.set(y,P),this.size+=z.size==Q?0:1,this}Gr.prototype.clear=Gi,Gr.prototype.delete=Do,Gr.prototype.get=Wi,Gr.prototype.has=Fo,Gr.prototype.set=$o;function Ji(y){var P=-1,z=y==null?0:y.length;for(this.__data__=new Gr;++P<z;)this.add(y[P])}function en(y){return this.__data__.set(y,n),this}function tn(y){return this.__data__.has(y)}Ji.prototype.add=Ji.prototype.push=en,Ji.prototype.has=tn;function Rr(y){var P=this.__data__=new vr(y);this.size=P.size}function Lo(){this.__data__=new vr,this.size=0}function qo(y){var P=this.__data__,z=P.delete(y);return this.size=P.size,z}function Mo(y){return this.__data__.get(y)}function jo(y){return this.__data__.has(y)}function rn(y,P){var z=this.__data__;if(z instanceof vr){var Q=z.__data__;if(!rt||Q.length<i-1)return Q.push([y,P]),this.size=++z.size,this;z=this.__data__=new Gr(Q)}return z.set(y,P),this.size=z.size,this}Rr.prototype.clear=Lo,Rr.prototype.delete=qo,Rr.prototype.get=Mo,Rr.prototype.has=jo,Rr.prototype.set=rn;function sn(y,P){var z=Xi(y),Q=!z&&yn(y),Ve=!z&&!Q&&Es(y),me=!z&&!Q&&!Ve&&wn(y),et=z||Q||Ve||me,Tt=et?xt(y.length,String):[],Re=Tt.length;for(var Ge in y)(P||Me.call(y,Ge))&&!(et&&(Ge=="length"||Ve&&(Ge=="offset"||Ge=="parent")||me&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||ln(Ge,Re)))&&Tt.push(Ge);return Tt}function Ri(y,P){for(var z=y.length;z--;)if(gn(y[z][0],P))return z;return-1}function _s(y,P,z){var Q=P(y);return Xi(y)?Q:Fe(Q,z(y))}function Oi(y){return y==null?y===void 0?ve:he:Jt&&Jt in Object(y)?un(y):Ho(y)}function bs(y){return Ti(y)&&Oi(y)==g}function Ci(y,P,z,Q,Ve){return y===P?!0:y==null||P==null||!Ti(y)&&!Ti(P)?y!==y&&P!==P:nn(y,P,z,Q,Ci,Ve)}function nn(y,P,z,Q,Ve,me){var et=Xi(y),Tt=Xi(P),Re=et?_:zr(y),Ge=Tt?_:zr(P);Re=Re==g?le:Re,Ge=Ge==g?le:Ge;var _t=Re==le,ir=Ge==le,Nt=Re==Ge;if(Nt&&Es(y)){if(!Es(P))return!1;et=!0,_t=!1}if(Nt&&!_t)return me||(me=new Rr),et||wn(y)?Qi(y,P,z,Q,Ve,me):Uo(y,P,Re,z,Q,Ve,me);if(!(z&o)){var tt=_t&&Me.call(y,"__wrapped__"),Qt=ir&&Me.call(P,"__wrapped__");if(tt||Qt){var Or=tt?y.value():y,mr=Qt?P.value():P;return me||(me=new Rr),Ve(Or,mr,z,Q,me)}}return Nt?(me||(me=new Rr),cn(y,P,z,Q,Ve,me)):!1}function zo(y){if(!mn(y)||pn(y))return!1;var P=Zi(y)?Ut:Be;return P.test(Wr(y))}function on(y){return Ti(y)&&vn(y.length)&&!!Ie[Oi(y)]}function an(y){if(!dn(y))return Ai(y);var P=[];for(var z in Object(y))Me.call(y,z)&&z!="constructor"&&P.push(z);return P}function Qi(y,P,z,Q,Ve,me){var et=z&o,Tt=y.length,Re=P.length;if(Tt!=Re&&!(et&&Re>Tt))return!1;var Ge=me.get(y);if(Ge&&me.get(P))return Ge==P;var _t=-1,ir=!0,Nt=z&h?new Ji:void 0;for(me.set(y,P),me.set(P,y);++_t<Tt;){var tt=y[_t],Qt=P[_t];if(Q)var Or=et?Q(Qt,tt,_t,P,y,me):Q(tt,Qt,_t,y,P,me);if(Or!==void 0){if(Or)continue;ir=!1;break}if(Nt){if(!Se(P,function(mr,Ur){if(!ot(Nt,Ur)&&(tt===mr||Ve(tt,mr,z,Q,me)))return Nt.push(Ur)})){ir=!1;break}}else if(!(tt===Qt||Ve(tt,Qt,z,Q,me))){ir=!1;break}}return me.delete(y),me.delete(P),ir}function Uo(y,P,z,Q,Ve,me,et){switch(z){case Te:if(y.byteLength!=P.byteLength||y.byteOffset!=P.byteOffset)return!1;y=y.buffer,P=P.buffer;case ue:return!(y.byteLength!=P.byteLength||!me(new Wt(y),new Wt(P)));case x:case O:case re:return gn(+y,+P);case N:return y.name==P.name&&y.message==P.message;case de:case U:return y==P+"";case K:var Tt=Ye;case $:var Re=Q&o;if(Tt||(Tt=at),y.size!=P.size&&!Re)return!1;var Ge=et.get(y);if(Ge)return Ge==P;Q|=h,et.set(y,P);var _t=Qi(Tt(y),Tt(P),Q,Ve,me,et);return et.delete(y),_t;case W:if(yt)return yt.call(y)==yt.call(P)}return!1}function cn(y,P,z,Q,Ve,me){var et=z&o,Tt=Yi(y),Re=Tt.length,Ge=Yi(P),_t=Ge.length;if(Re!=_t&&!et)return!1;for(var ir=Re;ir--;){var Nt=Tt[ir];if(!(et?Nt in P:Me.call(P,Nt)))return!1}var tt=me.get(y);if(tt&&me.get(P))return tt==P;var Qt=!0;me.set(y,P),me.set(P,y);for(var Or=et;++ir<Re;){Nt=Tt[ir];var mr=y[Nt],Ur=P[Nt];if(Q)var Is=et?Q(Ur,mr,Nt,P,y,me):Q(mr,Ur,Nt,y,P,me);if(!(Is===void 0?mr===Ur||Ve(mr,Ur,z,Q,me):Is)){Qt=!1;break}Or||(Or=Nt=="constructor")}if(Qt&&!Or){var Ni=y.constructor,Mt=P.constructor;Ni!=Mt&&"constructor"in y&&"constructor"in P&&!(typeof Ni=="function"&&Ni instanceof Ni&&typeof Mt=="function"&&Mt instanceof Mt)&&(Qt=!1)}return me.delete(y),me.delete(P),Qt}function Yi(y){return _s(y,Ko,hn)}function fi(y,P){var z=y.__data__;return fn(P)?z[typeof P=="string"?"string":"hash"]:z.map}function lr(y,P){var z=Le(y,P);return zo(z)?z:void 0}function un(y){var P=Me.call(y,Jt),z=y[Jt];try{y[Jt]=void 0;var Q=!0}catch{}var Ve=Ft.call(y);return Q&&(P?y[Jt]=z:delete y[Jt]),Ve}var hn=Vr?function(y){return y==null?[]:(y=Object(y),Ne(Vr(y),function(P){return rr.call(y,P)}))}:Ke,zr=Oi;(lt&&zr(new lt(new ArrayBuffer(1)))!=Te||rt&&zr(new rt)!=K||ft&&zr(ft.resolve())!=fe||pt&&zr(new pt)!=$||ct&&zr(new ct)!=ie)&&(zr=function(y){var P=Oi(y),z=P==le?y.constructor:void 0,Q=z?Wr(z):"";if(Q)switch(Q){case St:return Te;case At:return K;case dt:return fe;case Rt:return $;case gt:return ie}return P});function ln(y,P){return P=P??d,!!P&&(typeof y=="number"||Mr.test(y))&&y>-1&&y%1==0&&y<P}function fn(y){var P=typeof y;return P=="string"||P=="number"||P=="symbol"||P=="boolean"?y!=="__proto__":y===null}function pn(y){return!!Pt&&Pt in y}function dn(y){var P=y&&y.constructor,z=typeof P=="function"&&P.prototype||De;return y===z}function Ho(y){return Ft.call(y)}function Wr(y){if(y!=null){try{return ht.call(y)}catch{}try{return y+""}catch{}}return""}function gn(y,P){return y===P||y!==y&&P!==P}var yn=bs(function(){return arguments}())?bs:function(y){return Ti(y)&&Me.call(y,"callee")&&!rr.call(y,"callee")},Xi=Array.isArray;function Bo(y){return y!=null&&vn(y.length)&&!Zi(y)}var Es=li||He;function ko(y,P){return Ci(y,P)}function Zi(y){if(!mn(y))return!1;var P=Oi(y);return P==j||P==C||P==m||P==pe}function vn(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=d}function mn(y){var P=typeof y;return y!=null&&(P=="object"||P=="function")}function Ti(y){return y!=null&&typeof y=="object"}var wn=be?mt(be):on;function Ko(y){return Bo(y)?sn(y):an(y)}function Ke(){return[]}function He(){return!1}c.exports=ko})(mo,mo.exports);var Cw=mo.exports;const Tw=Hl(Cw);function Nw(c,r){if(c.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<c.length;o++){var h=c.charAt(o),d=h.charCodeAt(0);if(i[d]!==255)throw new TypeError(h+" is ambiguous");i[d]=o}var g=c.length,_=c.charAt(0),m=Math.log(g)/Math.log(256),x=Math.log(256)/Math.log(g);function O(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var K=0,re=0,he=0,le=C.length;he!==le&&C[he]===0;)he++,K++;for(var fe=(le-he)*x+1>>>0,pe=new Uint8Array(fe);he!==le;){for(var de=C[he],$=0,U=fe-1;(de!==0||$<re)&&U!==-1;U--,$++)de+=256*pe[U]>>>0,pe[U]=de%g>>>0,de=de/g>>>0;if(de!==0)throw new Error("Non-zero carry");re=$,he++}for(var W=fe-re;W!==fe&&pe[W]===0;)W++;for(var ve=_.repeat(K);W<fe;++W)ve+=c.charAt(pe[W]);return ve}function N(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var K=0;if(C[K]!==" "){for(var re=0,he=0;C[K]===_;)re++,K++;for(var le=(C.length-K)*m+1>>>0,fe=new Uint8Array(le);C[K];){var pe=i[C.charCodeAt(K)];if(pe===255)return;for(var de=0,$=le-1;(pe!==0||de<he)&&$!==-1;$--,de++)pe+=g*fe[$]>>>0,fe[$]=pe%256>>>0,pe=pe/256>>>0;if(pe!==0)throw new Error("Non-zero carry");he=de,K++}if(C[K]!==" "){for(var U=le-he;U!==le&&fe[U]===0;)U++;for(var W=new Uint8Array(re+(le-U)),ve=re;U!==le;)W[ve++]=fe[U++];return W}}}function j(C){var K=N(C);if(K)return K;throw new Error(`Non-${r} character`)}return{encode:O,decodeUnsafe:N,decode:j}}var Dw=Nw,Fw=Dw;const ff=c=>{if(c instanceof Uint8Array&&c.constructor.name==="Uint8Array")return c;if(c instanceof ArrayBuffer)return new Uint8Array(c);if(ArrayBuffer.isView(c))return new Uint8Array(c.buffer,c.byteOffset,c.byteLength);throw new Error("Unknown type, must be binary type")},$w=c=>new TextEncoder().encode(c),Lw=c=>new TextDecoder().decode(c);class qw{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Mw{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return pf(this,r)}}class jw{constructor(r){this.decoders=r}or(r){return pf(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pf=(c,r)=>new jw({...c.decoders||{[c.prefix]:c},...r.decoders||{[r.prefix]:r}});class zw{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new qw(r,i,n),this.decoder=new Mw(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const Io=({name:c,prefix:r,encode:i,decode:n})=>new zw(c,r,i,n),Zs=({prefix:c,name:r,alphabet:i})=>{const{encode:n,decode:o}=Fw(i,r);return Io({prefix:c,name:r,encode:n,decode:h=>ff(o(h))})},Uw=(c,r,i,n)=>{const o={};for(let x=0;x<r.length;++x)o[r[x]]=x;let h=c.length;for(;c[h-1]==="=";)--h;const d=new Uint8Array(h*i/8|0);let g=0,_=0,m=0;for(let x=0;x<h;++x){const O=o[c[x]];if(O===void 0)throw new SyntaxError(`Non-${n} character`);_=_<<i|O,g+=i,g>=8&&(g-=8,d[m++]=255&_>>g)}if(g>=i||255&_<<8-g)throw new SyntaxError("Unexpected end of data");return d},Hw=(c,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let h="",d=0,g=0;for(let _=0;_<c.length;++_)for(g=g<<8|c[_],d+=8;d>i;)d-=i,h+=r[o&g>>d];if(d&&(h+=r[o&g<<i-d]),n)for(;h.length*i&7;)h+="=";return h},kt=({name:c,prefix:r,bitsPerChar:i,alphabet:n})=>Io({prefix:r,name:c,encode(o){return Hw(o,n,i)},decode(o){return Uw(o,n,i,c)}}),Bw=Io({prefix:"\0",name:"identity",encode:c=>Lw(c),decode:c=>$w(c)});var kw=Object.freeze({__proto__:null,identity:Bw});const Kw=kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Vw=Object.freeze({__proto__:null,base2:Kw});const Gw=kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ww=Object.freeze({__proto__:null,base8:Gw});const Jw=Zs({prefix:"9",name:"base10",alphabet:"0123456789"});var Qw=Object.freeze({__proto__:null,base10:Jw});const Yw=kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xw=kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Zw=Object.freeze({__proto__:null,base16:Yw,base16upper:Xw});const e_=kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),t_=kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),r_=kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),i_=kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),s_=kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),n_=kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),o_=kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),a_=kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),c_=kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var u_=Object.freeze({__proto__:null,base32:e_,base32upper:t_,base32pad:r_,base32padupper:i_,base32hex:s_,base32hexupper:n_,base32hexpad:o_,base32hexpadupper:a_,base32z:c_});const h_=Zs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),l_=Zs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var f_=Object.freeze({__proto__:null,base36:h_,base36upper:l_});const p_=Zs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),d_=Zs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var g_=Object.freeze({__proto__:null,base58btc:p_,base58flickr:d_});const y_=kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),v_=kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),m_=kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),w_=kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var __=Object.freeze({__proto__:null,base64:y_,base64pad:v_,base64url:m_,base64urlpad:w_});const df=Array.from(""),b_=df.reduce((c,r,i)=>(c[i]=r,c),[]),E_=df.reduce((c,r,i)=>(c[r.codePointAt(0)]=i,c),[]);function I_(c){return c.reduce((r,i)=>(r+=b_[i],r),"")}function x_(c){const r=[];for(const i of c){const n=E_[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const P_=Io({prefix:"",name:"base256emoji",encode:I_,decode:x_});var S_=Object.freeze({__proto__:null,base256emoji:P_}),A_=gf,nl=128,R_=127,O_=~R_,C_=Math.pow(2,31);function gf(c,r,i){r=r||[],i=i||0;for(var n=i;c>=C_;)r[i++]=c&255|nl,c/=128;for(;c&O_;)r[i++]=c&255|nl,c>>>=7;return r[i]=c|0,gf.bytes=i-n+1,r}var T_=gc,N_=128,ol=127;function gc(c,n){var i=0,n=n||0,o=0,h=n,d,g=c.length;do{if(h>=g)throw gc.bytes=0,new RangeError("Could not decode varint");d=c[h++],i+=o<28?(d&ol)<<o:(d&ol)*Math.pow(2,o),o+=7}while(d>=N_);return gc.bytes=h-n,i}var D_=Math.pow(2,7),F_=Math.pow(2,14),$_=Math.pow(2,21),L_=Math.pow(2,28),q_=Math.pow(2,35),M_=Math.pow(2,42),j_=Math.pow(2,49),z_=Math.pow(2,56),U_=Math.pow(2,63),H_=function(c){return c<D_?1:c<F_?2:c<$_?3:c<L_?4:c<q_?5:c<M_?6:c<j_?7:c<z_?8:c<U_?9:10},B_={encode:A_,decode:T_,encodingLength:H_},yf=B_;const al=(c,r,i=0)=>(yf.encode(c,r,i),r),cl=c=>yf.encodingLength(c),yc=(c,r)=>{const i=r.byteLength,n=cl(c),o=n+cl(i),h=new Uint8Array(o+i);return al(c,h,0),al(i,h,n),h.set(r,o),new k_(c,i,r,h)};class k_{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const vf=({name:c,code:r,encode:i})=>new K_(c,r,i);class K_{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?yc(this.code,i):i.then(n=>yc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const mf=c=>async r=>new Uint8Array(await crypto.subtle.digest(c,r)),V_=vf({name:"sha2-256",code:18,encode:mf("SHA-256")}),G_=vf({name:"sha2-512",code:19,encode:mf("SHA-512")});var W_=Object.freeze({__proto__:null,sha256:V_,sha512:G_});const wf=0,J_="identity",_f=ff,Q_=c=>yc(wf,_f(c)),Y_={code:wf,name:J_,encode:_f,digest:Q_};var X_=Object.freeze({__proto__:null,identity:Y_});new TextEncoder,new TextDecoder;const ul={...kw,...Vw,...Ww,...Qw,...Zw,...u_,...f_,...g_,...__,...S_};({...W_,...X_});function bf(c){return globalThis.Buffer!=null?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):c}function Z_(c=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?bf(globalThis.Buffer.allocUnsafe(c)):new Uint8Array(c)}function Ef(c,r,i,n){return{name:c,prefix:r,encoder:{name:c,prefix:r,encode:i},decoder:{decode:n}}}const hl=Ef("utf8","u",c=>"u"+new TextDecoder("utf8").decode(c),c=>new TextEncoder().encode(c.substring(1))),ic=Ef("ascii","a",c=>{let r="a";for(let i=0;i<c.length;i++)r+=String.fromCharCode(c[i]);return r},c=>{c=c.substring(1);const r=Z_(c.length);for(let i=0;i<c.length;i++)r[i]=c.charCodeAt(i);return r}),eb={utf8:hl,"utf-8":hl,hex:ul.base16,latin1:ic,ascii:ic,binary:ic,...ul};function tb(c,r="utf8"){const i=eb[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?bf(globalThis.Buffer.from(c,"utf-8")):i.decoder.decode(`${i.prefix}${c}`)}const If="wc",rb=2,Rc="core",xi=`${If}@2:${Rc}:`,ib={name:Rc,logger:"error"},sb={database:":memory:"},nb="crypto",ll="client_ed25519_seed",ob=se.ONE_DAY,ab="keychain",cb="0.3",ub="messages",hb="0.3",lb=se.SIX_HOURS,fb="publisher",xf="irn",pb="error",Pf="wss://relay.walletconnect.com",fl="wss://relay.walletconnect.org",db="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},gb="_subscription",oi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},yb=se.ONE_SECOND,vb="2.10.2",mb=1e4,wb="0.3",_b="WALLETCONNECT_CLIENT_ID",Fr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},bb="subscription",Eb="0.3",Ib=se.FIVE_SECONDS*1e3,xb="pairing",Pb="0.3",Us={wc_pairingDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:se.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:se.ONE_DAY,prompt:!1,tag:0},res:{ttl:se.ONE_DAY,prompt:!1,tag:0}}},Gs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Sb="history",Ab="0.3",Rb="expirer",Sr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ob="0.3",sc="verify-api",yo="https://verify.walletconnect.com",pl="https://verify.walletconnect.org";class Cb{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=ab,this.version=cb,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Ce.generateChildLogger(i,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Vl(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Gl(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Tb{constructor(r,i,n){this.core=r,this.logger=i,this.name=nb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=Yh(o);return sf(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=gm();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=Yh(h),g=fc();return await cw(g,o,ob,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const g=this.getPrivateKey(o),_=ym(g,h);return this.setSymKey(_,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||vm(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const g=mm(d),_=Bi(h);if(Nh(g)){const N=g.senderPublicKey,j=g.receiverPublicKey;o=await this.generateSharedKey(N,j)}const m=this.getSymKey(o),{type:x,senderPublicKey:O}=g;return wm({type:x,symKey:m,message:_,senderPublicKey:O})},this.decode=async(o,h,d)=>{this.isInitialized();const g=_m(h,d);if(Nh(g)){const _=g.receiverPublicKey,m=g.senderPublicKey;o=await this.generateSharedKey(_,m)}try{const _=this.getSymKey(o),m=bm({symKey:_,encoded:h});return Xs(m)}catch(_){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(_)}},this.getPayloadType=o=>{const h=Dh(o);return Em(h.type)},this.getPayloadSenderPublicKey=o=>{const h=Dh(o);return h.senderPublicKey?_o(h.senderPublicKey,Im):void 0},this.core=r,this.logger=Ce.generateChildLogger(i,this.name),this.keychain=n||new Cb(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(ll)}catch{r=fc(),await this.keychain.set(ll,r)}return tb(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Nb extends z1{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=ub,this.version=hb,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=gs(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(n,d),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),d=gs(o);return typeof h[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(r,this.name),this.core=i}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Vl(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Gl(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Db extends U1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new Ar.EventEmitter,this.name=fb,this.queue=new Map,this.publishTimeout=se.toMiliseconds(se.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const g=(h==null?void 0:h.ttl)||lb,_=pc(h),m=(h==null?void 0:h.prompt)||!1,x=(h==null?void 0:h.tag)||0,O=(h==null?void 0:h.id)||uf().toString(),N={topic:n,message:o,opts:{ttl:g,relay:_,prompt:m,tag:x,id:O}},j=setTimeout(()=>this.queue.set(O,N),this.publishTimeout);try{await await Qs(this.rpcPublish(n,o,g,_,m,x,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Gt.publish,N)}catch(C){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=h==null?void 0:h.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue(O),C;return}finally{clearTimeout(j)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Ce.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(r,i,n,o,h,d,g){var _,m,x,O;const N={method:lo(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:d},id:g};return Ii((_=N.params)==null?void 0:_.prompt)&&((m=N.params)==null||delete m.prompt),Ii((x=N.params)==null?void 0:x.tag)&&((O=N.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(ws.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Fb{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(h=>h!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var $b=Object.defineProperty,Lb=Object.defineProperties,qb=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,Mb=Object.prototype.hasOwnProperty,jb=Object.prototype.propertyIsEnumerable,gl=(c,r,i)=>r in c?$b(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Hs=(c,r)=>{for(var i in r||(r={}))Mb.call(r,i)&&gl(c,i,r[i]);if(dl)for(var i of dl(r))jb.call(r,i)&&gl(c,i,r[i]);return c},nc=(c,r)=>Lb(c,qb(r));class zb extends k1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new Fb,this.events=new Ar.EventEmitter,this.name=bb,this.version=Eb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=pc(o),d={topic:n,relay:h};this.pending.set(n,d);const g=await this.rpcSubscribe(n,h);return this.onSubscribe(g,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),g}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,h)=>{const d=new se.Watch;d.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=Ib&&(clearInterval(g),d.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ce.generateChildLogger(i,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=pc(n);await this.rpcUnsubscribe(r,i,o);const h=tr("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:lo(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Qs(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return gs(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:lo(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Qs(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:lo(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,nc(Hs({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,Hs({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,Hs({},i)),this.topicMap.set(i.topic,r),this.events.emit(Fr.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(Fr.deleted,nc(Hs({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Fr.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Fr.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);vs(i)&&this.onBatchSubscribe(i.map((n,o)=>nc(Hs({},r[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(ws.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(Fr.created,async r=>{const i=Fr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Fr.deleted,async r=>{const i=Fr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var Ub=Object.defineProperty,yl=Object.getOwnPropertySymbols,Hb=Object.prototype.hasOwnProperty,Bb=Object.prototype.propertyIsEnumerable,vl=(c,r,i)=>r in c?Ub(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,kb=(c,r)=>{for(var i in r||(r={}))Hb.call(r,i)&&vl(c,i,r[i]);if(yl)for(var i of yl(r))Bb.call(r,i)&&vl(c,i,r[i]);return c};class Kb extends H1{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Ar.EventEmitter,this.name=db,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Gt.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(oi.payload,this.onPayloadHandler),this.provider.on(oi.connect,this.onConnectHandler),this.provider.on(oi.disconnect,this.onDisconnectHandler),this.provider.on(oi.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ce.generateChildLogger(r.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:r.logger||pb})),this.messages=new Nb(this.logger,r.core),this.subscriber=new zb(this,this.logger),this.publisher=new Db(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||Pf,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${fl}...`),await this.restartTransport(fl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},mb)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";if(o)return o;let h;const d=g=>{g.topic===r&&(this.subscriber.off(Fr.created,d),h())};return await Promise.all([new Promise(g=>{h=g,this.subscriber.on(Fr.created,d)}),new Promise(async g=>{o=await this.subscriber.subscribe(r,i),g()})]),o}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Qs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(Fr.resubscribed,()=>{i()})}),new Promise(async(i,n)=>{try{await Qs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}i()})])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.provider.events.emit(oi.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Fh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ui(new Ow(xm({sdkVersion:vb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const o=this.messages.has(i,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Ac(r)){if(!r.method.endsWith(gb))return;const i=r.params,{topic:n,message:o,publishedAt:h}=i.data,d={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(kb({type:"event",event:i.id},d)),this.events.emit(i.id,d),await this.acknowledgePayload(r),await this.onMessageEvent(d)}else Eo(r)&&this.events.emit(Gt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Gt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=Sc(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(oi.payload,this.onPayloadHandler),this.provider.off(oi.connect,this.onConnectHandler),this.provider.off(oi.disconnect,this.onDisconnectHandler),this.provider.off(oi.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let r=await Fh();Pm(async i=>{this.initialized&&r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},se.toMiliseconds(yb)))}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Vb=Object.defineProperty,ml=Object.getOwnPropertySymbols,Gb=Object.prototype.hasOwnProperty,Wb=Object.prototype.propertyIsEnumerable,wl=(c,r,i)=>r in c?Vb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,_l=(c,r)=>{for(var i in r||(r={}))Gb.call(r,i)&&wl(c,i,r[i]);if(ml)for(var i of ml(r))Wb.call(r,i)&&wl(c,i,r[i]);return c};class xo extends B1{constructor(r,i,n,o=xi,h=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=wb,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!Ii(d)?this.map.set(this.getKey(d),d):pm(d)?this.map.set(d.id,d):dm(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,g)=>{this.isInitialized(),this.map.has(d)?await this.update(d,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:g}),this.map.set(d,g),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(g=>Object.keys(d).every(_=>Tw(g[_],d[_]))):this.values),this.update=async(d,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:g});const _=_l(_l({},this.getData(d)),g);this.map.set(d,_),await this.persist()},this.delete=async(d,g)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:g}),this.map.delete(d),await this.persist())},this.logger=Ce.generateChildLogger(i,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Jb{constructor(r,i){this.core=r,this.logger=i,this.name=xb,this.version=Pb,this.events=new Ec,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[Bl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=fc(),o=await this.core.crypto.setSymKey(n),h=$r(se.FIVE_MINUTES),d={protocol:xf},g={topic:o,expiry:h,relay:d,active:!1},_=Sm({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d});return await this.pairings.set(o,g),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:_}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:d}=Am(n.uri);let g;if(this.pairings.keys.includes(o)&&(g=this.pairings.get(o),g.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d}));const _=$r(se.FIVE_MINUTES),m={topic:o,relay:d,expiry:_,active:!1};return await this.pairings.set(o,m),this.core.expirer.set(o,_),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Gs.create,m),m},this.activate=async({topic:n})=>{this.isInitialized();const o=$r(se.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:g,reject:_}=ps();this.events.once(Dt("pairing_ping",h),({error:m})=>{m?_(m):g()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",tr("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const d=ys(o,h),g=await this.core.crypto.encode(n,d),_=Us[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,g,_),d.id},this.sendResult=async(n,o,h)=>{const d=Sc(n,h),g=await this.core.crypto.encode(o,d),_=await this.core.history.get(o,n),m=Us[_.request.method].res;await this.core.relayer.publish(o,g,m),await this.core.history.resolve(d)},this.sendError=async(n,o,h)=>{const d=bo(n,h),g=await this.core.crypto.encode(o,d),_=await this.core.history.get(o,n),m=Us[_.request.method]?Us[_.request.method].res:Us.unregistered_method.res;await this.core.relayer.publish(o,g,m),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,tr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Ei(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,d=(await this.core.history.get(o,h.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(Gs.ping,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{ci(o)?this.events.emit(Dt("pairing_ping",h),{}):Lr(o)&&this.events.emit(Dt("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Gs.delete,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const g=tr("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,n,g),this.logger.error(g)}catch(g){await this.sendError(h,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(tr("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!hr(n)){const{message:o}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!Rm(n.uri)){const{message:o}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!hr(n)){const{message:h}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!hr(n)){const{message:h}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!ds(n,!1)){const{message:o}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Ei(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Ce.generateChildLogger(i,this.name),this.pairings=new xo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);try{Ac(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):Eo(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Sr.expired,async r=>{const{topic:i}=kl(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(Gs.expire,{topic:i}))})}}class Qb extends j1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new Ar.EventEmitter,this.name=Sb,this.version=Ab,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:$r(se.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(Kr.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Lr(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Kr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(Kr.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ce.generateChildLogger(i,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:ys(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(Kr.created,r=>{const i=Kr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(Kr.updated,r=>{const i=Kr.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(Kr.deleted,r=>{const i=Kr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(ws.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{se.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Yb extends K1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new Ar.EventEmitter,this.name=Rb,this.version=Ob,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(Sr.created,{target:h,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Sr.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ce.generateChildLogger(i,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return Om(r);if(typeof r=="number")return Cm(r);const{message:i}=Z("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Sr.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;se.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(Sr.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(ws.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Sr.created,r=>{const i=Sr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Sr.expired,r=>{const i=Sr.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Sr.deleted,r=>{const i=Sr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Xb extends V1{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=sc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||Tm()||!Kl())return;const n=yo;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o)}if(!this.initialized){this.removeIframe(),this.verifyUrl=pl;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=(n==null?void 0:n.verifyUrl)||yo;let h;try{h=await this.fetchAttestation(n.attestationId,o)}catch(d){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(d),h=await this.fetchAttestation(n.attestationId,pl)}return h},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const h=this.startAbortTimer(se.ONE_SECOND*2),d=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?await d.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(h=>{if(document.getElementById(sc))return h();window.addEventListener("message",o);const d=document.createElement("iframe");d.id=sc,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,n=h}),new Promise((h,d)=>setTimeout(()=>{window.removeEventListener("message",o),d("verify iframe load timeout")},se.toMiliseconds(se.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ce.generateChildLogger(i,this.name),this.verifyUrl=yo,this.abortController=new AbortController,this.isDevEnv=Nm()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),se.toMiliseconds(r))}}var Zb=Object.defineProperty,bl=Object.getOwnPropertySymbols,eE=Object.prototype.hasOwnProperty,tE=Object.prototype.propertyIsEnumerable,El=(c,r,i)=>r in c?Zb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Il=(c,r)=>{for(var i in r||(r={}))eE.call(r,i)&&El(c,i,r[i]);if(bl)for(var i of bl(r))tE.call(r,i)&&El(c,i,r[i]);return c};class Oc extends M1{constructor(r){super(r),this.protocol=If,this.version=rb,this.name=Rc,this.events=new Ar.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||Pf,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||ib.logger}));this.logger=Ce.generateChildLogger(i,this.name),this.heartbeat=new ws.HeartBeat,this.crypto=new Tb(this,this.logger,r==null?void 0:r.keychain),this.history=new Qb(this,this.logger),this.expirer=new Yb(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new O1(Il(Il({},sb),r==null?void 0:r.storageOptions)),this.relayer=new Kb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Jb(this,this.logger),this.verify=new Xb(this.projectId||"",this.logger)}static async init(r){const i=new Oc(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(_b,n),i}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const rE=Oc,Sf="wc",Af=2,Rf="client",Cc=`${Sf}@${Af}:${Rf}:`,oc={name:Rf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},xl="WALLETCONNECT_DEEPLINK_CHOICE",iE="proposal",Of="Proposal expired",sE="session",co=se.SEVEN_DAYS,nE="engine",Bs={wc_sessionPropose:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1104},res:{ttl:se.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1106},res:{ttl:se.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1112},res:{ttl:se.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1115}}},ac={min:se.FIVE_MINUTES,max:se.SEVEN_DAYS},ai={idle:"IDLE",active:"ACTIVE"},oE="request",aE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var cE=Object.defineProperty,uE=Object.defineProperties,hE=Object.getOwnPropertyDescriptors,Pl=Object.getOwnPropertySymbols,lE=Object.prototype.hasOwnProperty,fE=Object.prototype.propertyIsEnumerable,Sl=(c,r,i)=>r in c?cE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,cr=(c,r)=>{for(var i in r||(r={}))lE.call(r,i)&&Sl(c,i,r[i]);if(Pl)for(var i of Pl(r))fE.call(r,i)&&Sl(c,i,r[i]);return c},ks=(c,r)=>uE(c,hE(r));class pE extends W1{constructor(r){super(r),this.name=nE,this.events=new Ec,this.initialized=!1,this.ignoredPayloadTypes=[Bl],this.requestQueue={state:ai.idle,queue:[]},this.sessionRequestQueue={state:ai.idle,queue:[]},this.requestQueueDelay=se.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Bs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},se.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=ks(cr({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:g,relays:_}=n;let m=o,x,O=!1;if(m&&(O=this.client.core.pairing.pairings.get(m).active),!m||!O){const{topic:fe,uri:pe}=await this.client.core.pairing.create();m=fe,x=pe}const N=await this.client.core.crypto.generateKeyPair(),j=cr({requiredNamespaces:h,optionalNamespaces:d,relays:_??[{protocol:xf}],proposer:{publicKey:N,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:C,resolve:K,done:re}=ps(se.FIVE_MINUTES,Of);if(this.events.once(Dt("session_connect"),async({error:fe,session:pe})=>{if(fe)C(fe);else if(pe){pe.self.publicKey=N;const de=ks(cr({},pe),{requiredNamespaces:pe.requiredNamespaces,optionalNamespaces:pe.optionalNamespaces});await this.client.session.set(pe.topic,de),await this.setExpiry(pe.topic,pe.expiry),m&&await this.client.core.pairing.updateMetadata({topic:m,metadata:pe.peer.metadata}),K(de)}}),!m){const{message:fe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${m}`);throw new Error(fe)}const he=await this.sendRequest({topic:m,method:"wc_sessionPropose",params:j}),le=$r(se.FIVE_MINUTES);return await this.setProposal(he,cr({id:he,expiry:le},j)),{uri:x,approval:re}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:d}=i,g=this.client.proposal.get(n);let{pairingTopic:_,proposer:m,requiredNamespaces:x,optionalNamespaces:O}=g;_=_||"",fo(x)||(x=Fm(h,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),j=m.publicKey,C=await this.client.core.crypto.generateSharedKey(N,j);_&&n&&(await this.client.core.pairing.updateMetadata({topic:_,metadata:m.metadata}),await this.sendResult({id:n,topic:_,result:{relay:{protocol:o??"irn"},responderPublicKey:N}}),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}));const K=cr({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:x,optionalNamespaces:O,pairingTopic:_,controller:{publicKey:N,metadata:this.client.metadata},expiry:$r(co)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(C),await this.sendRequest({topic:C,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const re=ks(cr({},K),{topic:C,pairingTopic:_,acknowledged:!1,self:K.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:N});return await this.client.session.set(C,re),await this.setExpiry(C,$r(co)),{topic:C,acknowledged:()=>new Promise(he=>setTimeout(()=>he(this.client.session.get(C)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:n,reason:o}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:o}=i,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:d,resolve:g,reject:_}=ps();return this.events.once(Dt("session_update",h),({error:m})=>{m?_(m):g()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:d,reject:g}=ps();return this.events.once(Dt("session_extend",o),({error:_})=>{_?g(_):d()}),await this.setExpiry(n,$r(co)),{acknowledged:h}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:o,topic:h,expiry:d}=i,g=Pc(),{done:_,resolve:m,reject:x}=ps(d,"Request expired. Please try again.");return this.events.once(Dt("session_request",g),({error:O,result:N})=>{O?x(O):m(N)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:g,topic:h,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:d,throwOnFailedPublish:!0}).catch(N=>x(N)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:g}),O()}),new Promise(async O=>{const N=await this.client.core.storage.getItem(xl);$m({id:g,topic:h,wcDeepLink:N}),O()}),_()]).then(O=>O[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:h}=o;ci(o)?await this.sendResult({id:h,topic:n,result:o.result,throwOnFailedPublish:!0}):Lr(o)&&await this.sendError(h,n,o.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:d,reject:g}=ps();this.events.once(Dt("session_ping",o),({error:_})=>{_?g(_):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:h}=i;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:tr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>Lm(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,g;return((d=h.peerMetadata)==null?void 0:d.url)&&((g=h.peerMetadata)==null?void 0:g.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,tr("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(xl).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,tr("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==i),o&&(this.sessionRequestQueue.state=ai.idle)},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=Bs.wc_sessionRequest.req.ttl,{id:o,topic:h,params:d,verifyContext:g}=i;await this.client.pendingRequest.set(o,{id:o,topic:h,params:d,verifyContext:g}),n&&this.client.core.expirer.set(o,$r(n))},this.sendRequest=async i=>{const{topic:n,method:o,params:h,expiry:d,relayRpcId:g,clientRpcId:_,throwOnFailedPublish:m}=i,x=ys(o,h,_);if(Kl()&&aE.includes(o)){const j=gs(JSON.stringify(x));this.client.core.verify.register({attestationId:j})}const O=await this.client.core.crypto.encode(n,x),N=Bs[o].req;return d&&(N.ttl=d),g&&(N.id=g),this.client.core.history.set(n,x),m?(N.internal=ks(cr({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,O,N)):this.client.core.relayer.publish(n,O,N).catch(j=>this.client.logger.error(j)),x.id},this.sendResult=async i=>{const{id:n,topic:o,result:h,throwOnFailedPublish:d}=i,g=Sc(n,h),_=await this.client.core.crypto.encode(o,g),m=await this.client.core.history.get(o,n),x=Bs[m.request.method].res;d?(x.internal=ks(cr({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,_,x)):this.client.core.relayer.publish(o,_,x).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(g)},this.sendError=async(i,n,o)=>{const h=bo(i,o),d=await this.client.core.crypto.encode(n,h),g=await this.client.core.history.get(n,i),_=Bs[g.request.method].res;this.client.core.relayer.publish(n,d,_),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{Ei(o.expiry)&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Ei(o.expiry)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ai.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ai.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ai.idle},this.processRequest=i=>{const{topic:n,payload:o}=i,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(cr({},n.params));const d=$r(se.FIVE_MINUTES),g=cr({id:h,pairingTopic:i,expiry:d},o);await this.setProposal(h,g);const _=gs(JSON.stringify(n)),m=await this.getVerifyContext(_,g.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:g,verifyContext:m})}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(ci(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const g=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const _=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const m=await this.client.core.crypto.generateSharedKey(g,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:m});const x=await this.client.core.relayer.subscribe(m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:x}),await this.client.core.pairing.activate({topic:i})}else Lr(n)&&(await this.client.proposal.delete(o,tr("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:g,expiry:_,namespaces:m,requiredNamespaces:x,optionalNamespaces:O,sessionProperties:N,pairingTopic:j}=n.params,C=cr({topic:i,relay:d,expiry:_,namespaces:m,acknowledged:!0,pairingTopic:j,requiredNamespaces:x,optionalNamespaces:O,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},N&&{sessionProperties:N});await this.sendResult({id:n.id,topic:i,result:!0}),this.events.emit(Dt("session_connect"),{session:C}),this.cleanupDuplicatePairings(C)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;ci(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(Dt("session_approve",o),{})):Lr(n)&&(await this.client.session.delete(i,tr("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:h}=n;try{const d=`${i}_session_update`,g=no.get(d);if(g&&this.isRequestOutOfSync(g,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(cr({topic:i},o)),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:i,result:!0}),this.client.events.emit("session_update",{id:h,topic:i,params:o}),no.set(d,h)}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n;ci(n)?this.events.emit(Dt("session_update",o),{}):Lr(n)&&this.events.emit(Dt("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,$r(co)),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_extend",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n;ci(n)?this.events.emit(Dt("session_extend",o),{}):Lr(n)&&this.events.emit(Dt("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_ping",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{ci(n)?this.events.emit(Dt("session_ping",o),{}):Lr(n)&&this.events.emit(Dt("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Gt.publish,async()=>{h(await this.deleteSession(i))})}),this.sendResult({id:o,topic:i,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:i})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(cr({topic:i},h));const d=gs(JSON.stringify(ys("wc_sessionRequest",h,o))),g=this.client.session.get(i),_=await this.getVerifyContext(d,g.peer.metadata),m={id:o,topic:i,params:h,verifyContext:_};await this.setPendingSessionRequest(m),this.addSessionRequestToSessionRequestQueue(m),this.processSessionRequestQueue()}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n;ci(n)?this.events.emit(Dt("session_request",o),{result:n.result}):Lr(n)&&this.events.emit(Dt("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:h}=n;try{const d=`${i}_session_event_${h.event.name}`,g=no.get(d);if(g&&this.isRequestOutOfSync(g,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(cr({topic:i},h)),this.client.events.emit("session_event",{id:o,topic:i,params:h}),no.set(d,o)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ai.idle,this.processSessionRequestQueue()},se.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ai.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ai.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,ys("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async i=>{if(!hr(i)){const{message:_}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(_)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:g}=i;if(Ii(n)||await this.isValidPairingTopic(n),!qm(g,!0)){const{message:_}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(_)}!Ii(o)&&fo(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Ii(h)&&fo(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Ii(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=Mm(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!hr(i))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:d}=i;await this.isValidProposalId(n);const g=this.client.proposal.get(n),_=Ja(o,"approve()");if(_)throw new Error(_.message);const m=$h(g.requiredNamespaces,o,"approve()");if(m)throw new Error(m.message);if(!ds(h,!0)){const{message:x}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(x)}Ii(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async i=>{if(!hr(i)){const{message:h}=Z("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:o}=i;if(await this.isValidProposalId(n),!jm(o)){const{message:h}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!hr(i)){const{message:m}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(m)}const{relay:n,controller:o,namespaces:h,expiry:d}=i;if(!zm(n)){const{message:m}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(m)}const g=Um(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);const _=Ja(h,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(Ei(d)){const{message:m}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(m)}},this.isValidUpdate=async i=>{if(!hr(i)){const{message:_}=Z("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(_)}const{topic:n,namespaces:o}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),d=Ja(o,"update()");if(d)throw new Error(d.message);const g=$h(h.requiredNamespaces,o,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async i=>{if(!hr(i)){const{message:o}=Z("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!hr(i)){const{message:_}=Z("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(_)}const{topic:n,request:o,chainId:h,expiry:d}=i;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!Lh(g,h)){const{message:_}=Z("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(_)}if(!Hm(o)){const{message:_}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(_)}if(!Bm(g,h,o.method)){const{message:_}=Z("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(_)}if(d&&!km(d,ac)){const{message:_}=Z("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${ac.min} and ${ac.max}`);throw new Error(_)}},this.isValidRespond=async i=>{if(!hr(i)){const{message:h}=Z("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(h)}const{topic:n,response:o}=i;if(await this.isValidSessionTopic(n),!Km(o)){const{message:h}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidPing=async i=>{if(!hr(i)){const{message:o}=Z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!hr(i)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(g)}const{topic:n,event:o,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!Lh(d,h)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(g)}if(!Vm(o)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}if(!Gm(d,h,o.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}},this.isValidDisconnect=async i=>{if(!hr(i)){const{message:o}=Z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||yo,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!ds(o,!1)){const{message:h}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(i,n);try{Ac(o)?(this.client.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):Eo(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.client.core.history.delete(i,o.id)):this.onRelayEventUnknownPayload({topic:i,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Sr.expired,async r=>{const{topic:i,id:n}=kl(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Gs.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!ds(r,!1)){const{message:i}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Ei(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=Z("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!ds(r,!1)){const{message:i}=Z("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Ei(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=Z("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(ds(r,!1)){const{message:i}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!Wm(r)){const{message:i}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Ei(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=Z("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class dE extends xo{constructor(r,i){super(r,i,iE,Cc),this.core=r,this.logger=i}}class gE extends xo{constructor(r,i){super(r,i,sE,Cc),this.core=r,this.logger=i}}class yE extends xo{constructor(r,i){super(r,i,oE,Cc,n=>n.id),this.core=r,this.logger=i}}let vE=class Cf extends G1{constructor(r){super(r),this.protocol=Sf,this.version=Af,this.name=oc.name,this.events=new Ar.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||oc.name,this.metadata=(r==null?void 0:r.metadata)||Dm();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||oc.logger}));this.core=(r==null?void 0:r.core)||new rE(r),this.logger=Ce.generateChildLogger(i,this.name),this.session=new gE(this.core,this.logger),this.proposal=new dE(this.core,this.logger),this.pendingRequest=new yE(this.core,this.logger),this.engine=new pE(this)}static async init(r){const i=new Cf(r);return await i.initialize(),i}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};var vc={exports:{}};(function(c,r){var i=typeof self<"u"?self:qr,n=function(){function h(){this.fetch=!1,this.DOMException=i.DOMException}return h.prototype=i,new h}();(function(h){(function(d){var g={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function _(v){return v&&DataView.prototype.isPrototypeOf(v)}if(g.arrayBuffer)var m=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],x=ArrayBuffer.isView||function(v){return v&&m.indexOf(Object.prototype.toString.call(v))>-1};function O(v){if(typeof v!="string"&&(v=String(v)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(v))throw new TypeError("Invalid character in header field name");return v.toLowerCase()}function N(v){return typeof v!="string"&&(v=String(v)),v}function j(v){var I={next:function(){var Y=v.shift();return{done:Y===void 0,value:Y}}};return g.iterable&&(I[Symbol.iterator]=function(){return I}),I}function C(v){this.map={},v instanceof C?v.forEach(function(I,Y){this.append(Y,I)},this):Array.isArray(v)?v.forEach(function(I){this.append(I[0],I[1])},this):v&&Object.getOwnPropertyNames(v).forEach(function(I){this.append(I,v[I])},this)}C.prototype.append=function(v,I){v=O(v),I=N(I);var Y=this.map[v];this.map[v]=Y?Y+", "+I:I},C.prototype.delete=function(v){delete this.map[O(v)]},C.prototype.get=function(v){return v=O(v),this.has(v)?this.map[v]:null},C.prototype.has=function(v){return this.map.hasOwnProperty(O(v))},C.prototype.set=function(v,I){this.map[O(v)]=N(I)},C.prototype.forEach=function(v,I){for(var Y in this.map)this.map.hasOwnProperty(Y)&&v.call(I,this.map[Y],Y,this)},C.prototype.keys=function(){var v=[];return this.forEach(function(I,Y){v.push(Y)}),j(v)},C.prototype.values=function(){var v=[];return this.forEach(function(I){v.push(I)}),j(v)},C.prototype.entries=function(){var v=[];return this.forEach(function(I,Y){v.push([Y,I])}),j(v)},g.iterable&&(C.prototype[Symbol.iterator]=C.prototype.entries);function K(v){if(v.bodyUsed)return Promise.reject(new TypeError("Already read"));v.bodyUsed=!0}function re(v){return new Promise(function(I,Y){v.onload=function(){I(v.result)},v.onerror=function(){Y(v.error)}})}function he(v){var I=new FileReader,Y=re(I);return I.readAsArrayBuffer(v),Y}function le(v){var I=new FileReader,Y=re(I);return I.readAsText(v),Y}function fe(v){for(var I=new Uint8Array(v),Y=new Array(I.length),ce=0;ce<I.length;ce++)Y[ce]=String.fromCharCode(I[ce]);return Y.join("")}function pe(v){if(v.slice)return v.slice(0);var I=new Uint8Array(v.byteLength);return I.set(new Uint8Array(v)),I.buffer}function de(){return this.bodyUsed=!1,this._initBody=function(v){this._bodyInit=v,v?typeof v=="string"?this._bodyText=v:g.blob&&Blob.prototype.isPrototypeOf(v)?this._bodyBlob=v:g.formData&&FormData.prototype.isPrototypeOf(v)?this._bodyFormData=v:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(v)?this._bodyText=v.toString():g.arrayBuffer&&g.blob&&_(v)?(this._bodyArrayBuffer=pe(v.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(v)||x(v))?this._bodyArrayBuffer=pe(v):this._bodyText=v=Object.prototype.toString.call(v):this._bodyText="",this.headers.get("content-type")||(typeof v=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(v)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var v=K(this);if(v)return v;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?K(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(he)}),this.text=function(){var v=K(this);if(v)return v;if(this._bodyBlob)return le(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(fe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(ve)}),this.json=function(){return this.text().then(JSON.parse)},this}var $=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function U(v){var I=v.toUpperCase();return $.indexOf(I)>-1?I:v}function W(v,I){I=I||{};var Y=I.body;if(v instanceof W){if(v.bodyUsed)throw new TypeError("Already read");this.url=v.url,this.credentials=v.credentials,I.headers||(this.headers=new C(v.headers)),this.method=v.method,this.mode=v.mode,this.signal=v.signal,!Y&&v._bodyInit!=null&&(Y=v._bodyInit,v.bodyUsed=!0)}else this.url=String(v);if(this.credentials=I.credentials||this.credentials||"same-origin",(I.headers||!this.headers)&&(this.headers=new C(I.headers)),this.method=U(I.method||this.method||"GET"),this.mode=I.mode||this.mode||null,this.signal=I.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Y)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Y)}W.prototype.clone=function(){return new W(this,{body:this._bodyInit})};function ve(v){var I=new FormData;return v.trim().split("&").forEach(function(Y){if(Y){var ce=Y.split("="),V=ce.shift().replace(/\+/g," "),H=ce.join("=").replace(/\+/g," ");I.append(decodeURIComponent(V),decodeURIComponent(H))}}),I}function ie(v){var I=new C,Y=v.replace(/\r?\n[\t ]+/g," ");return Y.split(/\r?\n/).forEach(function(ce){var V=ce.split(":"),H=V.shift().trim();if(H){var k=V.join(":").trim();I.append(H,k)}}),I}de.call(W.prototype);function ue(v,I){I||(I={}),this.type="default",this.status=I.status===void 0?200:I.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in I?I.statusText:"OK",this.headers=new C(I.headers),this.url=I.url||"",this._initBody(v)}de.call(ue.prototype),ue.prototype.clone=function(){return new ue(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new C(this.headers),url:this.url})},ue.error=function(){var v=new ue(null,{status:0,statusText:""});return v.type="error",v};var Te=[301,302,303,307,308];ue.redirect=function(v,I){if(Te.indexOf(I)===-1)throw new RangeError("Invalid status code");return new ue(null,{status:I,headers:{location:v}})},d.DOMException=h.DOMException;try{new d.DOMException}catch{d.DOMException=function(I,Y){this.message=I,this.name=Y;var ce=Error(I);this.stack=ce.stack},d.DOMException.prototype=Object.create(Error.prototype),d.DOMException.prototype.constructor=d.DOMException}function ze(v,I){return new Promise(function(Y,ce){var V=new W(v,I);if(V.signal&&V.signal.aborted)return ce(new d.DOMException("Aborted","AbortError"));var H=new XMLHttpRequest;function k(){H.abort()}H.onload=function(){var G={status:H.status,statusText:H.statusText,headers:ie(H.getAllResponseHeaders()||"")};G.url="responseURL"in H?H.responseURL:G.headers.get("X-Request-URL");var Je="response"in H?H.response:H.responseText;Y(new ue(Je,G))},H.onerror=function(){ce(new TypeError("Network request failed"))},H.ontimeout=function(){ce(new TypeError("Network request failed"))},H.onabort=function(){ce(new d.DOMException("Aborted","AbortError"))},H.open(V.method,V.url,!0),V.credentials==="include"?H.withCredentials=!0:V.credentials==="omit"&&(H.withCredentials=!1),"responseType"in H&&g.blob&&(H.responseType="blob"),V.headers.forEach(function(G,Je){H.setRequestHeader(Je,G)}),V.signal&&(V.signal.addEventListener("abort",k),H.onreadystatechange=function(){H.readyState===4&&V.signal.removeEventListener("abort",k)}),H.send(typeof V._bodyInit>"u"?null:V._bodyInit)})}return ze.polyfill=!0,h.fetch||(h.fetch=ze,h.Headers=C,h.Request=W,h.Response=ue),d.Headers=C,d.Request=W,d.Response=ue,d.fetch=ze,Object.defineProperty(d,"__esModule",{value:!0}),d})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;r=o.fetch,r.default=o.fetch,r.fetch=o.fetch,r.Headers=o.Headers,r.Request=o.Request,r.Response=o.Response,c.exports=r})(vc,vc.exports);var mE=vc.exports;const Al=Hl(mE),wE={Accept:"application/json","Content-Type":"application/json"},_E="POST",Rl={headers:wE,method:_E},Ol=10;class Si{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new Ar.EventEmitter,this.isAvailable=!1,this.registering=!1,!tl(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,i){this.isAvailable||await this.register();try{const n=Bi(r),h=await(await Al(this.url,Object.assign(Object.assign({},Rl),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!tl(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=Bi({id:1,jsonrpc:"2.0",method:"test",params:[]});await Al(r,Object.assign(Object.assign({},Rl),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Xs(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=bo(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return af(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ol&&this.events.setMaxListeners(Ol)}}const Cl="error",bE="wss://relay.walletconnect.com",EE="wc",IE="universal_provider",Tl=`${EE}@2:${IE}:`,xE="https://rpc.walletconnect.com/v1/",hi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(c,r){(function(){var i,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",g="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",m=500,x="__lodash_placeholder__",O=1,N=2,j=4,C=1,K=2,re=1,he=2,le=4,fe=8,pe=16,de=32,$=64,U=128,W=256,ve=512,ie=30,ue="...",Te=800,ze=16,v=1,I=2,Y=3,ce=1/0,V=9007199254740991,H=17976931348623157e292,k=0/0,G=4294967295,Je=G-1,Be=G>>>1,Mr=[["ary",U],["bind",re],["bindKey",he],["curry",fe],["curryRight",pe],["flip",ve],["partial",de],["partialRight",$],["rearg",W]],Ie="[object Arguments]",It="[object Array]",F="[object AsyncFunction]",D="[object Boolean]",R="[object Date]",u="[object DOMException]",E="[object Error]",ee="[object Function]",ge="[object GeneratorFunction]",be="[object Map]",Ne="[object Number]",Fe="[object Null]",Se="[object Object]",xt="[object Promise]",mt="[object Proxy]",ot="[object RegExp]",Le="[object Set]",Ye="[object String]",Xe="[object Symbol]",at="[object Undefined]",Ue="[object WeakMap]",Ze="[object WeakSet]",De="[object ArrayBuffer]",ke="[object DataView]",ht="[object Float32Array]",Me="[object Float64Array]",Pt="[object Int8Array]",Ft="[object Int16Array]",Ut="[object Int32Array]",Ht="[object Uint8Array]",qt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",rr="[object Uint32Array]",jr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Vr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,li=/&(?:amp|lt|gt|quot|#39);/g,Ai=/[&<>"']/g,lt=RegExp(li.source),rt=RegExp(Ai.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,St=/^\w*$/,At=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Rt=RegExp(dt.source),gt=/^\s+/,wt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ot=/,? & /,Ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Po=/[()=,{}\[\]\/\s]/,So=/\\(\\)?/g,Ao=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vr=/\w*$/,Ro=/^[-+]0x[0-9a-f]+$/i,Oo=/^0b[01]+$/i,Co=/^\[object .+?Constructor\]$/,To=/^0o[0-7]+$/i,No=/^(?:0|[1-9]\d*)$/,Gr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gi=/($^)/,Do=/['\n\r\u2028\u2029\\]/g,Wi="\\ud800-\\udfff",Fo="\\u0300-\\u036f",$o="\\ufe20-\\ufe2f",Ji="\\u20d0-\\u20ff",en=Fo+$o+Ji,tn="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",Lo="\\xac\\xb1\\xd7\\xf7",qo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Mo="\\u2000-\\u206f",jo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rn="A-Z\\xc0-\\xd6\\xd8-\\xde",sn="\\ufe0e\\ufe0f",Ri=Lo+qo+Mo+jo,_s="[']",Oi="["+Wi+"]",bs="["+Ri+"]",Ci="["+en+"]",nn="\\d+",zo="["+tn+"]",on="["+Rr+"]",an="[^"+Wi+Ri+nn+tn+Rr+rn+"]",Qi="\\ud83c[\\udffb-\\udfff]",Uo="(?:"+Ci+"|"+Qi+")",cn="[^"+Wi+"]",Yi="(?:\\ud83c[\\udde6-\\uddff]){2}",fi="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+rn+"]",un="\\u200d",hn="(?:"+on+"|"+an+")",zr="(?:"+lr+"|"+an+")",ln="(?:"+_s+"(?:d|ll|m|re|s|t|ve))?",fn="(?:"+_s+"(?:D|LL|M|RE|S|T|VE))?",pn=Uo+"?",dn="["+sn+"]?",Ho="(?:"+un+"(?:"+[cn,Yi,fi].join("|")+")"+dn+pn+")*",Wr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",yn=dn+pn+Ho,Xi="(?:"+[zo,Yi,fi].join("|")+")"+yn,Bo="(?:"+[cn+Ci+"?",Ci,Yi,fi,Oi].join("|")+")",Es=RegExp(_s,"g"),ko=RegExp(Ci,"g"),Zi=RegExp(Qi+"(?="+Qi+")|"+Bo+yn,"g"),vn=RegExp([lr+"?"+on+"+"+ln+"(?="+[bs,lr,"$"].join("|")+")",zr+"+"+fn+"(?="+[bs,lr+hn,"$"].join("|")+")",lr+"?"+hn+"+"+ln,lr+"+"+fn,gn,Wr,nn,Xi].join("|"),"g"),mn=RegExp("["+un+Wi+en+sn+"]"),Ti=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,wn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ko=-1,Ke={};Ke[ht]=Ke[Me]=Ke[Pt]=Ke[Ft]=Ke[Ut]=Ke[Ht]=Ke[qt]=Ke[Wt]=Ke[rr]=!0,Ke[Ie]=Ke[It]=Ke[De]=Ke[D]=Ke[ke]=Ke[R]=Ke[E]=Ke[ee]=Ke[be]=Ke[Ne]=Ke[Se]=Ke[ot]=Ke[Le]=Ke[Ye]=Ke[Ue]=!1;var He={};He[Ie]=He[It]=He[De]=He[ke]=He[D]=He[R]=He[ht]=He[Me]=He[Pt]=He[Ft]=He[Ut]=He[be]=He[Ne]=He[Se]=He[ot]=He[Le]=He[Ye]=He[Xe]=He[Ht]=He[qt]=He[Wt]=He[rr]=!0,He[E]=He[ee]=He[Ue]=!1;var y={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},z={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,me=parseInt,et=typeof Ks=="object"&&Ks&&Ks.Object===Object&&Ks,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Re=et||Tt||Function("return this")(),Ge=r&&!r.nodeType&&r,_t=Ge&&!0&&c&&!c.nodeType&&c,ir=_t&&_t.exports===Ge,Nt=ir&&et.process,tt=function(){try{var S=_t&&_t.require&&_t.require("util").types;return S||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Qt=tt&&tt.isArrayBuffer,Or=tt&&tt.isDate,mr=tt&&tt.isMap,Ur=tt&&tt.isRegExp,Is=tt&&tt.isSet,Ni=tt&&tt.isTypedArray;function Mt(S,L,T){switch(T.length){case 0:return S.call(L);case 1:return S.call(L,T[0]);case 2:return S.call(L,T[0],T[1]);case 3:return S.call(L,T[0],T[1],T[2])}return S.apply(L,T)}function Df(S,L,T,X){for(var ye=-1,$e=S==null?0:S.length;++ye<$e;){var $t=S[ye];L(X,$t,T($t),S)}return X}function wr(S,L){for(var T=-1,X=S==null?0:S.length;++T<X&&L(S[T],T,S)!==!1;);return S}function Ff(S,L){for(var T=S==null?0:S.length;T--&&L(S[T],T,S)!==!1;);return S}function Dc(S,L){for(var T=-1,X=S==null?0:S.length;++T<X;)if(!L(S[T],T,S))return!1;return!0}function pi(S,L){for(var T=-1,X=S==null?0:S.length,ye=0,$e=[];++T<X;){var $t=S[T];L($t,T,S)&&($e[ye++]=$t)}return $e}function _n(S,L){var T=S==null?0:S.length;return!!T&&es(S,L,0)>-1}function Vo(S,L,T){for(var X=-1,ye=S==null?0:S.length;++X<ye;)if(T(L,S[X]))return!0;return!1}function st(S,L){for(var T=-1,X=S==null?0:S.length,ye=Array(X);++T<X;)ye[T]=L(S[T],T,S);return ye}function di(S,L){for(var T=-1,X=L.length,ye=S.length;++T<X;)S[ye+T]=L[T];return S}function Go(S,L,T,X){var ye=-1,$e=S==null?0:S.length;for(X&&$e&&(T=S[++ye]);++ye<$e;)T=L(T,S[ye],ye,S);return T}function $f(S,L,T,X){var ye=S==null?0:S.length;for(X&&ye&&(T=S[--ye]);ye--;)T=L(T,S[ye],ye,S);return T}function Wo(S,L){for(var T=-1,X=S==null?0:S.length;++T<X;)if(L(S[T],T,S))return!0;return!1}var Lf=Jo("length");function qf(S){return S.split("")}function Mf(S){return S.match(Ct)||[]}function Fc(S,L,T){var X;return T(S,function(ye,$e,$t){if(L(ye,$e,$t))return X=$e,!1}),X}function bn(S,L,T,X){for(var ye=S.length,$e=T+(X?1:-1);X?$e--:++$e<ye;)if(L(S[$e],$e,S))return $e;return-1}function es(S,L,T){return L===L?Qf(S,L,T):bn(S,$c,T)}function jf(S,L,T,X){for(var ye=T-1,$e=S.length;++ye<$e;)if(X(S[ye],L))return ye;return-1}function $c(S){return S!==S}function Lc(S,L){var T=S==null?0:S.length;return T?Yo(S,L)/T:k}function Jo(S){return function(L){return L==null?i:L[S]}}function Qo(S){return function(L){return S==null?i:S[L]}}function qc(S,L,T,X,ye){return ye(S,function($e,$t,We){T=X?(X=!1,$e):L(T,$e,$t,We)}),T}function zf(S,L){var T=S.length;for(S.sort(L);T--;)S[T]=S[T].value;return S}function Yo(S,L){for(var T,X=-1,ye=S.length;++X<ye;){var $e=L(S[X]);$e!==i&&(T=T===i?$e:T+$e)}return T}function Xo(S,L){for(var T=-1,X=Array(S);++T<S;)X[T]=L(T);return X}function Uf(S,L){return st(L,function(T){return[T,S[T]]})}function Mc(S){return S&&S.slice(0,Hc(S)+1).replace(gt,"")}function fr(S){return function(L){return S(L)}}function Zo(S,L){return st(L,function(T){return S[T]})}function xs(S,L){return S.has(L)}function jc(S,L){for(var T=-1,X=S.length;++T<X&&es(L,S[T],0)>-1;);return T}function zc(S,L){for(var T=S.length;T--&&es(L,S[T],0)>-1;);return T}function Hf(S,L){for(var T=S.length,X=0;T--;)S[T]===L&&++X;return X}var Bf=Qo(y),kf=Qo(P);function Kf(S){return"\\"+Q[S]}function Vf(S,L){return S==null?i:S[L]}function ts(S){return mn.test(S)}function Gf(S){return Ti.test(S)}function Wf(S){for(var L,T=[];!(L=S.next()).done;)T.push(L.value);return T}function ea(S){var L=-1,T=Array(S.size);return S.forEach(function(X,ye){T[++L]=[ye,X]}),T}function Uc(S,L){return function(T){return S(L(T))}}function gi(S,L){for(var T=-1,X=S.length,ye=0,$e=[];++T<X;){var $t=S[T];($t===L||$t===x)&&(S[T]=x,$e[ye++]=T)}return $e}function En(S){var L=-1,T=Array(S.size);return S.forEach(function(X){T[++L]=X}),T}function Jf(S){var L=-1,T=Array(S.size);return S.forEach(function(X){T[++L]=[X,X]}),T}function Qf(S,L,T){for(var X=T-1,ye=S.length;++X<ye;)if(S[X]===L)return X;return-1}function Yf(S,L,T){for(var X=T+1;X--;)if(S[X]===L)return X;return X}function rs(S){return ts(S)?Zf(S):Lf(S)}function Cr(S){return ts(S)?ep(S):qf(S)}function Hc(S){for(var L=S.length;L--&&wt.test(S.charAt(L)););return L}var Xf=Qo(z);function Zf(S){for(var L=Zi.lastIndex=0;Zi.test(S);)++L;return L}function ep(S){return S.match(Zi)||[]}function tp(S){return S.match(vn)||[]}var rp=function S(L){L=L==null?Re:is.defaults(Re.Object(),L,is.pick(Re,wn));var T=L.Array,X=L.Date,ye=L.Error,$e=L.Function,$t=L.Math,We=L.Object,ta=L.RegExp,ip=L.String,_r=L.TypeError,In=T.prototype,sp=$e.prototype,ss=We.prototype,xn=L["__core-js_shared__"],Pn=sp.toString,je=ss.hasOwnProperty,np=0,Bc=function(){var e=/[^.]+$/.exec(xn&&xn.keys&&xn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Sn=ss.toString,op=Pn.call(We),ap=Re._,cp=ta("^"+Pn.call(je).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),An=ir?L.Buffer:i,yi=L.Symbol,Rn=L.Uint8Array,kc=An?An.allocUnsafe:i,On=Uc(We.getPrototypeOf,We),Kc=We.create,Vc=ss.propertyIsEnumerable,Cn=In.splice,Gc=yi?yi.isConcatSpreadable:i,Ps=yi?yi.iterator:i,Di=yi?yi.toStringTag:i,Tn=function(){try{var e=Mi(We,"defineProperty");return e({},"",{}),e}catch{}}(),up=L.clearTimeout!==Re.clearTimeout&&L.clearTimeout,hp=X&&X.now!==Re.Date.now&&X.now,lp=L.setTimeout!==Re.setTimeout&&L.setTimeout,Nn=$t.ceil,Dn=$t.floor,ra=We.getOwnPropertySymbols,fp=An?An.isBuffer:i,Wc=L.isFinite,pp=In.join,dp=Uc(We.keys,We),Lt=$t.max,Kt=$t.min,gp=X.now,yp=L.parseInt,Jc=$t.random,vp=In.reverse,ia=Mi(L,"DataView"),Ss=Mi(L,"Map"),sa=Mi(L,"Promise"),ns=Mi(L,"Set"),As=Mi(L,"WeakMap"),Rs=Mi(We,"create"),Fn=As&&new As,os={},mp=ji(ia),wp=ji(Ss),_p=ji(sa),bp=ji(ns),Ep=ji(As),$n=yi?yi.prototype:i,Os=$n?$n.valueOf:i,Qc=$n?$n.toString:i;function f(e){if(vt(e)&&!we(e)&&!(e instanceof Ae)){if(e instanceof br)return e;if(je.call(e,"__wrapped__"))return Yu(e)}return new br(e)}var as=function(){function e(){}return function(t){if(!ut(t))return{};if(Kc)return Kc(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function Ln(){}function br(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}f.templateSettings={escape:ft,evaluate:pt,interpolate:ct,variable:"",imports:{_:f}},f.prototype=Ln.prototype,f.prototype.constructor=f,br.prototype=as(Ln.prototype),br.prototype.constructor=br;function Ae(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=G,this.__views__=[]}function Ip(){var e=new Ae(this.__wrapped__);return e.__actions__=sr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=sr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=sr(this.__views__),e}function xp(){if(this.__filtered__){var e=new Ae(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Pp(){var e=this.__wrapped__.value(),t=this.__dir__,s=we(e),a=t<0,l=s?e.length:0,p=qd(0,l,this.__views__),w=p.start,b=p.end,A=b-w,q=a?b:w-1,M=this.__iteratees__,B=M.length,J=0,te=Kt(A,this.__takeCount__);if(!s||!a&&l==A&&te==A)return _u(e,this.__actions__);var oe=[];e:for(;A--&&J<te;){q+=t;for(var Ee=-1,ae=e[q];++Ee<B;){var Pe=M[Ee],Oe=Pe.iteratee,gr=Pe.type,Zt=Oe(ae);if(gr==I)ae=Zt;else if(!Zt){if(gr==v)continue e;break e}}oe[J++]=ae}return oe}Ae.prototype=as(Ln.prototype),Ae.prototype.constructor=Ae;function Fi(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Sp(){this.__data__=Rs?Rs(null):{},this.size=0}function Ap(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Rp(e){var t=this.__data__;if(Rs){var s=t[e];return s===_?i:s}return je.call(t,e)?t[e]:i}function Op(e){var t=this.__data__;return Rs?t[e]!==i:je.call(t,e)}function Cp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Rs&&t===i?_:t,this}Fi.prototype.clear=Sp,Fi.prototype.delete=Ap,Fi.prototype.get=Rp,Fi.prototype.has=Op,Fi.prototype.set=Cp;function Jr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Tp(){this.__data__=[],this.size=0}function Np(e){var t=this.__data__,s=qn(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():Cn.call(t,s,1),--this.size,!0}function Dp(e){var t=this.__data__,s=qn(t,e);return s<0?i:t[s][1]}function Fp(e){return qn(this.__data__,e)>-1}function $p(e,t){var s=this.__data__,a=qn(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}Jr.prototype.clear=Tp,Jr.prototype.delete=Np,Jr.prototype.get=Dp,Jr.prototype.has=Fp,Jr.prototype.set=$p;function Qr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Lp(){this.size=0,this.__data__={hash:new Fi,map:new(Ss||Jr),string:new Fi}}function qp(e){var t=Jn(this,e).delete(e);return this.size-=t?1:0,t}function Mp(e){return Jn(this,e).get(e)}function jp(e){return Jn(this,e).has(e)}function zp(e,t){var s=Jn(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Qr.prototype.clear=Lp,Qr.prototype.delete=qp,Qr.prototype.get=Mp,Qr.prototype.has=jp,Qr.prototype.set=zp;function $i(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Qr;++t<s;)this.add(e[t])}function Up(e){return this.__data__.set(e,_),this}function Hp(e){return this.__data__.has(e)}$i.prototype.add=$i.prototype.push=Up,$i.prototype.has=Hp;function Tr(e){var t=this.__data__=new Jr(e);this.size=t.size}function Bp(){this.__data__=new Jr,this.size=0}function kp(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function Kp(e){return this.__data__.get(e)}function Vp(e){return this.__data__.has(e)}function Gp(e,t){var s=this.__data__;if(s instanceof Jr){var a=s.__data__;if(!Ss||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Qr(a)}return s.set(e,t),this.size=s.size,this}Tr.prototype.clear=Bp,Tr.prototype.delete=kp,Tr.prototype.get=Kp,Tr.prototype.has=Vp,Tr.prototype.set=Gp;function Yc(e,t){var s=we(e),a=!s&&zi(e),l=!s&&!a&&bi(e),p=!s&&!a&&!l&&ls(e),w=s||a||l||p,b=w?Xo(e.length,ip):[],A=b.length;for(var q in e)(t||je.call(e,q))&&!(w&&(q=="length"||l&&(q=="offset"||q=="parent")||p&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||ei(q,A)))&&b.push(q);return b}function Xc(e){var t=e.length;return t?e[ga(0,t-1)]:i}function Wp(e,t){return Qn(sr(e),Li(t,0,e.length))}function Jp(e){return Qn(sr(e))}function na(e,t,s){(s!==i&&!Nr(e[t],s)||s===i&&!(t in e))&&Yr(e,t,s)}function Cs(e,t,s){var a=e[t];(!(je.call(e,t)&&Nr(a,s))||s===i&&!(t in e))&&Yr(e,t,s)}function qn(e,t){for(var s=e.length;s--;)if(Nr(e[s][0],t))return s;return-1}function Qp(e,t,s,a){return vi(e,function(l,p,w){t(a,l,s(l),w)}),a}function Zc(e,t){return e&&Br(t,jt(t),e)}function Yp(e,t){return e&&Br(t,or(t),e)}function Yr(e,t,s){t=="__proto__"&&Tn?Tn(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function oa(e,t){for(var s=-1,a=t.length,l=T(a),p=e==null;++s<a;)l[s]=p?i:za(e,t[s]);return l}function Li(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function Er(e,t,s,a,l,p){var w,b=t&O,A=t&N,q=t&j;if(s&&(w=l?s(e,a,l,p):s(e)),w!==i)return w;if(!ut(e))return e;var M=we(e);if(M){if(w=jd(e),!b)return sr(e,w)}else{var B=Vt(e),J=B==ee||B==ge;if(bi(e))return Iu(e,b);if(B==Se||B==Ie||J&&!l){if(w=A||J?{}:Hu(e),!b)return A?Rd(e,Yp(w,e)):Ad(e,Zc(w,e))}else{if(!He[B])return l?e:{};w=zd(e,B,b)}}p||(p=new Tr);var te=p.get(e);if(te)return te;p.set(e,w),vh(e)?e.forEach(function(ae){w.add(Er(ae,t,s,ae,e,p))}):gh(e)&&e.forEach(function(ae,Pe){w.set(Pe,Er(ae,t,s,Pe,e,p))});var oe=q?A?Sa:Pa:A?or:jt,Ee=M?i:oe(e);return wr(Ee||e,function(ae,Pe){Ee&&(Pe=ae,ae=e[Pe]),Cs(w,Pe,Er(ae,t,s,Pe,e,p))}),w}function Xp(e){var t=jt(e);return function(s){return eu(s,e,t)}}function eu(e,t,s){var a=s.length;if(e==null)return!a;for(e=We(e);a--;){var l=s[a],p=t[l],w=e[l];if(w===i&&!(l in e)||!p(w))return!1}return!0}function tu(e,t,s){if(typeof e!="function")throw new _r(d);return qs(function(){e.apply(i,s)},t)}function Ts(e,t,s,a){var l=-1,p=_n,w=!0,b=e.length,A=[],q=t.length;if(!b)return A;s&&(t=st(t,fr(s))),a?(p=Vo,w=!1):t.length>=o&&(p=xs,w=!1,t=new $i(t));e:for(;++l<b;){var M=e[l],B=s==null?M:s(M);if(M=a||M!==0?M:0,w&&B===B){for(var J=q;J--;)if(t[J]===B)continue e;A.push(M)}else p(t,B,a)||A.push(M)}return A}var vi=Ru(Hr),ru=Ru(ca,!0);function Zp(e,t){var s=!0;return vi(e,function(a,l,p){return s=!!t(a,l,p),s}),s}function Mn(e,t,s){for(var a=-1,l=e.length;++a<l;){var p=e[a],w=t(p);if(w!=null&&(b===i?w===w&&!dr(w):s(w,b)))var b=w,A=p}return A}function ed(e,t,s,a){var l=e.length;for(s=_e(s),s<0&&(s=-s>l?0:l+s),a=a===i||a>l?l:_e(a),a<0&&(a+=l),a=s>a?0:wh(a);s<a;)e[s++]=t;return e}function iu(e,t){var s=[];return vi(e,function(a,l,p){t(a,l,p)&&s.push(a)}),s}function Bt(e,t,s,a,l){var p=-1,w=e.length;for(s||(s=Hd),l||(l=[]);++p<w;){var b=e[p];t>0&&s(b)?t>1?Bt(b,t-1,s,a,l):di(l,b):a||(l[l.length]=b)}return l}var aa=Ou(),su=Ou(!0);function Hr(e,t){return e&&aa(e,t,jt)}function ca(e,t){return e&&su(e,t,jt)}function jn(e,t){return pi(t,function(s){return ti(e[s])})}function qi(e,t){t=wi(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[kr(t[s++])];return s&&s==a?e:i}function nu(e,t,s){var a=t(e);return we(e)?a:di(a,s(e))}function Yt(e){return e==null?e===i?at:Fe:Di&&Di in We(e)?Ld(e):Jd(e)}function ua(e,t){return e>t}function td(e,t){return e!=null&&je.call(e,t)}function rd(e,t){return e!=null&&t in We(e)}function id(e,t,s){return e>=Kt(t,s)&&e<Lt(t,s)}function ha(e,t,s){for(var a=s?Vo:_n,l=e[0].length,p=e.length,w=p,b=T(p),A=1/0,q=[];w--;){var M=e[w];w&&t&&(M=st(M,fr(t))),A=Kt(M.length,A),b[w]=!s&&(t||l>=120&&M.length>=120)?new $i(w&&M):i}M=e[0];var B=-1,J=b[0];e:for(;++B<l&&q.length<A;){var te=M[B],oe=t?t(te):te;if(te=s||te!==0?te:0,!(J?xs(J,oe):a(q,oe,s))){for(w=p;--w;){var Ee=b[w];if(!(Ee?xs(Ee,oe):a(e[w],oe,s)))continue e}J&&J.push(oe),q.push(te)}}return q}function sd(e,t,s,a){return Hr(e,function(l,p,w){t(a,s(l),p,w)}),a}function Ns(e,t,s){t=wi(t,e),e=Vu(e,t);var a=e==null?e:e[kr(xr(t))];return a==null?i:Mt(a,e,s)}function ou(e){return vt(e)&&Yt(e)==Ie}function nd(e){return vt(e)&&Yt(e)==De}function od(e){return vt(e)&&Yt(e)==R}function Ds(e,t,s,a,l){return e===t?!0:e==null||t==null||!vt(e)&&!vt(t)?e!==e&&t!==t:ad(e,t,s,a,Ds,l)}function ad(e,t,s,a,l,p){var w=we(e),b=we(t),A=w?It:Vt(e),q=b?It:Vt(t);A=A==Ie?Se:A,q=q==Ie?Se:q;var M=A==Se,B=q==Se,J=A==q;if(J&&bi(e)){if(!bi(t))return!1;w=!0,M=!1}if(J&&!M)return p||(p=new Tr),w||ls(e)?ju(e,t,s,a,l,p):Fd(e,t,A,s,a,l,p);if(!(s&C)){var te=M&&je.call(e,"__wrapped__"),oe=B&&je.call(t,"__wrapped__");if(te||oe){var Ee=te?e.value():e,ae=oe?t.value():t;return p||(p=new Tr),l(Ee,ae,s,a,p)}}return J?(p||(p=new Tr),$d(e,t,s,a,l,p)):!1}function cd(e){return vt(e)&&Vt(e)==be}function la(e,t,s,a){var l=s.length,p=l,w=!a;if(e==null)return!p;for(e=We(e);l--;){var b=s[l];if(w&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++l<p;){b=s[l];var A=b[0],q=e[A],M=b[1];if(w&&b[2]){if(q===i&&!(A in e))return!1}else{var B=new Tr;if(a)var J=a(q,M,A,e,t,B);if(!(J===i?Ds(M,q,C|K,a,B):J))return!1}}return!0}function au(e){if(!ut(e)||kd(e))return!1;var t=ti(e)?cp:Co;return t.test(ji(e))}function ud(e){return vt(e)&&Yt(e)==ot}function hd(e){return vt(e)&&Vt(e)==Le}function ld(e){return vt(e)&&ro(e.length)&&!!Ke[Yt(e)]}function cu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?we(e)?lu(e[0],e[1]):hu(e):Ch(e)}function fa(e){if(!Ls(e))return dp(e);var t=[];for(var s in We(e))je.call(e,s)&&s!="constructor"&&t.push(s);return t}function fd(e){if(!ut(e))return Wd(e);var t=Ls(e),s=[];for(var a in e)a=="constructor"&&(t||!je.call(e,a))||s.push(a);return s}function pa(e,t){return e<t}function uu(e,t){var s=-1,a=nr(e)?T(e.length):[];return vi(e,function(l,p,w){a[++s]=t(l,p,w)}),a}function hu(e){var t=Ra(e);return t.length==1&&t[0][2]?ku(t[0][0],t[0][1]):function(s){return s===e||la(s,e,t)}}function lu(e,t){return Ca(e)&&Bu(t)?ku(kr(e),t):function(s){var a=za(s,e);return a===i&&a===t?Ua(s,e):Ds(t,a,C|K)}}function zn(e,t,s,a,l){e!==t&&aa(t,function(p,w){if(l||(l=new Tr),ut(p))pd(e,t,w,s,zn,a,l);else{var b=a?a(Na(e,w),p,w+"",e,t,l):i;b===i&&(b=p),na(e,w,b)}},or)}function pd(e,t,s,a,l,p,w){var b=Na(e,s),A=Na(t,s),q=w.get(A);if(q){na(e,s,q);return}var M=p?p(b,A,s+"",e,t,w):i,B=M===i;if(B){var J=we(A),te=!J&&bi(A),oe=!J&&!te&&ls(A);M=A,J||te||oe?we(b)?M=b:bt(b)?M=sr(b):te?(B=!1,M=Iu(A,!0)):oe?(B=!1,M=xu(A,!0)):M=[]:Ms(A)||zi(A)?(M=b,zi(b)?M=_h(b):(!ut(b)||ti(b))&&(M=Hu(A))):B=!1}B&&(w.set(A,M),l(M,A,a,p,w),w.delete(A)),na(e,s,M)}function fu(e,t){var s=e.length;if(s)return t+=t<0?s:0,ei(t,s)?e[t]:i}function pu(e,t,s){t.length?t=st(t,function(p){return we(p)?function(w){return qi(w,p.length===1?p[0]:p)}:p}):t=[ar];var a=-1;t=st(t,fr(ne()));var l=uu(e,function(p,w,b){var A=st(t,function(q){return q(p)});return{criteria:A,index:++a,value:p}});return zf(l,function(p,w){return Sd(p,w,s)})}function dd(e,t){return du(e,t,function(s,a){return Ua(e,a)})}function du(e,t,s){for(var a=-1,l=t.length,p={};++a<l;){var w=t[a],b=qi(e,w);s(b,w)&&Fs(p,wi(w,e),b)}return p}function gd(e){return function(t){return qi(t,e)}}function da(e,t,s,a){var l=a?jf:es,p=-1,w=t.length,b=e;for(e===t&&(t=sr(t)),s&&(b=st(e,fr(s)));++p<w;)for(var A=0,q=t[p],M=s?s(q):q;(A=l(b,M,A,a))>-1;)b!==e&&Cn.call(b,A,1),Cn.call(e,A,1);return e}function gu(e,t){for(var s=e?t.length:0,a=s-1;s--;){var l=t[s];if(s==a||l!==p){var p=l;ei(l)?Cn.call(e,l,1):ma(e,l)}}return e}function ga(e,t){return e+Dn(Jc()*(t-e+1))}function yd(e,t,s,a){for(var l=-1,p=Lt(Nn((t-e)/(s||1)),0),w=T(p);p--;)w[a?p:++l]=e,e+=s;return w}function ya(e,t){var s="";if(!e||t<1||t>V)return s;do t%2&&(s+=e),t=Dn(t/2),t&&(e+=e);while(t);return s}function xe(e,t){return Da(Ku(e,t,ar),e+"")}function vd(e){return Xc(fs(e))}function md(e,t){var s=fs(e);return Qn(s,Li(t,0,s.length))}function Fs(e,t,s,a){if(!ut(e))return e;t=wi(t,e);for(var l=-1,p=t.length,w=p-1,b=e;b!=null&&++l<p;){var A=kr(t[l]),q=s;if(A==="__proto__"||A==="constructor"||A==="prototype")return e;if(l!=w){var M=b[A];q=a?a(M,A,b):i,q===i&&(q=ut(M)?M:ei(t[l+1])?[]:{})}Cs(b,A,q),b=b[A]}return e}var yu=Fn?function(e,t){return Fn.set(e,t),e}:ar,wd=Tn?function(e,t){return Tn(e,"toString",{configurable:!0,enumerable:!1,value:Ba(t),writable:!0})}:ar;function _d(e){return Qn(fs(e))}function Ir(e,t,s){var a=-1,l=e.length;t<0&&(t=-t>l?0:l+t),s=s>l?l:s,s<0&&(s+=l),l=t>s?0:s-t>>>0,t>>>=0;for(var p=T(l);++a<l;)p[a]=e[a+t];return p}function bd(e,t){var s;return vi(e,function(a,l,p){return s=t(a,l,p),!s}),!!s}function Un(e,t,s){var a=0,l=e==null?a:e.length;if(typeof t=="number"&&t===t&&l<=Be){for(;a<l;){var p=a+l>>>1,w=e[p];w!==null&&!dr(w)&&(s?w<=t:w<t)?a=p+1:l=p}return l}return va(e,t,ar,s)}function va(e,t,s,a){var l=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var w=t!==t,b=t===null,A=dr(t),q=t===i;l<p;){var M=Dn((l+p)/2),B=s(e[M]),J=B!==i,te=B===null,oe=B===B,Ee=dr(B);if(w)var ae=a||oe;else q?ae=oe&&(a||J):b?ae=oe&&J&&(a||!te):A?ae=oe&&J&&!te&&(a||!Ee):te||Ee?ae=!1:ae=a?B<=t:B<t;ae?l=M+1:p=M}return Kt(p,Je)}function vu(e,t){for(var s=-1,a=e.length,l=0,p=[];++s<a;){var w=e[s],b=t?t(w):w;if(!s||!Nr(b,A)){var A=b;p[l++]=w===0?0:w}}return p}function mu(e){return typeof e=="number"?e:dr(e)?k:+e}function pr(e){if(typeof e=="string")return e;if(we(e))return st(e,pr)+"";if(dr(e))return Qc?Qc.call(e):"";var t=e+"";return t=="0"&&1/e==-ce?"-0":t}function mi(e,t,s){var a=-1,l=_n,p=e.length,w=!0,b=[],A=b;if(s)w=!1,l=Vo;else if(p>=o){var q=t?null:Nd(e);if(q)return En(q);w=!1,l=xs,A=new $i}else A=t?[]:b;e:for(;++a<p;){var M=e[a],B=t?t(M):M;if(M=s||M!==0?M:0,w&&B===B){for(var J=A.length;J--;)if(A[J]===B)continue e;t&&A.push(B),b.push(M)}else l(A,B,s)||(A!==b&&A.push(B),b.push(M))}return b}function ma(e,t){return t=wi(t,e),e=Vu(e,t),e==null||delete e[kr(xr(t))]}function wu(e,t,s,a){return Fs(e,t,s(qi(e,t)),a)}function Hn(e,t,s,a){for(var l=e.length,p=a?l:-1;(a?p--:++p<l)&&t(e[p],p,e););return s?Ir(e,a?0:p,a?p+1:l):Ir(e,a?p+1:0,a?l:p)}function _u(e,t){var s=e;return s instanceof Ae&&(s=s.value()),Go(t,function(a,l){return l.func.apply(l.thisArg,di([a],l.args))},s)}function wa(e,t,s){var a=e.length;if(a<2)return a?mi(e[0]):[];for(var l=-1,p=T(a);++l<a;)for(var w=e[l],b=-1;++b<a;)b!=l&&(p[l]=Ts(p[l]||w,e[b],t,s));return mi(Bt(p,1),t,s)}function bu(e,t,s){for(var a=-1,l=e.length,p=t.length,w={};++a<l;){var b=a<p?t[a]:i;s(w,e[a],b)}return w}function _a(e){return bt(e)?e:[]}function ba(e){return typeof e=="function"?e:ar}function wi(e,t){return we(e)?e:Ca(e,t)?[e]:Qu(qe(e))}var Ed=xe;function _i(e,t,s){var a=e.length;return s=s===i?a:s,!t&&s>=a?e:Ir(e,t,s)}var Eu=up||function(e){return Re.clearTimeout(e)};function Iu(e,t){if(t)return e.slice();var s=e.length,a=kc?kc(s):new e.constructor(s);return e.copy(a),a}function Ea(e){var t=new e.constructor(e.byteLength);return new Rn(t).set(new Rn(e)),t}function Id(e,t){var s=t?Ea(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function xd(e){var t=new e.constructor(e.source,vr.exec(e));return t.lastIndex=e.lastIndex,t}function Pd(e){return Os?We(Os.call(e)):{}}function xu(e,t){var s=t?Ea(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Pu(e,t){if(e!==t){var s=e!==i,a=e===null,l=e===e,p=dr(e),w=t!==i,b=t===null,A=t===t,q=dr(t);if(!b&&!q&&!p&&e>t||p&&w&&A&&!b&&!q||a&&w&&A||!s&&A||!l)return 1;if(!a&&!p&&!q&&e<t||q&&s&&l&&!a&&!p||b&&s&&l||!w&&l||!A)return-1}return 0}function Sd(e,t,s){for(var a=-1,l=e.criteria,p=t.criteria,w=l.length,b=s.length;++a<w;){var A=Pu(l[a],p[a]);if(A){if(a>=b)return A;var q=s[a];return A*(q=="desc"?-1:1)}}return e.index-t.index}function Su(e,t,s,a){for(var l=-1,p=e.length,w=s.length,b=-1,A=t.length,q=Lt(p-w,0),M=T(A+q),B=!a;++b<A;)M[b]=t[b];for(;++l<w;)(B||l<p)&&(M[s[l]]=e[l]);for(;q--;)M[b++]=e[l++];return M}function Au(e,t,s,a){for(var l=-1,p=e.length,w=-1,b=s.length,A=-1,q=t.length,M=Lt(p-b,0),B=T(M+q),J=!a;++l<M;)B[l]=e[l];for(var te=l;++A<q;)B[te+A]=t[A];for(;++w<b;)(J||l<p)&&(B[te+s[w]]=e[l++]);return B}function sr(e,t){var s=-1,a=e.length;for(t||(t=T(a));++s<a;)t[s]=e[s];return t}function Br(e,t,s,a){var l=!s;s||(s={});for(var p=-1,w=t.length;++p<w;){var b=t[p],A=a?a(s[b],e[b],b,s,e):i;A===i&&(A=e[b]),l?Yr(s,b,A):Cs(s,b,A)}return s}function Ad(e,t){return Br(e,Oa(e),t)}function Rd(e,t){return Br(e,zu(e),t)}function Bn(e,t){return function(s,a){var l=we(s)?Df:Qp,p=t?t():{};return l(s,e,ne(a,2),p)}}function cs(e){return xe(function(t,s){var a=-1,l=s.length,p=l>1?s[l-1]:i,w=l>2?s[2]:i;for(p=e.length>3&&typeof p=="function"?(l--,p):i,w&&Xt(s[0],s[1],w)&&(p=l<3?i:p,l=1),t=We(t);++a<l;){var b=s[a];b&&e(t,b,a,p)}return t})}function Ru(e,t){return function(s,a){if(s==null)return s;if(!nr(s))return e(s,a);for(var l=s.length,p=t?l:-1,w=We(s);(t?p--:++p<l)&&a(w[p],p,w)!==!1;);return s}}function Ou(e){return function(t,s,a){for(var l=-1,p=We(t),w=a(t),b=w.length;b--;){var A=w[e?b:++l];if(s(p[A],A,p)===!1)break}return t}}function Od(e,t,s){var a=t&re,l=$s(e);function p(){var w=this&&this!==Re&&this instanceof p?l:e;return w.apply(a?s:this,arguments)}return p}function Cu(e){return function(t){t=qe(t);var s=ts(t)?Cr(t):i,a=s?s[0]:t.charAt(0),l=s?_i(s,1).join(""):t.slice(1);return a[e]()+l}}function us(e){return function(t){return Go(Rh(Ah(t).replace(Es,"")),e,"")}}function $s(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=as(e.prototype),a=e.apply(s,t);return ut(a)?a:s}}function Cd(e,t,s){var a=$s(e);function l(){for(var p=arguments.length,w=T(p),b=p,A=hs(l);b--;)w[b]=arguments[b];var q=p<3&&w[0]!==A&&w[p-1]!==A?[]:gi(w,A);if(p-=q.length,p<s)return $u(e,t,kn,l.placeholder,i,w,q,i,i,s-p);var M=this&&this!==Re&&this instanceof l?a:e;return Mt(M,this,w)}return l}function Tu(e){return function(t,s,a){var l=We(t);if(!nr(t)){var p=ne(s,3);t=jt(t),s=function(b){return p(l[b],b,l)}}var w=e(t,s,a);return w>-1?l[p?t[w]:w]:i}}function Nu(e){return Zr(function(t){var s=t.length,a=s,l=br.prototype.thru;for(e&&t.reverse();a--;){var p=t[a];if(typeof p!="function")throw new _r(d);if(l&&!w&&Wn(p)=="wrapper")var w=new br([],!0)}for(a=w?a:s;++a<s;){p=t[a];var b=Wn(p),A=b=="wrapper"?Aa(p):i;A&&Ta(A[0])&&A[1]==(U|fe|de|W)&&!A[4].length&&A[9]==1?w=w[Wn(A[0])].apply(w,A[3]):w=p.length==1&&Ta(p)?w[b]():w.thru(p)}return function(){var q=arguments,M=q[0];if(w&&q.length==1&&we(M))return w.plant(M).value();for(var B=0,J=s?t[B].apply(this,q):M;++B<s;)J=t[B].call(this,J);return J}})}function kn(e,t,s,a,l,p,w,b,A,q){var M=t&U,B=t&re,J=t&he,te=t&(fe|pe),oe=t&ve,Ee=J?i:$s(e);function ae(){for(var Pe=arguments.length,Oe=T(Pe),gr=Pe;gr--;)Oe[gr]=arguments[gr];if(te)var Zt=hs(ae),yr=Hf(Oe,Zt);if(a&&(Oe=Su(Oe,a,l,te)),p&&(Oe=Au(Oe,p,w,te)),Pe-=yr,te&&Pe<q){var Et=gi(Oe,Zt);return $u(e,t,kn,ae.placeholder,s,Oe,Et,b,A,q-Pe)}var Dr=B?s:this,ii=J?Dr[e]:e;return Pe=Oe.length,b?Oe=Qd(Oe,b):oe&&Pe>1&&Oe.reverse(),M&&A<Pe&&(Oe.length=A),this&&this!==Re&&this instanceof ae&&(ii=Ee||$s(ii)),ii.apply(Dr,Oe)}return ae}function Du(e,t){return function(s,a){return sd(s,e,t(a),{})}}function Kn(e,t){return function(s,a){var l;if(s===i&&a===i)return t;if(s!==i&&(l=s),a!==i){if(l===i)return a;typeof s=="string"||typeof a=="string"?(s=pr(s),a=pr(a)):(s=mu(s),a=mu(a)),l=e(s,a)}return l}}function Ia(e){return Zr(function(t){return t=st(t,fr(ne())),xe(function(s){var a=this;return e(t,function(l){return Mt(l,a,s)})})})}function Vn(e,t){t=t===i?" ":pr(t);var s=t.length;if(s<2)return s?ya(t,e):t;var a=ya(t,Nn(e/rs(t)));return ts(t)?_i(Cr(a),0,e).join(""):a.slice(0,e)}function Td(e,t,s,a){var l=t&re,p=$s(e);function w(){for(var b=-1,A=arguments.length,q=-1,M=a.length,B=T(M+A),J=this&&this!==Re&&this instanceof w?p:e;++q<M;)B[q]=a[q];for(;A--;)B[q++]=arguments[++b];return Mt(J,l?s:this,B)}return w}function Fu(e){return function(t,s,a){return a&&typeof a!="number"&&Xt(t,s,a)&&(s=a=i),t=ri(t),s===i?(s=t,t=0):s=ri(s),a=a===i?t<s?1:-1:ri(a),yd(t,s,a,e)}}function Gn(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=Pr(t),s=Pr(s)),e(t,s)}}function $u(e,t,s,a,l,p,w,b,A,q){var M=t&fe,B=M?w:i,J=M?i:w,te=M?p:i,oe=M?i:p;t|=M?de:$,t&=~(M?$:de),t&le||(t&=~(re|he));var Ee=[e,t,l,te,B,oe,J,b,A,q],ae=s.apply(i,Ee);return Ta(e)&&Gu(ae,Ee),ae.placeholder=a,Wu(ae,e,t)}function xa(e){var t=$t[e];return function(s,a){if(s=Pr(s),a=a==null?0:Kt(_e(a),292),a&&Wc(s)){var l=(qe(s)+"e").split("e"),p=t(l[0]+"e"+(+l[1]+a));return l=(qe(p)+"e").split("e"),+(l[0]+"e"+(+l[1]-a))}return t(s)}}var Nd=ns&&1/En(new ns([,-0]))[1]==ce?function(e){return new ns(e)}:Va;function Lu(e){return function(t){var s=Vt(t);return s==be?ea(t):s==Le?Jf(t):Uf(t,e(t))}}function Xr(e,t,s,a,l,p,w,b){var A=t&he;if(!A&&typeof e!="function")throw new _r(d);var q=a?a.length:0;if(q||(t&=~(de|$),a=l=i),w=w===i?w:Lt(_e(w),0),b=b===i?b:_e(b),q-=l?l.length:0,t&$){var M=a,B=l;a=l=i}var J=A?i:Aa(e),te=[e,t,s,a,l,M,B,p,w,b];if(J&&Gd(te,J),e=te[0],t=te[1],s=te[2],a=te[3],l=te[4],b=te[9]=te[9]===i?A?0:e.length:Lt(te[9]-q,0),!b&&t&(fe|pe)&&(t&=~(fe|pe)),!t||t==re)var oe=Od(e,t,s);else t==fe||t==pe?oe=Cd(e,t,b):(t==de||t==(re|de))&&!l.length?oe=Td(e,t,s,a):oe=kn.apply(i,te);var Ee=J?yu:Gu;return Wu(Ee(oe,te),e,t)}function qu(e,t,s,a){return e===i||Nr(e,ss[s])&&!je.call(a,s)?t:e}function Mu(e,t,s,a,l,p){return ut(e)&&ut(t)&&(p.set(t,e),zn(e,t,i,Mu,p),p.delete(t)),e}function Dd(e){return Ms(e)?i:e}function ju(e,t,s,a,l,p){var w=s&C,b=e.length,A=t.length;if(b!=A&&!(w&&A>b))return!1;var q=p.get(e),M=p.get(t);if(q&&M)return q==t&&M==e;var B=-1,J=!0,te=s&K?new $i:i;for(p.set(e,t),p.set(t,e);++B<b;){var oe=e[B],Ee=t[B];if(a)var ae=w?a(Ee,oe,B,t,e,p):a(oe,Ee,B,e,t,p);if(ae!==i){if(ae)continue;J=!1;break}if(te){if(!Wo(t,function(Pe,Oe){if(!xs(te,Oe)&&(oe===Pe||l(oe,Pe,s,a,p)))return te.push(Oe)})){J=!1;break}}else if(!(oe===Ee||l(oe,Ee,s,a,p))){J=!1;break}}return p.delete(e),p.delete(t),J}function Fd(e,t,s,a,l,p,w){switch(s){case ke:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case De:return!(e.byteLength!=t.byteLength||!p(new Rn(e),new Rn(t)));case D:case R:case Ne:return Nr(+e,+t);case E:return e.name==t.name&&e.message==t.message;case ot:case Ye:return e==t+"";case be:var b=ea;case Le:var A=a&C;if(b||(b=En),e.size!=t.size&&!A)return!1;var q=w.get(e);if(q)return q==t;a|=K,w.set(e,t);var M=ju(b(e),b(t),a,l,p,w);return w.delete(e),M;case Xe:if(Os)return Os.call(e)==Os.call(t)}return!1}function $d(e,t,s,a,l,p){var w=s&C,b=Pa(e),A=b.length,q=Pa(t),M=q.length;if(A!=M&&!w)return!1;for(var B=A;B--;){var J=b[B];if(!(w?J in t:je.call(t,J)))return!1}var te=p.get(e),oe=p.get(t);if(te&&oe)return te==t&&oe==e;var Ee=!0;p.set(e,t),p.set(t,e);for(var ae=w;++B<A;){J=b[B];var Pe=e[J],Oe=t[J];if(a)var gr=w?a(Oe,Pe,J,t,e,p):a(Pe,Oe,J,e,t,p);if(!(gr===i?Pe===Oe||l(Pe,Oe,s,a,p):gr)){Ee=!1;break}ae||(ae=J=="constructor")}if(Ee&&!ae){var Zt=e.constructor,yr=t.constructor;Zt!=yr&&"constructor"in e&&"constructor"in t&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof yr=="function"&&yr instanceof yr)&&(Ee=!1)}return p.delete(e),p.delete(t),Ee}function Zr(e){return Da(Ku(e,i,eh),e+"")}function Pa(e){return nu(e,jt,Oa)}function Sa(e){return nu(e,or,zu)}var Aa=Fn?function(e){return Fn.get(e)}:Va;function Wn(e){for(var t=e.name+"",s=os[t],a=je.call(os,t)?s.length:0;a--;){var l=s[a],p=l.func;if(p==null||p==e)return l.name}return t}function hs(e){var t=je.call(f,"placeholder")?f:e;return t.placeholder}function ne(){var e=f.iteratee||ka;return e=e===ka?cu:e,arguments.length?e(arguments[0],arguments[1]):e}function Jn(e,t){var s=e.__data__;return Bd(t)?s[typeof t=="string"?"string":"hash"]:s.map}function Ra(e){for(var t=jt(e),s=t.length;s--;){var a=t[s],l=e[a];t[s]=[a,l,Bu(l)]}return t}function Mi(e,t){var s=Vf(e,t);return au(s)?s:i}function Ld(e){var t=je.call(e,Di),s=e[Di];try{e[Di]=i;var a=!0}catch{}var l=Sn.call(e);return a&&(t?e[Di]=s:delete e[Di]),l}var Oa=ra?function(e){return e==null?[]:(e=We(e),pi(ra(e),function(t){return Vc.call(e,t)}))}:Ga,zu=ra?function(e){for(var t=[];e;)di(t,Oa(e)),e=On(e);return t}:Ga,Vt=Yt;(ia&&Vt(new ia(new ArrayBuffer(1)))!=ke||Ss&&Vt(new Ss)!=be||sa&&Vt(sa.resolve())!=xt||ns&&Vt(new ns)!=Le||As&&Vt(new As)!=Ue)&&(Vt=function(e){var t=Yt(e),s=t==Se?e.constructor:i,a=s?ji(s):"";if(a)switch(a){case mp:return ke;case wp:return be;case _p:return xt;case bp:return Le;case Ep:return Ue}return t});function qd(e,t,s){for(var a=-1,l=s.length;++a<l;){var p=s[a],w=p.size;switch(p.type){case"drop":e+=w;break;case"dropRight":t-=w;break;case"take":t=Kt(t,e+w);break;case"takeRight":e=Lt(e,t-w);break}}return{start:e,end:t}}function Md(e){var t=e.match(Qe);return t?t[1].split(Ot):[]}function Uu(e,t,s){t=wi(t,e);for(var a=-1,l=t.length,p=!1;++a<l;){var w=kr(t[a]);if(!(p=e!=null&&s(e,w)))break;e=e[w]}return p||++a!=l?p:(l=e==null?0:e.length,!!l&&ro(l)&&ei(w,l)&&(we(e)||zi(e)))}function jd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&je.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Hu(e){return typeof e.constructor=="function"&&!Ls(e)?as(On(e)):{}}function zd(e,t,s){var a=e.constructor;switch(t){case De:return Ea(e);case D:case R:return new a(+e);case ke:return Id(e,s);case ht:case Me:case Pt:case Ft:case Ut:case Ht:case qt:case Wt:case rr:return xu(e,s);case be:return new a;case Ne:case Ye:return new a(e);case ot:return xd(e);case Le:return new a;case Xe:return Pd(e)}}function Ud(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+t+`] */
`)}function Hd(e){return we(e)||zi(e)||!!(Gc&&e&&e[Gc])}function ei(e,t){var s=typeof e;return t=t??V,!!t&&(s=="number"||s!="symbol"&&No.test(e))&&e>-1&&e%1==0&&e<t}function Xt(e,t,s){if(!ut(s))return!1;var a=typeof t;return(a=="number"?nr(s)&&ei(t,s.length):a=="string"&&t in s)?Nr(s[t],e):!1}function Ca(e,t){if(we(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||dr(e)?!0:St.test(e)||!it.test(e)||t!=null&&e in We(t)}function Bd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ta(e){var t=Wn(e),s=f[t];if(typeof s!="function"||!(t in Ae.prototype))return!1;if(e===s)return!0;var a=Aa(s);return!!a&&e===a[0]}function kd(e){return!!Bc&&Bc in e}var Kd=xn?ti:Wa;function Ls(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||ss;return e===s}function Bu(e){return e===e&&!ut(e)}function ku(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in We(s))}}function Vd(e){var t=eo(e,function(a){return s.size===m&&s.clear(),a}),s=t.cache;return t}function Gd(e,t){var s=e[1],a=t[1],l=s|a,p=l<(re|he|U),w=a==U&&s==fe||a==U&&s==W&&e[7].length<=t[8]||a==(U|W)&&t[7].length<=t[8]&&s==fe;if(!(p||w))return e;a&re&&(e[2]=t[2],l|=s&re?0:le);var b=t[3];if(b){var A=e[3];e[3]=A?Su(A,b,t[4]):b,e[4]=A?gi(e[3],x):t[4]}return b=t[5],b&&(A=e[5],e[5]=A?Au(A,b,t[6]):b,e[6]=A?gi(e[5],x):t[6]),b=t[7],b&&(e[7]=b),a&U&&(e[8]=e[8]==null?t[8]:Kt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function Wd(e){var t=[];if(e!=null)for(var s in We(e))t.push(s);return t}function Jd(e){return Sn.call(e)}function Ku(e,t,s){return t=Lt(t===i?e.length-1:t,0),function(){for(var a=arguments,l=-1,p=Lt(a.length-t,0),w=T(p);++l<p;)w[l]=a[t+l];l=-1;for(var b=T(t+1);++l<t;)b[l]=a[l];return b[t]=s(w),Mt(e,this,b)}}function Vu(e,t){return t.length<2?e:qi(e,Ir(t,0,-1))}function Qd(e,t){for(var s=e.length,a=Kt(t.length,s),l=sr(e);a--;){var p=t[a];e[a]=ei(p,s)?l[p]:i}return e}function Na(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Gu=Ju(yu),qs=lp||function(e,t){return Re.setTimeout(e,t)},Da=Ju(wd);function Wu(e,t,s){var a=t+"";return Da(e,Ud(a,Yd(Md(a),s)))}function Ju(e){var t=0,s=0;return function(){var a=gp(),l=ze-(a-s);if(s=a,l>0){if(++t>=Te)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Qn(e,t){var s=-1,a=e.length,l=a-1;for(t=t===i?a:t;++s<t;){var p=ga(s,l),w=e[p];e[p]=e[s],e[s]=w}return e.length=t,e}var Qu=Vd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(At,function(s,a,l,p){t.push(l?p.replace(So,"$1"):a||s)}),t});function kr(e){if(typeof e=="string"||dr(e))return e;var t=e+"";return t=="0"&&1/e==-ce?"-0":t}function ji(e){if(e!=null){try{return Pn.call(e)}catch{}try{return e+""}catch{}}return""}function Yd(e,t){return wr(Mr,function(s){var a="_."+s[0];t&s[1]&&!_n(e,a)&&e.push(a)}),e.sort()}function Yu(e){if(e instanceof Ae)return e.clone();var t=new br(e.__wrapped__,e.__chain__);return t.__actions__=sr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Xd(e,t,s){(s?Xt(e,t,s):t===i)?t=1:t=Lt(_e(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var l=0,p=0,w=T(Nn(a/t));l<a;)w[p++]=Ir(e,l,l+=t);return w}function Zd(e){for(var t=-1,s=e==null?0:e.length,a=0,l=[];++t<s;){var p=e[t];p&&(l[a++]=p)}return l}function eg(){var e=arguments.length;if(!e)return[];for(var t=T(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return di(we(s)?sr(s):[s],Bt(t,1))}var tg=xe(function(e,t){return bt(e)?Ts(e,Bt(t,1,bt,!0)):[]}),rg=xe(function(e,t){var s=xr(t);return bt(s)&&(s=i),bt(e)?Ts(e,Bt(t,1,bt,!0),ne(s,2)):[]}),ig=xe(function(e,t){var s=xr(t);return bt(s)&&(s=i),bt(e)?Ts(e,Bt(t,1,bt,!0),i,s):[]});function sg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:_e(t),Ir(e,t<0?0:t,a)):[]}function ng(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:_e(t),t=a-t,Ir(e,0,t<0?0:t)):[]}function og(e,t){return e&&e.length?Hn(e,ne(t,3),!0,!0):[]}function ag(e,t){return e&&e.length?Hn(e,ne(t,3),!0):[]}function cg(e,t,s,a){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Xt(e,t,s)&&(s=0,a=l),ed(e,t,s,a)):[]}function Xu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:_e(s);return l<0&&(l=Lt(a+l,0)),bn(e,ne(t,3),l)}function Zu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a-1;return s!==i&&(l=_e(s),l=s<0?Lt(a+l,0):Kt(l,a-1)),bn(e,ne(t,3),l,!0)}function eh(e){var t=e==null?0:e.length;return t?Bt(e,1):[]}function ug(e){var t=e==null?0:e.length;return t?Bt(e,ce):[]}function hg(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:_e(t),Bt(e,t)):[]}function lg(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var l=e[t];a[l[0]]=l[1]}return a}function th(e){return e&&e.length?e[0]:i}function fg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:_e(s);return l<0&&(l=Lt(a+l,0)),es(e,t,l)}function pg(e){var t=e==null?0:e.length;return t?Ir(e,0,-1):[]}var dg=xe(function(e){var t=st(e,_a);return t.length&&t[0]===e[0]?ha(t):[]}),gg=xe(function(e){var t=xr(e),s=st(e,_a);return t===xr(s)?t=i:s.pop(),s.length&&s[0]===e[0]?ha(s,ne(t,2)):[]}),yg=xe(function(e){var t=xr(e),s=st(e,_a);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?ha(s,i,t):[]});function vg(e,t){return e==null?"":pp.call(e,t)}function xr(e){var t=e==null?0:e.length;return t?e[t-1]:i}function mg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a;return s!==i&&(l=_e(s),l=l<0?Lt(a+l,0):Kt(l,a-1)),t===t?Yf(e,t,l):bn(e,$c,l,!0)}function wg(e,t){return e&&e.length?fu(e,_e(t)):i}var _g=xe(rh);function rh(e,t){return e&&e.length&&t&&t.length?da(e,t):e}function bg(e,t,s){return e&&e.length&&t&&t.length?da(e,t,ne(s,2)):e}function Eg(e,t,s){return e&&e.length&&t&&t.length?da(e,t,i,s):e}var Ig=Zr(function(e,t){var s=e==null?0:e.length,a=oa(e,t);return gu(e,st(t,function(l){return ei(l,s)?+l:l}).sort(Pu)),a});function xg(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,l=[],p=e.length;for(t=ne(t,3);++a<p;){var w=e[a];t(w,a,e)&&(s.push(w),l.push(a))}return gu(e,l),s}function Fa(e){return e==null?e:vp.call(e)}function Pg(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Xt(e,t,s)?(t=0,s=a):(t=t==null?0:_e(t),s=s===i?a:_e(s)),Ir(e,t,s)):[]}function Sg(e,t){return Un(e,t)}function Ag(e,t,s){return va(e,t,ne(s,2))}function Rg(e,t){var s=e==null?0:e.length;if(s){var a=Un(e,t);if(a<s&&Nr(e[a],t))return a}return-1}function Og(e,t){return Un(e,t,!0)}function Cg(e,t,s){return va(e,t,ne(s,2),!0)}function Tg(e,t){var s=e==null?0:e.length;if(s){var a=Un(e,t,!0)-1;if(Nr(e[a],t))return a}return-1}function Ng(e){return e&&e.length?vu(e):[]}function Dg(e,t){return e&&e.length?vu(e,ne(t,2)):[]}function Fg(e){var t=e==null?0:e.length;return t?Ir(e,1,t):[]}function $g(e,t,s){return e&&e.length?(t=s||t===i?1:_e(t),Ir(e,0,t<0?0:t)):[]}function Lg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:_e(t),t=a-t,Ir(e,t<0?0:t,a)):[]}function qg(e,t){return e&&e.length?Hn(e,ne(t,3),!1,!0):[]}function Mg(e,t){return e&&e.length?Hn(e,ne(t,3)):[]}var jg=xe(function(e){return mi(Bt(e,1,bt,!0))}),zg=xe(function(e){var t=xr(e);return bt(t)&&(t=i),mi(Bt(e,1,bt,!0),ne(t,2))}),Ug=xe(function(e){var t=xr(e);return t=typeof t=="function"?t:i,mi(Bt(e,1,bt,!0),i,t)});function Hg(e){return e&&e.length?mi(e):[]}function Bg(e,t){return e&&e.length?mi(e,ne(t,2)):[]}function kg(e,t){return t=typeof t=="function"?t:i,e&&e.length?mi(e,i,t):[]}function $a(e){if(!(e&&e.length))return[];var t=0;return e=pi(e,function(s){if(bt(s))return t=Lt(s.length,t),!0}),Xo(t,function(s){return st(e,Jo(s))})}function ih(e,t){if(!(e&&e.length))return[];var s=$a(e);return t==null?s:st(s,function(a){return Mt(t,i,a)})}var Kg=xe(function(e,t){return bt(e)?Ts(e,t):[]}),Vg=xe(function(e){return wa(pi(e,bt))}),Gg=xe(function(e){var t=xr(e);return bt(t)&&(t=i),wa(pi(e,bt),ne(t,2))}),Wg=xe(function(e){var t=xr(e);return t=typeof t=="function"?t:i,wa(pi(e,bt),i,t)}),Jg=xe($a);function Qg(e,t){return bu(e||[],t||[],Cs)}function Yg(e,t){return bu(e||[],t||[],Fs)}var Xg=xe(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,ih(e,s)});function sh(e){var t=f(e);return t.__chain__=!0,t}function Zg(e,t){return t(e),e}function Yn(e,t){return t(e)}var ey=Zr(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,l=function(p){return oa(p,e)};return t>1||this.__actions__.length||!(a instanceof Ae)||!ei(s)?this.thru(l):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Yn,args:[l],thisArg:i}),new br(a,this.__chain__).thru(function(p){return t&&!p.length&&p.push(i),p}))});function ty(){return sh(this)}function ry(){return new br(this.value(),this.__chain__)}function iy(){this.__values__===i&&(this.__values__=mh(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function sy(){return this}function ny(e){for(var t,s=this;s instanceof Ln;){var a=Yu(s);a.__index__=0,a.__values__=i,t?l.__wrapped__=a:t=a;var l=a;s=s.__wrapped__}return l.__wrapped__=e,t}function oy(){var e=this.__wrapped__;if(e instanceof Ae){var t=e;return this.__actions__.length&&(t=new Ae(this)),t=t.reverse(),t.__actions__.push({func:Yn,args:[Fa],thisArg:i}),new br(t,this.__chain__)}return this.thru(Fa)}function ay(){return _u(this.__wrapped__,this.__actions__)}var cy=Bn(function(e,t,s){je.call(e,s)?++e[s]:Yr(e,s,1)});function uy(e,t,s){var a=we(e)?Dc:Zp;return s&&Xt(e,t,s)&&(t=i),a(e,ne(t,3))}function hy(e,t){var s=we(e)?pi:iu;return s(e,ne(t,3))}var ly=Tu(Xu),fy=Tu(Zu);function py(e,t){return Bt(Xn(e,t),1)}function dy(e,t){return Bt(Xn(e,t),ce)}function gy(e,t,s){return s=s===i?1:_e(s),Bt(Xn(e,t),s)}function nh(e,t){var s=we(e)?wr:vi;return s(e,ne(t,3))}function oh(e,t){var s=we(e)?Ff:ru;return s(e,ne(t,3))}var yy=Bn(function(e,t,s){je.call(e,s)?e[s].push(t):Yr(e,s,[t])});function vy(e,t,s,a){e=nr(e)?e:fs(e),s=s&&!a?_e(s):0;var l=e.length;return s<0&&(s=Lt(l+s,0)),io(e)?s<=l&&e.indexOf(t,s)>-1:!!l&&es(e,t,s)>-1}var my=xe(function(e,t,s){var a=-1,l=typeof t=="function",p=nr(e)?T(e.length):[];return vi(e,function(w){p[++a]=l?Mt(t,w,s):Ns(w,t,s)}),p}),wy=Bn(function(e,t,s){Yr(e,s,t)});function Xn(e,t){var s=we(e)?st:uu;return s(e,ne(t,3))}function _y(e,t,s,a){return e==null?[]:(we(t)||(t=t==null?[]:[t]),s=a?i:s,we(s)||(s=s==null?[]:[s]),pu(e,t,s))}var by=Bn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Ey(e,t,s){var a=we(e)?Go:qc,l=arguments.length<3;return a(e,ne(t,4),s,l,vi)}function Iy(e,t,s){var a=we(e)?$f:qc,l=arguments.length<3;return a(e,ne(t,4),s,l,ru)}function xy(e,t){var s=we(e)?pi:iu;return s(e,to(ne(t,3)))}function Py(e){var t=we(e)?Xc:vd;return t(e)}function Sy(e,t,s){(s?Xt(e,t,s):t===i)?t=1:t=_e(t);var a=we(e)?Wp:md;return a(e,t)}function Ay(e){var t=we(e)?Jp:_d;return t(e)}function Ry(e){if(e==null)return 0;if(nr(e))return io(e)?rs(e):e.length;var t=Vt(e);return t==be||t==Le?e.size:fa(e).length}function Oy(e,t,s){var a=we(e)?Wo:bd;return s&&Xt(e,t,s)&&(t=i),a(e,ne(t,3))}var Cy=xe(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Xt(e,t[0],t[1])?t=[]:s>2&&Xt(t[0],t[1],t[2])&&(t=[t[0]]),pu(e,Bt(t,1),[])}),Zn=hp||function(){return Re.Date.now()};function Ty(e,t){if(typeof t!="function")throw new _r(d);return e=_e(e),function(){if(--e<1)return t.apply(this,arguments)}}function ah(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Xr(e,U,i,i,i,i,t)}function ch(e,t){var s;if(typeof t!="function")throw new _r(d);return e=_e(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var La=xe(function(e,t,s){var a=re;if(s.length){var l=gi(s,hs(La));a|=de}return Xr(e,a,t,s,l)}),uh=xe(function(e,t,s){var a=re|he;if(s.length){var l=gi(s,hs(uh));a|=de}return Xr(t,a,e,s,l)});function hh(e,t,s){t=s?i:t;var a=Xr(e,fe,i,i,i,i,i,t);return a.placeholder=hh.placeholder,a}function lh(e,t,s){t=s?i:t;var a=Xr(e,pe,i,i,i,i,i,t);return a.placeholder=lh.placeholder,a}function fh(e,t,s){var a,l,p,w,b,A,q=0,M=!1,B=!1,J=!0;if(typeof e!="function")throw new _r(d);t=Pr(t)||0,ut(s)&&(M=!!s.leading,B="maxWait"in s,p=B?Lt(Pr(s.maxWait)||0,t):p,J="trailing"in s?!!s.trailing:J);function te(Et){var Dr=a,ii=l;return a=l=i,q=Et,w=e.apply(ii,Dr),w}function oe(Et){return q=Et,b=qs(Pe,t),M?te(Et):w}function Ee(Et){var Dr=Et-A,ii=Et-q,Th=t-Dr;return B?Kt(Th,p-ii):Th}function ae(Et){var Dr=Et-A,ii=Et-q;return A===i||Dr>=t||Dr<0||B&&ii>=p}function Pe(){var Et=Zn();if(ae(Et))return Oe(Et);b=qs(Pe,Ee(Et))}function Oe(Et){return b=i,J&&a?te(Et):(a=l=i,w)}function gr(){b!==i&&Eu(b),q=0,a=A=l=b=i}function Zt(){return b===i?w:Oe(Zn())}function yr(){var Et=Zn(),Dr=ae(Et);if(a=arguments,l=this,A=Et,Dr){if(b===i)return oe(A);if(B)return Eu(b),b=qs(Pe,t),te(A)}return b===i&&(b=qs(Pe,t)),w}return yr.cancel=gr,yr.flush=Zt,yr}var Ny=xe(function(e,t){return tu(e,1,t)}),Dy=xe(function(e,t,s){return tu(e,Pr(t)||0,s)});function Fy(e){return Xr(e,ve)}function eo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new _r(d);var s=function(){var a=arguments,l=t?t.apply(this,a):a[0],p=s.cache;if(p.has(l))return p.get(l);var w=e.apply(this,a);return s.cache=p.set(l,w)||p,w};return s.cache=new(eo.Cache||Qr),s}eo.Cache=Qr;function to(e){if(typeof e!="function")throw new _r(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function $y(e){return ch(2,e)}var Ly=Ed(function(e,t){t=t.length==1&&we(t[0])?st(t[0],fr(ne())):st(Bt(t,1),fr(ne()));var s=t.length;return xe(function(a){for(var l=-1,p=Kt(a.length,s);++l<p;)a[l]=t[l].call(this,a[l]);return Mt(e,this,a)})}),qa=xe(function(e,t){var s=gi(t,hs(qa));return Xr(e,de,i,t,s)}),ph=xe(function(e,t){var s=gi(t,hs(ph));return Xr(e,$,i,t,s)}),qy=Zr(function(e,t){return Xr(e,W,i,i,i,t)});function My(e,t){if(typeof e!="function")throw new _r(d);return t=t===i?t:_e(t),xe(e,t)}function jy(e,t){if(typeof e!="function")throw new _r(d);return t=t==null?0:Lt(_e(t),0),xe(function(s){var a=s[t],l=_i(s,0,t);return a&&di(l,a),Mt(e,this,l)})}function zy(e,t,s){var a=!0,l=!0;if(typeof e!="function")throw new _r(d);return ut(s)&&(a="leading"in s?!!s.leading:a,l="trailing"in s?!!s.trailing:l),fh(e,t,{leading:a,maxWait:t,trailing:l})}function Uy(e){return ah(e,1)}function Hy(e,t){return qa(ba(t),e)}function By(){if(!arguments.length)return[];var e=arguments[0];return we(e)?e:[e]}function ky(e){return Er(e,j)}function Ky(e,t){return t=typeof t=="function"?t:i,Er(e,j,t)}function Vy(e){return Er(e,O|j)}function Gy(e,t){return t=typeof t=="function"?t:i,Er(e,O|j,t)}function Wy(e,t){return t==null||eu(e,t,jt(t))}function Nr(e,t){return e===t||e!==e&&t!==t}var Jy=Gn(ua),Qy=Gn(function(e,t){return e>=t}),zi=ou(function(){return arguments}())?ou:function(e){return vt(e)&&je.call(e,"callee")&&!Vc.call(e,"callee")},we=T.isArray,Yy=Qt?fr(Qt):nd;function nr(e){return e!=null&&ro(e.length)&&!ti(e)}function bt(e){return vt(e)&&nr(e)}function Xy(e){return e===!0||e===!1||vt(e)&&Yt(e)==D}var bi=fp||Wa,Zy=Or?fr(Or):od;function ev(e){return vt(e)&&e.nodeType===1&&!Ms(e)}function tv(e){if(e==null)return!0;if(nr(e)&&(we(e)||typeof e=="string"||typeof e.splice=="function"||bi(e)||ls(e)||zi(e)))return!e.length;var t=Vt(e);if(t==be||t==Le)return!e.size;if(Ls(e))return!fa(e).length;for(var s in e)if(je.call(e,s))return!1;return!0}function rv(e,t){return Ds(e,t)}function iv(e,t,s){s=typeof s=="function"?s:i;var a=s?s(e,t):i;return a===i?Ds(e,t,i,s):!!a}function Ma(e){if(!vt(e))return!1;var t=Yt(e);return t==E||t==u||typeof e.message=="string"&&typeof e.name=="string"&&!Ms(e)}function sv(e){return typeof e=="number"&&Wc(e)}function ti(e){if(!ut(e))return!1;var t=Yt(e);return t==ee||t==ge||t==F||t==mt}function dh(e){return typeof e=="number"&&e==_e(e)}function ro(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=V}function ut(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function vt(e){return e!=null&&typeof e=="object"}var gh=mr?fr(mr):cd;function nv(e,t){return e===t||la(e,t,Ra(t))}function ov(e,t,s){return s=typeof s=="function"?s:i,la(e,t,Ra(t),s)}function av(e){return yh(e)&&e!=+e}function cv(e){if(Kd(e))throw new ye(h);return au(e)}function uv(e){return e===null}function hv(e){return e==null}function yh(e){return typeof e=="number"||vt(e)&&Yt(e)==Ne}function Ms(e){if(!vt(e)||Yt(e)!=Se)return!1;var t=On(e);if(t===null)return!0;var s=je.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Pn.call(s)==op}var ja=Ur?fr(Ur):ud;function lv(e){return dh(e)&&e>=-V&&e<=V}var vh=Is?fr(Is):hd;function io(e){return typeof e=="string"||!we(e)&&vt(e)&&Yt(e)==Ye}function dr(e){return typeof e=="symbol"||vt(e)&&Yt(e)==Xe}var ls=Ni?fr(Ni):ld;function fv(e){return e===i}function pv(e){return vt(e)&&Vt(e)==Ue}function dv(e){return vt(e)&&Yt(e)==Ze}var gv=Gn(pa),yv=Gn(function(e,t){return e<=t});function mh(e){if(!e)return[];if(nr(e))return io(e)?Cr(e):sr(e);if(Ps&&e[Ps])return Wf(e[Ps]());var t=Vt(e),s=t==be?ea:t==Le?En:fs;return s(e)}function ri(e){if(!e)return e===0?e:0;if(e=Pr(e),e===ce||e===-ce){var t=e<0?-1:1;return t*H}return e===e?e:0}function _e(e){var t=ri(e),s=t%1;return t===t?s?t-s:t:0}function wh(e){return e?Li(_e(e),0,G):0}function Pr(e){if(typeof e=="number")return e;if(dr(e))return k;if(ut(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ut(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Mc(e);var s=Oo.test(e);return s||To.test(e)?me(e.slice(2),s?2:8):Ro.test(e)?k:+e}function _h(e){return Br(e,or(e))}function vv(e){return e?Li(_e(e),-V,V):e===0?e:0}function qe(e){return e==null?"":pr(e)}var mv=cs(function(e,t){if(Ls(t)||nr(t)){Br(t,jt(t),e);return}for(var s in t)je.call(t,s)&&Cs(e,s,t[s])}),bh=cs(function(e,t){Br(t,or(t),e)}),so=cs(function(e,t,s,a){Br(t,or(t),e,a)}),wv=cs(function(e,t,s,a){Br(t,jt(t),e,a)}),_v=Zr(oa);function bv(e,t){var s=as(e);return t==null?s:Zc(s,t)}var Ev=xe(function(e,t){e=We(e);var s=-1,a=t.length,l=a>2?t[2]:i;for(l&&Xt(t[0],t[1],l)&&(a=1);++s<a;)for(var p=t[s],w=or(p),b=-1,A=w.length;++b<A;){var q=w[b],M=e[q];(M===i||Nr(M,ss[q])&&!je.call(e,q))&&(e[q]=p[q])}return e}),Iv=xe(function(e){return e.push(i,Mu),Mt(Eh,i,e)});function xv(e,t){return Fc(e,ne(t,3),Hr)}function Pv(e,t){return Fc(e,ne(t,3),ca)}function Sv(e,t){return e==null?e:aa(e,ne(t,3),or)}function Av(e,t){return e==null?e:su(e,ne(t,3),or)}function Rv(e,t){return e&&Hr(e,ne(t,3))}function Ov(e,t){return e&&ca(e,ne(t,3))}function Cv(e){return e==null?[]:jn(e,jt(e))}function Tv(e){return e==null?[]:jn(e,or(e))}function za(e,t,s){var a=e==null?i:qi(e,t);return a===i?s:a}function Nv(e,t){return e!=null&&Uu(e,t,td)}function Ua(e,t){return e!=null&&Uu(e,t,rd)}var Dv=Du(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Sn.call(t)),e[t]=s},Ba(ar)),Fv=Du(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Sn.call(t)),je.call(e,t)?e[t].push(s):e[t]=[s]},ne),$v=xe(Ns);function jt(e){return nr(e)?Yc(e):fa(e)}function or(e){return nr(e)?Yc(e,!0):fd(e)}function Lv(e,t){var s={};return t=ne(t,3),Hr(e,function(a,l,p){Yr(s,t(a,l,p),a)}),s}function qv(e,t){var s={};return t=ne(t,3),Hr(e,function(a,l,p){Yr(s,l,t(a,l,p))}),s}var Mv=cs(function(e,t,s){zn(e,t,s)}),Eh=cs(function(e,t,s,a){zn(e,t,s,a)}),jv=Zr(function(e,t){var s={};if(e==null)return s;var a=!1;t=st(t,function(p){return p=wi(p,e),a||(a=p.length>1),p}),Br(e,Sa(e),s),a&&(s=Er(s,O|N|j,Dd));for(var l=t.length;l--;)ma(s,t[l]);return s});function zv(e,t){return Ih(e,to(ne(t)))}var Uv=Zr(function(e,t){return e==null?{}:dd(e,t)});function Ih(e,t){if(e==null)return{};var s=st(Sa(e),function(a){return[a]});return t=ne(t),du(e,s,function(a,l){return t(a,l[0])})}function Hv(e,t,s){t=wi(t,e);var a=-1,l=t.length;for(l||(l=1,e=i);++a<l;){var p=e==null?i:e[kr(t[a])];p===i&&(a=l,p=s),e=ti(p)?p.call(e):p}return e}function Bv(e,t,s){return e==null?e:Fs(e,t,s)}function kv(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Fs(e,t,s,a)}var xh=Lu(jt),Ph=Lu(or);function Kv(e,t,s){var a=we(e),l=a||bi(e)||ls(e);if(t=ne(t,4),s==null){var p=e&&e.constructor;l?s=a?new p:[]:ut(e)?s=ti(p)?as(On(e)):{}:s={}}return(l?wr:Hr)(e,function(w,b,A){return t(s,w,b,A)}),s}function Vv(e,t){return e==null?!0:ma(e,t)}function Gv(e,t,s){return e==null?e:wu(e,t,ba(s))}function Wv(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:wu(e,t,ba(s),a)}function fs(e){return e==null?[]:Zo(e,jt(e))}function Jv(e){return e==null?[]:Zo(e,or(e))}function Qv(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=Pr(s),s=s===s?s:0),t!==i&&(t=Pr(t),t=t===t?t:0),Li(Pr(e),t,s)}function Yv(e,t,s){return t=ri(t),s===i?(s=t,t=0):s=ri(s),e=Pr(e),id(e,t,s)}function Xv(e,t,s){if(s&&typeof s!="boolean"&&Xt(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=ri(e),t===i?(t=e,e=0):t=ri(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var l=Jc();return Kt(e+l*(t-e+Ve("1e-"+((l+"").length-1))),t)}return ga(e,t)}var Zv=us(function(e,t,s){return t=t.toLowerCase(),e+(s?Sh(t):t)});function Sh(e){return Ha(qe(e).toLowerCase())}function Ah(e){return e=qe(e),e&&e.replace(Gr,Bf).replace(ko,"")}function e0(e,t,s){e=qe(e),t=pr(t);var a=e.length;s=s===i?a:Li(_e(s),0,a);var l=s;return s-=t.length,s>=0&&e.slice(s,l)==t}function t0(e){return e=qe(e),e&&rt.test(e)?e.replace(Ai,kf):e}function r0(e){return e=qe(e),e&&Rt.test(e)?e.replace(dt,"\\$&"):e}var i0=us(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),s0=us(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),n0=Cu("toLowerCase");function o0(e,t,s){e=qe(e),t=_e(t);var a=t?rs(e):0;if(!t||a>=t)return e;var l=(t-a)/2;return Vn(Dn(l),s)+e+Vn(Nn(l),s)}function a0(e,t,s){e=qe(e),t=_e(t);var a=t?rs(e):0;return t&&a<t?e+Vn(t-a,s):e}function c0(e,t,s){e=qe(e),t=_e(t);var a=t?rs(e):0;return t&&a<t?Vn(t-a,s)+e:e}function u0(e,t,s){return s||t==null?t=0:t&&(t=+t),yp(qe(e).replace(gt,""),t||0)}function h0(e,t,s){return(s?Xt(e,t,s):t===i)?t=1:t=_e(t),ya(qe(e),t)}function l0(){var e=arguments,t=qe(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var f0=us(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function p0(e,t,s){return s&&typeof s!="number"&&Xt(e,t,s)&&(t=s=i),s=s===i?G:s>>>0,s?(e=qe(e),e&&(typeof t=="string"||t!=null&&!ja(t))&&(t=pr(t),!t&&ts(e))?_i(Cr(e),0,s):e.split(t,s)):[]}var d0=us(function(e,t,s){return e+(s?" ":"")+Ha(t)});function g0(e,t,s){return e=qe(e),s=s==null?0:Li(_e(s),0,e.length),t=pr(t),e.slice(s,s+t.length)==t}function y0(e,t,s){var a=f.templateSettings;s&&Xt(e,t,s)&&(t=i),e=qe(e),t=so({},t,a,qu);var l=so({},t.imports,a.imports,qu),p=jt(l),w=Zo(l,p),b,A,q=0,M=t.interpolate||Gi,B="__p += '",J=ta((t.escape||Gi).source+"|"+M.source+"|"+(M===ct?Ao:Gi).source+"|"+(t.evaluate||Gi).source+"|$","g"),te="//# sourceURL="+(je.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ko+"]")+`
`;e.replace(J,function(ae,Pe,Oe,gr,Zt,yr){return Oe||(Oe=gr),B+=e.slice(q,yr).replace(Do,Kf),Pe&&(b=!0,B+=`' +
__e(`+Pe+`) +
'`),Zt&&(A=!0,B+=`';
`+Zt+`;
__p += '`),Oe&&(B+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),q=yr+ae.length,ae}),B+=`';
`;var oe=je.call(t,"variable")&&t.variable;if(!oe)B=`with (obj) {
`+B+`
}
`;else if(Po.test(oe))throw new ye(g);B=(A?B.replace(jr,""):B).replace(Jt,"$1").replace(Vr,"$1;"),B="function("+(oe||"obj")+`) {
`+(oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(A?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+B+`return __p
}`;var Ee=Oh(function(){return $e(p,te+"return "+B).apply(i,w)});if(Ee.source=B,Ma(Ee))throw Ee;return Ee}function v0(e){return qe(e).toLowerCase()}function m0(e){return qe(e).toUpperCase()}function w0(e,t,s){if(e=qe(e),e&&(s||t===i))return Mc(e);if(!e||!(t=pr(t)))return e;var a=Cr(e),l=Cr(t),p=jc(a,l),w=zc(a,l)+1;return _i(a,p,w).join("")}function _0(e,t,s){if(e=qe(e),e&&(s||t===i))return e.slice(0,Hc(e)+1);if(!e||!(t=pr(t)))return e;var a=Cr(e),l=zc(a,Cr(t))+1;return _i(a,0,l).join("")}function b0(e,t,s){if(e=qe(e),e&&(s||t===i))return e.replace(gt,"");if(!e||!(t=pr(t)))return e;var a=Cr(e),l=jc(a,Cr(t));return _i(a,l).join("")}function E0(e,t){var s=ie,a=ue;if(ut(t)){var l="separator"in t?t.separator:l;s="length"in t?_e(t.length):s,a="omission"in t?pr(t.omission):a}e=qe(e);var p=e.length;if(ts(e)){var w=Cr(e);p=w.length}if(s>=p)return e;var b=s-rs(a);if(b<1)return a;var A=w?_i(w,0,b).join(""):e.slice(0,b);if(l===i)return A+a;if(w&&(b+=A.length-b),ja(l)){if(e.slice(b).search(l)){var q,M=A;for(l.global||(l=ta(l.source,qe(vr.exec(l))+"g")),l.lastIndex=0;q=l.exec(M);)var B=q.index;A=A.slice(0,B===i?b:B)}}else if(e.indexOf(pr(l),b)!=b){var J=A.lastIndexOf(l);J>-1&&(A=A.slice(0,J))}return A+a}function I0(e){return e=qe(e),e&&lt.test(e)?e.replace(li,Xf):e}var x0=us(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Ha=Cu("toUpperCase");function Rh(e,t,s){return e=qe(e),t=s?i:t,t===i?Gf(e)?tp(e):Mf(e):e.match(t)||[]}var Oh=xe(function(e,t){try{return Mt(e,i,t)}catch(s){return Ma(s)?s:new ye(s)}}),P0=Zr(function(e,t){return wr(t,function(s){s=kr(s),Yr(e,s,La(e[s],e))}),e});function S0(e){var t=e==null?0:e.length,s=ne();return e=t?st(e,function(a){if(typeof a[1]!="function")throw new _r(d);return[s(a[0]),a[1]]}):[],xe(function(a){for(var l=-1;++l<t;){var p=e[l];if(Mt(p[0],this,a))return Mt(p[1],this,a)}})}function A0(e){return Xp(Er(e,O))}function Ba(e){return function(){return e}}function R0(e,t){return e==null||e!==e?t:e}var O0=Nu(),C0=Nu(!0);function ar(e){return e}function ka(e){return cu(typeof e=="function"?e:Er(e,O))}function T0(e){return hu(Er(e,O))}function N0(e,t){return lu(e,Er(t,O))}var D0=xe(function(e,t){return function(s){return Ns(s,e,t)}}),F0=xe(function(e,t){return function(s){return Ns(e,s,t)}});function Ka(e,t,s){var a=jt(t),l=jn(t,a);s==null&&!(ut(t)&&(l.length||!a.length))&&(s=t,t=e,e=this,l=jn(t,jt(t)));var p=!(ut(s)&&"chain"in s)||!!s.chain,w=ti(e);return wr(l,function(b){var A=t[b];e[b]=A,w&&(e.prototype[b]=function(){var q=this.__chain__;if(p||q){var M=e(this.__wrapped__),B=M.__actions__=sr(this.__actions__);return B.push({func:A,args:arguments,thisArg:e}),M.__chain__=q,M}return A.apply(e,di([this.value()],arguments))})}),e}function $0(){return Re._===this&&(Re._=ap),this}function Va(){}function L0(e){return e=_e(e),xe(function(t){return fu(t,e)})}var q0=Ia(st),M0=Ia(Dc),j0=Ia(Wo);function Ch(e){return Ca(e)?Jo(kr(e)):gd(e)}function z0(e){return function(t){return e==null?i:qi(e,t)}}var U0=Fu(),H0=Fu(!0);function Ga(){return[]}function Wa(){return!1}function B0(){return{}}function k0(){return""}function K0(){return!0}function V0(e,t){if(e=_e(e),e<1||e>V)return[];var s=G,a=Kt(e,G);t=ne(t),e-=G;for(var l=Xo(a,t);++s<e;)t(s);return l}function G0(e){return we(e)?st(e,kr):dr(e)?[e]:sr(Qu(qe(e)))}function W0(e){var t=++np;return qe(e)+t}var J0=Kn(function(e,t){return e+t},0),Q0=xa("ceil"),Y0=Kn(function(e,t){return e/t},1),X0=xa("floor");function Z0(e){return e&&e.length?Mn(e,ar,ua):i}function em(e,t){return e&&e.length?Mn(e,ne(t,2),ua):i}function tm(e){return Lc(e,ar)}function rm(e,t){return Lc(e,ne(t,2))}function im(e){return e&&e.length?Mn(e,ar,pa):i}function sm(e,t){return e&&e.length?Mn(e,ne(t,2),pa):i}var nm=Kn(function(e,t){return e*t},1),om=xa("round"),am=Kn(function(e,t){return e-t},0);function cm(e){return e&&e.length?Yo(e,ar):0}function um(e,t){return e&&e.length?Yo(e,ne(t,2)):0}return f.after=Ty,f.ary=ah,f.assign=mv,f.assignIn=bh,f.assignInWith=so,f.assignWith=wv,f.at=_v,f.before=ch,f.bind=La,f.bindAll=P0,f.bindKey=uh,f.castArray=By,f.chain=sh,f.chunk=Xd,f.compact=Zd,f.concat=eg,f.cond=S0,f.conforms=A0,f.constant=Ba,f.countBy=cy,f.create=bv,f.curry=hh,f.curryRight=lh,f.debounce=fh,f.defaults=Ev,f.defaultsDeep=Iv,f.defer=Ny,f.delay=Dy,f.difference=tg,f.differenceBy=rg,f.differenceWith=ig,f.drop=sg,f.dropRight=ng,f.dropRightWhile=og,f.dropWhile=ag,f.fill=cg,f.filter=hy,f.flatMap=py,f.flatMapDeep=dy,f.flatMapDepth=gy,f.flatten=eh,f.flattenDeep=ug,f.flattenDepth=hg,f.flip=Fy,f.flow=O0,f.flowRight=C0,f.fromPairs=lg,f.functions=Cv,f.functionsIn=Tv,f.groupBy=yy,f.initial=pg,f.intersection=dg,f.intersectionBy=gg,f.intersectionWith=yg,f.invert=Dv,f.invertBy=Fv,f.invokeMap=my,f.iteratee=ka,f.keyBy=wy,f.keys=jt,f.keysIn=or,f.map=Xn,f.mapKeys=Lv,f.mapValues=qv,f.matches=T0,f.matchesProperty=N0,f.memoize=eo,f.merge=Mv,f.mergeWith=Eh,f.method=D0,f.methodOf=F0,f.mixin=Ka,f.negate=to,f.nthArg=L0,f.omit=jv,f.omitBy=zv,f.once=$y,f.orderBy=_y,f.over=q0,f.overArgs=Ly,f.overEvery=M0,f.overSome=j0,f.partial=qa,f.partialRight=ph,f.partition=by,f.pick=Uv,f.pickBy=Ih,f.property=Ch,f.propertyOf=z0,f.pull=_g,f.pullAll=rh,f.pullAllBy=bg,f.pullAllWith=Eg,f.pullAt=Ig,f.range=U0,f.rangeRight=H0,f.rearg=qy,f.reject=xy,f.remove=xg,f.rest=My,f.reverse=Fa,f.sampleSize=Sy,f.set=Bv,f.setWith=kv,f.shuffle=Ay,f.slice=Pg,f.sortBy=Cy,f.sortedUniq=Ng,f.sortedUniqBy=Dg,f.split=p0,f.spread=jy,f.tail=Fg,f.take=$g,f.takeRight=Lg,f.takeRightWhile=qg,f.takeWhile=Mg,f.tap=Zg,f.throttle=zy,f.thru=Yn,f.toArray=mh,f.toPairs=xh,f.toPairsIn=Ph,f.toPath=G0,f.toPlainObject=_h,f.transform=Kv,f.unary=Uy,f.union=jg,f.unionBy=zg,f.unionWith=Ug,f.uniq=Hg,f.uniqBy=Bg,f.uniqWith=kg,f.unset=Vv,f.unzip=$a,f.unzipWith=ih,f.update=Gv,f.updateWith=Wv,f.values=fs,f.valuesIn=Jv,f.without=Kg,f.words=Rh,f.wrap=Hy,f.xor=Vg,f.xorBy=Gg,f.xorWith=Wg,f.zip=Jg,f.zipObject=Qg,f.zipObjectDeep=Yg,f.zipWith=Xg,f.entries=xh,f.entriesIn=Ph,f.extend=bh,f.extendWith=so,Ka(f,f),f.add=J0,f.attempt=Oh,f.camelCase=Zv,f.capitalize=Sh,f.ceil=Q0,f.clamp=Qv,f.clone=ky,f.cloneDeep=Vy,f.cloneDeepWith=Gy,f.cloneWith=Ky,f.conformsTo=Wy,f.deburr=Ah,f.defaultTo=R0,f.divide=Y0,f.endsWith=e0,f.eq=Nr,f.escape=t0,f.escapeRegExp=r0,f.every=uy,f.find=ly,f.findIndex=Xu,f.findKey=xv,f.findLast=fy,f.findLastIndex=Zu,f.findLastKey=Pv,f.floor=X0,f.forEach=nh,f.forEachRight=oh,f.forIn=Sv,f.forInRight=Av,f.forOwn=Rv,f.forOwnRight=Ov,f.get=za,f.gt=Jy,f.gte=Qy,f.has=Nv,f.hasIn=Ua,f.head=th,f.identity=ar,f.includes=vy,f.indexOf=fg,f.inRange=Yv,f.invoke=$v,f.isArguments=zi,f.isArray=we,f.isArrayBuffer=Yy,f.isArrayLike=nr,f.isArrayLikeObject=bt,f.isBoolean=Xy,f.isBuffer=bi,f.isDate=Zy,f.isElement=ev,f.isEmpty=tv,f.isEqual=rv,f.isEqualWith=iv,f.isError=Ma,f.isFinite=sv,f.isFunction=ti,f.isInteger=dh,f.isLength=ro,f.isMap=gh,f.isMatch=nv,f.isMatchWith=ov,f.isNaN=av,f.isNative=cv,f.isNil=hv,f.isNull=uv,f.isNumber=yh,f.isObject=ut,f.isObjectLike=vt,f.isPlainObject=Ms,f.isRegExp=ja,f.isSafeInteger=lv,f.isSet=vh,f.isString=io,f.isSymbol=dr,f.isTypedArray=ls,f.isUndefined=fv,f.isWeakMap=pv,f.isWeakSet=dv,f.join=vg,f.kebabCase=i0,f.last=xr,f.lastIndexOf=mg,f.lowerCase=s0,f.lowerFirst=n0,f.lt=gv,f.lte=yv,f.max=Z0,f.maxBy=em,f.mean=tm,f.meanBy=rm,f.min=im,f.minBy=sm,f.stubArray=Ga,f.stubFalse=Wa,f.stubObject=B0,f.stubString=k0,f.stubTrue=K0,f.multiply=nm,f.nth=wg,f.noConflict=$0,f.noop=Va,f.now=Zn,f.pad=o0,f.padEnd=a0,f.padStart=c0,f.parseInt=u0,f.random=Xv,f.reduce=Ey,f.reduceRight=Iy,f.repeat=h0,f.replace=l0,f.result=Hv,f.round=om,f.runInContext=S,f.sample=Py,f.size=Ry,f.snakeCase=f0,f.some=Oy,f.sortedIndex=Sg,f.sortedIndexBy=Ag,f.sortedIndexOf=Rg,f.sortedLastIndex=Og,f.sortedLastIndexBy=Cg,f.sortedLastIndexOf=Tg,f.startCase=d0,f.startsWith=g0,f.subtract=am,f.sum=cm,f.sumBy=um,f.template=y0,f.times=V0,f.toFinite=ri,f.toInteger=_e,f.toLength=wh,f.toLower=v0,f.toNumber=Pr,f.toSafeInteger=vv,f.toString=qe,f.toUpper=m0,f.trim=w0,f.trimEnd=_0,f.trimStart=b0,f.truncate=E0,f.unescape=I0,f.uniqueId=W0,f.upperCase=x0,f.upperFirst=Ha,f.each=nh,f.eachRight=oh,f.first=th,Ka(f,function(){var e={};return Hr(f,function(t,s){je.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,wr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),wr(["drop","take"],function(e,t){Ae.prototype[e]=function(s){s=s===i?1:Lt(_e(s),0);var a=this.__filtered__&&!t?new Ae(this):this.clone();return a.__filtered__?a.__takeCount__=Kt(s,a.__takeCount__):a.__views__.push({size:Kt(s,G),type:e+(a.__dir__<0?"Right":"")}),a},Ae.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),wr(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==v||s==Y;Ae.prototype[e]=function(l){var p=this.clone();return p.__iteratees__.push({iteratee:ne(l,3),type:s}),p.__filtered__=p.__filtered__||a,p}}),wr(["head","last"],function(e,t){var s="take"+(t?"Right":"");Ae.prototype[e]=function(){return this[s](1).value()[0]}}),wr(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Ae.prototype[e]=function(){return this.__filtered__?new Ae(this):this[s](1)}}),Ae.prototype.compact=function(){return this.filter(ar)},Ae.prototype.find=function(e){return this.filter(e).head()},Ae.prototype.findLast=function(e){return this.reverse().find(e)},Ae.prototype.invokeMap=xe(function(e,t){return typeof e=="function"?new Ae(this):this.map(function(s){return Ns(s,e,t)})}),Ae.prototype.reject=function(e){return this.filter(to(ne(e)))},Ae.prototype.slice=function(e,t){e=_e(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Ae(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=_e(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Ae.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ae.prototype.toArray=function(){return this.take(G)},Hr(Ae.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),l=f[a?"take"+(t=="last"?"Right":""):t],p=a||/^find/.test(t);l&&(f.prototype[t]=function(){var w=this.__wrapped__,b=a?[1]:arguments,A=w instanceof Ae,q=b[0],M=A||we(w),B=function(Pe){var Oe=l.apply(f,di([Pe],b));return a&&J?Oe[0]:Oe};M&&s&&typeof q=="function"&&q.length!=1&&(A=M=!1);var J=this.__chain__,te=!!this.__actions__.length,oe=p&&!J,Ee=A&&!te;if(!p&&M){w=Ee?w:new Ae(this);var ae=e.apply(w,b);return ae.__actions__.push({func:Yn,args:[B],thisArg:i}),new br(ae,J)}return oe&&Ee?e.apply(this,b):(ae=this.thru(B),oe?a?ae.value()[0]:ae.value():ae)})}),wr(["pop","push","shift","sort","splice","unshift"],function(e){var t=In[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(a&&!this.__chain__){var p=this.value();return t.apply(we(p)?p:[],l)}return this[s](function(w){return t.apply(we(w)?w:[],l)})}}),Hr(Ae.prototype,function(e,t){var s=f[t];if(s){var a=s.name+"";je.call(os,a)||(os[a]=[]),os[a].push({name:t,func:s})}}),os[kn(i,he).name]=[{name:"wrapper",func:i}],Ae.prototype.clone=Ip,Ae.prototype.reverse=xp,Ae.prototype.value=Pp,f.prototype.at=ey,f.prototype.chain=ty,f.prototype.commit=ry,f.prototype.next=iy,f.prototype.plant=ny,f.prototype.reverse=oy,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=ay,f.prototype.first=f.prototype.head,Ps&&(f.prototype[Ps]=sy),f},is=rp();_t?((_t.exports=is)._=is,Ge._=is):Re._=is}).call(Ks)})(mc,mc.exports);var PE=Object.defineProperty,SE=Object.defineProperties,AE=Object.getOwnPropertyDescriptors,Nl=Object.getOwnPropertySymbols,RE=Object.prototype.hasOwnProperty,OE=Object.prototype.propertyIsEnumerable,Dl=(c,r,i)=>r in c?PE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,uo=(c,r)=>{for(var i in r||(r={}))RE.call(r,i)&&Dl(c,i,r[i]);if(Nl)for(var i of Nl(r))OE.call(r,i)&&Dl(c,i,r[i]);return c},CE=(c,r)=>SE(c,AE(r));function Pi(c,r,i){var n;const o=Jm(c);return((n=r.rpcMap)==null?void 0:n[o.reference])||`${xE}?chainId=${o.namespace}:${o.reference}&projectId=${i}`}function Vi(c){return c.includes(":")?c.split(":")[1]:c}function Tf(c){return c.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function TE(c,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(c));if(!i.length)return[];const n=[];return i.forEach(o=>{const h=r.namespaces[o].accounts;n.push(...h)}),n}function NE(c={},r={}){const i=Fl(c),n=Fl(r);return mc.exports.merge(i,n)}function Fl(c){var r,i,n,o;const h={};if(!fo(c))return h;for(const[d,g]of Object.entries(c)){const _=Wl(d)?[d]:g.chains,m=g.methods||[],x=g.events||[],O=g.rpcMap||{},N=Vs(d);h[N]=CE(uo(uo({},h[N]),g),{chains:Qa(_,(r=h[N])==null?void 0:r.chains),methods:Qa(m,(i=h[N])==null?void 0:i.methods),events:Qa(x,(n=h[N])==null?void 0:n.events),rpcMap:uo(uo({},O),(o=h[N])==null?void 0:o.rpcMap)})}return h}function DE(c){return c.includes(":")?c.split(":")[2]:c}function FE(c){const r={};for(const[i,n]of Object.entries(c)){const o=n.methods||[],h=n.events||[],d=n.accounts||[],g=Wl(i)?[i]:n.chains?n.chains:Tf(n.accounts);r[i]={chains:g,methods:o,events:h,accounts:d}}return r}function cc(c){return typeof c=="number"?c:c.includes("0x")?parseInt(c,16):c.includes(":")?Number(c.split(":")[1]):Number(c)}const Nf={},nt=c=>Nf[c],uc=(c,r)=>{Nf[c]=r};class $E{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}}class LE{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||Pi(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=parseInt(Vi(i));r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class qE{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}}class ME{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}}class jE{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),o=Vi(i);r[o]=this.createHttpProvider(o,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}}class zE{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}}class UE{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,nt("disableProviderPing")))}}class HE{constructor(r){this.name="near",this.namespace=r.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||Pi(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace);return typeof n>"u"?void 0:new ui(new Si(n,nt("disableProviderPing")))}}var BE=Object.defineProperty,kE=Object.defineProperties,KE=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,VE=Object.prototype.hasOwnProperty,GE=Object.prototype.propertyIsEnumerable,Ll=(c,r,i)=>r in c?BE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,ho=(c,r)=>{for(var i in r||(r={}))VE.call(r,i)&&Ll(c,i,r[i]);if($l)for(var i of $l(r))GE.call(r,i)&&Ll(c,i,r[i]);return c},hc=(c,r)=>kE(c,KE(r));class Tc{constructor(r){this.events=new Ec,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Cl})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new Tc(r);return await i.initialize(),i}async request(r,i){const[n,o]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:ho({},r),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(r,i,n){this.request(r,n).then(o=>i(null,o)).catch(o=>i(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:tr("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=FE(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Of)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(vs(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await vE.init({logger:this.providerOpts.logger||Cl,relayUrl:this.providerOpts.relayUrl||bE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>Vs(i)))];uc("client",this.client),uc("events",this.events),uc("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=TE(i,this.session),o=Tf(n),h=NE(this.namespaces,this.optionalNamespaces),d=hc(ho({},h[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new LE({namespace:d});break;case"solana":this.rpcProviders[i]=new qE({namespace:d});break;case"cosmos":this.rpcProviders[i]=new ME({namespace:d});break;case"polkadot":this.rpcProviders[i]=new $E({namespace:d});break;case"cip34":this.rpcProviders[i]=new jE({namespace:d});break;case"elrond":this.rpcProviders[i]=new zE({namespace:d});break;case"multiversx":this.rpcProviders[i]=new UE({namespace:d});break;case"near":this.rpcProviders[i]=new HE({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&vs(o)&&this.events.emit("accountsChanged",o.map(DE))}else if(n.name==="chainChanged"){const o=i.chainId,h=i.event.data,d=Vs(o),g=cc(o)!==cc(h)?`${d}:${cc(h)}`:o;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=hc(ho({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",hc(ho({},tr("USER_DISCONNECTED")),{data:r.topic}))}),this.on(hi.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(d=>Vs(d)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=Vs(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[o,h]=this.validateChain(r);i||this.getProvider(o).setDefaultChain(h),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${Tl}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${Tl}/${r}`)}}const WE=Tc,JE="wc",QE="ethereum_provider",YE=`${JE}@2:${QE}:`,XE="https://rpc.walletconnect.com/v1/",wc=["eth_sendTransaction","personal_sign"],ZE=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],_c=["chainChanged","accountsChanged"],eI=["chainChanged","accountsChanged","message","disconnect","connect"];var tI=Object.defineProperty,rI=Object.defineProperties,iI=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,sI=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,Ml=(c,r,i)=>r in c?tI(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Ws=(c,r)=>{for(var i in r||(r={}))sI.call(r,i)&&Ml(c,i,r[i]);if(ql)for(var i of ql(r))nI.call(r,i)&&Ml(c,i,r[i]);return c},jl=(c,r)=>rI(c,iI(r));function wo(c){return Number(c[0].split(":")[1])}function lc(c){return`0x${c.toString(16)}`}function oI(c){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:h,optionalEvents:d,rpcMap:g}=c;if(!vs(r))throw new Error("Invalid chains");const _={chains:r,methods:n||wc,events:h||_c,rpcMap:Ws({},r.length?{[wo(r)]:g[wo(r)]}:{})},m=h==null?void 0:h.filter(j=>!_c.includes(j)),x=n==null?void 0:n.filter(j=>!wc.includes(j));if(!i&&!d&&!o&&!(m!=null&&m.length)&&!(x!=null&&x.length))return{required:r.length?_:void 0};const O=(m==null?void 0:m.length)&&(x==null?void 0:x.length)||!i,N={chains:[...new Set(O?_.chains.concat(i||[]):i)],methods:[...new Set(_.methods.concat(o!=null&&o.length?o:ZE))],events:[...new Set(_.events.concat(d!=null&&d.length?d:eI))],rpcMap:g};return{required:r.length?_:void 0,optional:i.length?N:void 0}}class Nc{constructor(){this.events=new Ar.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=YE,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new Nc;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=oI(this.rpc);try{const o=await new Promise(async(d,g)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(m=>{!m.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(jl(Ws({namespaces:Ws({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(m=>{d(m)}).catch(m=>{g(new Error(m.message))})});if(!o)return;const h=Qm(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:lc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",lc(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",jl(Ws({},tr("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",lc(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r==null?void 0:r.chains)!=null?i:[],h=(n=r==null?void 0:r.optionalChains)!=null?n:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=o.length?(r==null?void 0:r.methods)||wc:[],_=o.length?(r==null?void 0:r.events)||_c:[],m=(r==null?void 0:r.optionalMethods)||[],x=(r==null?void 0:r.optionalEvents)||[],O=(r==null?void 0:r.rpcMap)||this.buildRpcMap(d,r.projectId),N=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(j=>this.formatChainId(j)),optionalChains:h.map(j=>this.formatChainId(j)),methods:g,events:_,optionalMethods:m,optionalEvents:x,rpcMap:O,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:N,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?wo(this.rpc.chains):wo(this.rpc.optionalChains),this.signer=await WE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await Ym(()=>import("./index-99c54ebe.js").then(o=>o.i),["assets/index-99c54ebe.js","assets/index-c2d2316e.js","assets/index-bf14c1ac.css"]);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Ws({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&vs(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),n&&vs(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${XE}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const _I=Nc;export{_I as EthereumProvider,eI as OPTIONAL_EVENTS,ZE as OPTIONAL_METHODS,_c as REQUIRED_EVENTS,wc as REQUIRED_METHODS,Nc as default};
